<center><a href="https://gitlab.com/petsc/petsc/-/blob/c7d19d7b3f2d9e6411c648820d1207320e4154c7/src/ksp/pc/impls/gamg/gamg.c">Actual source code: gamg.c</a></center><br>

<html>
<head>
<title></title>
<meta name="generator" content="c2html 0.9.4">
<meta name="date" content="2023-03-30T15:49:01+00:00">
</head>

<body bgcolor="#FFFFFF">
<pre width="80">
<a name="line1">  1: </a><font color="#B22222">/*</font>
<a name="line2">  2: </a><font color="#B22222"> GAMG geometric-algebric multigrid <a href="../../../../../docs/manualpages/PC/PC.html">PC</a> - Mark Adams 2011</font>
<a name="line3">  3: </a><font color="#B22222"> */</font>
<a name="line4">  4: </a>#include <A href="../../../../../include/petsc/private/matimpl.h.html">&lt;petsc/private/matimpl.h&gt;</A>
<a name="line5">  5: </a>#include <A href="gamg.h.html">&lt;../src/ksp/pc/impls/gamg/gamg.h&gt;</A>
<a name="line6">  6: </a>#include <A href="../../../ksp/impls/cheby/chebyshevimpl.h.html">&lt;../src/ksp/ksp/impls/cheby/chebyshevimpl.h&gt;</A>

<a name="line8">  8: </a><font color="#A020F0">#if defined(PETSC_HAVE_CUDA)</font>
<a name="line9">  9: </a><font color="#A020F0">  #include &lt;cuda_runtime.h&gt;</font>
<a name="line10"> 10: </a><font color="#A020F0">#endif</font>

<a name="line12"> 12: </a><font color="#A020F0">#if defined(PETSC_HAVE_HIP)</font>
<a name="line13"> 13: </a><font color="#A020F0">  #include &lt;hip/hip_runtime.h&gt;</font>
<a name="line14"> 14: </a><font color="#A020F0">#endif</font>

<a name="line16"> 16: </a><a href="../../../../../docs/manualpages/Sys/PetscLogEvent.html">PetscLogEvent</a> petsc_gamg_setup_events[GAMG_NUM_SET];
<a name="line17"> 17: </a><a href="../../../../../docs/manualpages/Sys/PetscLogEvent.html">PetscLogEvent</a> petsc_gamg_setup_matmat_events[PETSC_MG_MAXLEVELS][3];

<a name="line19"> 19: </a>// #define GAMG_STAGES
<a name="line20"> 20: </a><font color="#A020F0">#if defined(GAMG_STAGES)</font>
<a name="line21"> 21: </a>static <a href="../../../../../docs/manualpages/Sys/PetscLogStage.html">PetscLogStage</a> gamg_stages[PETSC_MG_MAXLEVELS];
<a name="line22"> 22: </a><font color="#A020F0">#endif</font>

<a name="line24"> 24: </a>static <a href="../../../../../docs/manualpages/Sys/PetscFunctionList.html">PetscFunctionList</a> GAMGList = NULL;
<a name="line25"> 25: </a>static <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a>         PCGAMGPackageInitialized;

<a name="line27"> 27: </a><strong><font color="#4169E1"><a name="PCReset_GAMG"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCReset_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc)</font></strong>
<a name="line28"> 28: </a>{
<a name="line29"> 29: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line30"> 30: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line32"> 32: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(pc_gamg-&gt;data);
<a name="line33"> 33: </a>  pc_gamg-&gt;data_sz = 0;
<a name="line34"> 34: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(pc_gamg-&gt;orig_data);
<a name="line35"> 35: </a>  <font color="#4169E1">for</font> (<a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> level = 0; level &lt; PETSC_MG_MAXLEVELS; level++) {
<a name="line36"> 36: </a>    mg-&gt;min_eigen_DinvA[level] = 0;
<a name="line37"> 37: </a>    mg-&gt;max_eigen_DinvA[level] = 0;
<a name="line38"> 38: </a>  }
<a name="line39"> 39: </a>  pc_gamg-&gt;emin = 0;
<a name="line40"> 40: </a>  pc_gamg-&gt;emax = 0;
<a name="line41"> 41: </a>  <font color="#4169E1">return</font> 0;
<a name="line42"> 42: </a>}

<a name="line44"> 44: </a><font color="#B22222">/*</font>
<a name="line45"> 45: </a><font color="#B22222">   PCGAMGCreateLevel_GAMG: create coarse op with RAP.  repartition and/or reduce number</font>
<a name="line46"> 46: </a><font color="#B22222">     of active processors.</font>

<a name="line48"> 48: </a><font color="#B22222">   Input Parameter:</font>
<a name="line49"> 49: </a><font color="#B22222">   . pc - parameters + side effect: coarse data in 'pc_gamg-&gt;data' and</font>
<a name="line50"> 50: </a><font color="#B22222">          'pc_gamg-&gt;data_sz' are changed via repartitioning/reduction.</font>
<a name="line51"> 51: </a><font color="#B22222">   . Amat_fine - matrix on this fine (k) level</font>
<a name="line52"> 52: </a><font color="#B22222">   . cr_bs - coarse block size</font>
<a name="line53"> 53: </a><font color="#B22222">   In/Output Parameter:</font>
<a name="line54"> 54: </a><font color="#B22222">   . a_P_inout - prolongation operator to the next level (k--&gt;k-1)</font>
<a name="line55"> 55: </a><font color="#B22222">   . a_nactive_proc - number of active procs</font>
<a name="line56"> 56: </a><font color="#B22222">   Output Parameter:</font>
<a name="line57"> 57: </a><font color="#B22222">   . a_Amat_crs - coarse matrix that is created (k-1)</font>
<a name="line58"> 58: </a><font color="#B22222">*/</font>
<a name="line59"> 59: </a><strong><font color="#4169E1"><a name="PCGAMGCreateLevel_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGCreateLevel_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a> Amat_fine, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> cr_bs, <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a> *a_P_inout, <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a> *a_Amat_crs, <a href="../../../../../docs/manualpages/Sys/PetscMPIInt.html">PetscMPIInt</a> *a_nactive_proc, <a href="../../../../../docs/manualpages/IS/IS.html">IS</a> *Pcolumnperm, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> is_last)</font></strong>
<a name="line60"> 60: </a>{
<a name="line61"> 61: </a>  PC_MG      *mg      = (PC_MG *)pc-&gt;data;
<a name="line62"> 62: </a>  PC_GAMG    *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;
<a name="line63"> 63: </a>  <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a>         Cmat, Pold = *a_P_inout;
<a name="line64"> 64: </a>  <a href="../../../../../docs/manualpages/Sys/MPI_Comm.html">MPI_Comm</a>    comm;
<a name="line65"> 65: </a>  <a href="../../../../../docs/manualpages/Sys/PetscMPIInt.html">PetscMPIInt</a> rank, size, new_size, nactive = *a_nactive_proc;
<a name="line66"> 66: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>    ncrs_eq, ncrs, f_bs;

<a name="line68"> 68: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectGetComm.html">PetscObjectGetComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)Amat_fine, &amp;comm);
<a name="line69"> 69: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_rank.html#MPI_Comm_rank">MPI_Comm_rank</a>(comm, &amp;rank);
<a name="line70"> 70: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_size.html#MPI_Comm_size">MPI_Comm_size</a>(comm, &amp;size);
<a name="line71"> 71: </a>  <a href="../../../../../docs/manualpages/Mat/MatGetBlockSize.html">MatGetBlockSize</a>(Amat_fine, &amp;f_bs);
<a name="line72"> 72: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>(petsc_gamg_setup_events[GAMG_PTAP], 0, 0, 0, 0);
<a name="line73"> 73: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>(petsc_gamg_setup_matmat_events[pc_gamg-&gt;current_level][1], 0, 0, 0, 0);
<a name="line74"> 74: </a>  <a href="../../../../../docs/manualpages/Mat/MatPtAP.html">MatPtAP</a>(Amat_fine, Pold, <a href="../../../../../docs/manualpages/Mat/MatReuse.html">MAT_INITIAL_MATRIX</a>, 2.0, &amp;Cmat);
<a name="line75"> 75: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_matmat_events[pc_gamg-&gt;current_level][1], 0, 0, 0, 0);
<a name="line76"> 76: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_events[GAMG_PTAP], 0, 0, 0, 0);

<a name="line78"> 78: </a>  <font color="#4169E1">if</font> (Pcolumnperm) *Pcolumnperm = NULL;

<a name="line80"> 80: </a>  <font color="#B22222">/* set 'ncrs' (nodes), 'ncrs_eq' (equations)*/</font>
<a name="line81"> 81: </a>  <a href="../../../../../docs/manualpages/Mat/MatGetLocalSize.html">MatGetLocalSize</a>(Cmat, &amp;ncrs_eq, NULL);
<a name="line82"> 82: </a>  <font color="#4169E1">if</font> (pc_gamg-&gt;data_cell_rows &gt; 0) {
<a name="line83"> 83: </a>    ncrs = pc_gamg-&gt;data_sz / pc_gamg-&gt;data_cell_cols / pc_gamg-&gt;data_cell_rows;
<a name="line84"> 84: </a>  } <font color="#4169E1">else</font> {
<a name="line85"> 85: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> bs;
<a name="line86"> 86: </a>    <a href="../../../../../docs/manualpages/Mat/MatGetBlockSize.html">MatGetBlockSize</a>(Cmat, &amp;bs);
<a name="line87"> 87: </a>    ncrs = ncrs_eq / bs;
<a name="line88"> 88: </a>  }
<a name="line89"> 89: </a>  <font color="#B22222">/* get number of PEs to make active 'new_size', reduce, can be any integer 1-P */</font>
<a name="line90"> 90: </a>  <font color="#4169E1">if</font> (pc_gamg-&gt;level_reduction_factors[pc_gamg-&gt;current_level] == 0 &amp;&amp; <a href="../../../../../docs/manualpages/Sys/PetscDefined.html">PetscDefined</a>(HAVE_CUDA) &amp;&amp; pc_gamg-&gt;current_level == 0) { <font color="#B22222">/* 0 turns reducing to 1 process/device on; do for HIP, etc. */</font>
<a name="line91"> 91: </a><font color="#A020F0">#if defined(PETSC_HAVE_CUDA)</font>
<a name="line92"> 92: </a>    PetscShmComm pshmcomm;
<a name="line93"> 93: </a>    <a href="../../../../../docs/manualpages/Sys/PetscMPIInt.html">PetscMPIInt</a>  locrank;
<a name="line94"> 94: </a>    <a href="../../../../../docs/manualpages/Sys/MPI_Comm.html">MPI_Comm</a>     loccomm;
<a name="line95"> 95: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>     s_nnodes, r_nnodes, new_new_size;
<a name="line96"> 96: </a>    cudaError_t  cerr;
<a name="line97"> 97: </a>    int          devCount;
<a name="line98"> 98: </a>    <a href="../../../../../docs/manualpages/Sys/PetscShmCommGet.html">PetscShmCommGet</a>(comm, &amp;pshmcomm);
<a name="line99"> 99: </a>    <a href="../../../../../docs/manualpages/Sys/PetscShmCommGetMpiShmComm.html">PetscShmCommGetMpiShmComm</a>(pshmcomm, &amp;loccomm);
<a name="line100">100: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_rank.html#MPI_Comm_rank">MPI_Comm_rank</a>(loccomm, &amp;locrank);
<a name="line101">101: </a>    s_nnodes = !locrank;
<a name="line102">102: </a>    <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Allreduce.html#MPI_Allreduce">MPI_Allreduce</a>(&amp;s_nnodes, &amp;r_nnodes, 1, <a href="../../../../../docs/manualpages/Sys/MPIU_INT.html">MPIU_INT</a>, MPI_SUM, comm);
<a name="line104">104: </a>    devCount = 0;
<a name="line105">105: </a>    cerr     = cudaGetDeviceCount(&amp;devCount);
<a name="line106">106: </a>    cudaGetLastError();                         <font color="#B22222">/* Reset the last error */</font>
<a name="line107">107: </a>    <font color="#4169E1">if</font> (cerr == cudaSuccess &amp;&amp; devCount &gt;= 1) { <font color="#B22222">/* There are devices, else go to heuristic */</font>
<a name="line108">108: </a>      new_new_size = r_nnodes * devCount;
<a name="line109">109: </a>      new_size     = new_new_size;
<a name="line110">110: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: Fine grid with Cuda. %"</font> PetscInt_FMT <font color="#666666">" nodes. Change new active set size %d --&gt; %d (devCount=%d #nodes=%"</font> PetscInt_FMT <font color="#666666">")\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, r_nnodes, nactive, new_size, devCount, r_nnodes);
<a name="line111">111: </a>    } <font color="#4169E1">else</font> {
<a name="line112">112: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: With Cuda but no device. Use heuristics."</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix);
<a name="line113">113: </a>      <font color="#4169E1">goto</font> HEURISTIC;
<a name="line114">114: </a>    }
<a name="line115">115: </a><font color="#A020F0">#else</font>
<a name="line116">116: </a>    <a href="../../../../../docs/manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, PETSC_ERR_PLIB, <font color="#666666">"should not be here"</font>);
<a name="line117">117: </a><font color="#A020F0">#endif</font>
<a name="line118">118: </a>  } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (pc_gamg-&gt;level_reduction_factors[pc_gamg-&gt;current_level] &gt; 0) {
<a name="line120">120: </a>    new_size = nactive / pc_gamg-&gt;level_reduction_factors[pc_gamg-&gt;current_level];
<a name="line121">121: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: Manually setting reduction to %d active processes (%d/%"</font> PetscInt_FMT <font color="#666666">")\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, new_size, nactive, pc_gamg-&gt;level_reduction_factors[pc_gamg-&gt;current_level]);
<a name="line122">122: </a>  } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (is_last &amp;&amp; !pc_gamg-&gt;use_parallel_coarse_grid_solver) {
<a name="line123">123: </a>    new_size = 1;
<a name="line124">124: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: Force coarsest grid reduction to %d active processes\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, new_size);
<a name="line125">125: </a>  } <font color="#4169E1">else</font> {
<a name="line126">126: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> ncrs_eq_glob;
<a name="line127">127: </a><font color="#A020F0">#if defined(PETSC_HAVE_CUDA)</font>
<a name="line128">128: </a><strong><font color="#FF0000">  HEURISTIC:</font></strong>
<a name="line129">129: </a><font color="#A020F0">#endif</font>
<a name="line130">130: </a>    <a href="../../../../../docs/manualpages/Mat/MatGetSize.html">MatGetSize</a>(Cmat, &amp;ncrs_eq_glob, NULL);
<a name="line131">131: </a>    new_size = (<a href="../../../../../docs/manualpages/Sys/PetscMPIInt.html">PetscMPIInt</a>)((float)ncrs_eq_glob / (float)pc_gamg-&gt;min_eq_proc + 0.5); <font color="#B22222">/* hardwire min. number of eq/proc */</font>
<a name="line132">132: </a>    <font color="#4169E1">if</font> (!new_size) new_size = 1;                                                       <font color="#B22222">/* not likely, possible? */</font>
<a name="line133">133: </a>    <font color="#4169E1">else</font> <font color="#4169E1">if</font> (new_size &gt;= nactive) new_size = nactive;                                  <font color="#B22222">/* no change, rare */</font>
<a name="line134">134: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: Coarse grid reduction from %d to %d active processes\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, nactive, new_size);
<a name="line135">135: </a>  }
<a name="line136">136: </a>  <font color="#4169E1">if</font> (new_size == nactive) {
<a name="line137">137: </a>    *a_Amat_crs = Cmat; <font color="#B22222">/* output - no repartitioning or reduction - could bail here */</font>
<a name="line138">138: </a>    <font color="#4169E1">if</font> (new_size &lt; size) {
<a name="line139">139: </a>      <font color="#B22222">/* odd case where multiple coarse grids are on one processor or no coarsening ... */</font>
<a name="line140">140: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: reduced grid using same number of processors (%d) as last grid (use larger coarse grid)\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, nactive);
<a name="line141">141: </a>      <font color="#4169E1">if</font> (pc_gamg-&gt;cpu_pin_coarse_grids) {
<a name="line142">142: </a>        <a href="../../../../../docs/manualpages/Mat/MatBindToCPU.html">MatBindToCPU</a>(*a_Amat_crs, <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>);
<a name="line143">143: </a>        <a href="../../../../../docs/manualpages/Mat/MatBindToCPU.html">MatBindToCPU</a>(*a_P_inout, <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>);
<a name="line144">144: </a>      }
<a name="line145">145: </a>    }
<a name="line146">146: </a>    <font color="#B22222">/* we know that the grid structure can be reused in <a href="../../../../../docs/manualpages/Mat/MatPtAP.html">MatPtAP</a> */</font>
<a name="line147">147: </a>  } <font color="#4169E1">else</font> { <font color="#B22222">/* reduce active processors - we know that the grid structure can NOT be reused in <a href="../../../../../docs/manualpages/Mat/MatPtAP.html">MatPtAP</a> */</font>
<a name="line148">148: </a>    <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> *counts, *newproc_idx, ii, jj, kk, strideNew, *tidx, ncrs_new, ncrs_eq_new, nloc_old, expand_factor = 1, rfactor = 1;
<a name="line149">149: </a>    <a href="../../../../../docs/manualpages/IS/IS.html">IS</a>        is_eq_newproc, is_eq_num, is_eq_num_prim, new_eq_indices;
<a name="line150">150: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>(petsc_gamg_setup_events[GAMG_REDUCE], 0, 0, 0, 0);
<a name="line151">151: </a>    nloc_old = ncrs_eq / cr_bs;
<a name="line153">153: </a>    <font color="#B22222">/* get new_size and rfactor */</font>
<a name="line154">154: </a>    <font color="#4169E1">if</font> (pc_gamg-&gt;layout_type == <a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMG_LAYOUT_SPREAD</a> || !pc_gamg-&gt;repart) {
<a name="line155">155: </a>      <font color="#B22222">/* find factor */</font>
<a name="line156">156: </a>      <font color="#4169E1">if</font> (new_size == 1) rfactor = size; <font color="#B22222">/* don't modify */</font>
<a name="line157">157: </a>      <font color="#4169E1">else</font> {
<a name="line158">158: </a>        <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> best_fact = 0.;
<a name="line159">159: </a>        jj                  = -1;
<a name="line160">160: </a>        <font color="#4169E1">for</font> (kk = 1; kk &lt;= size; kk++) {
<a name="line161">161: </a>          <font color="#4169E1">if</font> (!(size % kk)) { <font color="#B22222">/* a candidate */</font>
<a name="line162">162: </a>            <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> nactpe = (<a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a>)size / (<a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a>)kk, fact = nactpe / (<a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a>)new_size;
<a name="line163">163: </a>            <font color="#4169E1">if</font> (fact &gt; 1.0) fact = 1. / fact; <font color="#B22222">/* keep fact &lt; 1 */</font>
<a name="line164">164: </a>            <font color="#4169E1">if</font> (fact &gt; best_fact) {
<a name="line165">165: </a>              best_fact = fact;
<a name="line166">166: </a>              jj        = kk;
<a name="line167">167: </a>            }
<a name="line168">168: </a>          }
<a name="line169">169: </a>        }
<a name="line170">170: </a>        <font color="#4169E1">if</font> (jj != -1) rfactor = jj;
<a name="line171">171: </a>        <font color="#4169E1">else</font> rfactor = 1; <font color="#B22222">/* a prime */</font>
<a name="line172">172: </a>        <font color="#4169E1">if</font> (pc_gamg-&gt;layout_type == <a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMG_LAYOUT_COMPACT</a>) expand_factor = 1;
<a name="line173">173: </a>        <font color="#4169E1">else</font> expand_factor = rfactor;
<a name="line174">174: </a>      }
<a name="line175">175: </a>      new_size = size / rfactor; <font color="#B22222">/* make new size one that is factor */</font>
<a name="line176">176: </a>      <font color="#4169E1">if</font> (new_size == nactive) { <font color="#B22222">/* no repartitioning or reduction, bail out because nested here (rare) */</font>
<a name="line177">177: </a>        *a_Amat_crs = Cmat;
<a name="line178">178: </a>        <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: Finding factorable processor set stopped reduction: new_size=%d, neq(loc)=%"</font> PetscInt_FMT <font color="#666666">"\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, new_size, ncrs_eq);
<a name="line179">179: </a>        <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_events[GAMG_REDUCE], 0, 0, 0, 0);
<a name="line180">180: </a>        <font color="#4169E1">return</font> 0;
<a name="line181">181: </a>      }
<a name="line182">182: </a>    }
<a name="line183">183: </a>    <font color="#B22222">/* make 'is_eq_newproc' */</font>
<a name="line184">184: </a>    <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>(size, &amp;counts);
<a name="line185">185: </a>    <font color="#4169E1">if</font> (pc_gamg-&gt;repart) { <font color="#B22222">/* Repartition Cmat_{k} and move columns of P^{k}_{k-1} and coordinates of primal part accordingly */</font>
<a name="line186">186: </a>      <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a> adj;
<a name="line187">187: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>(petsc_gamg_setup_events[GAMG_REPART], 0, 0, 0, 0);
<a name="line188">188: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: Repartition: size (active): %d --&gt; %d, %"</font> PetscInt_FMT <font color="#666666">" local equations, using %s process layout\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, *a_nactive_proc, new_size, ncrs_eq, (pc_gamg-&gt;layout_type == <a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMG_LAYOUT_COMPACT</a>) ? <font color="#666666">"compact"</font> : <font color="#666666">"spread"</font>);
<a name="line189">189: </a>      <font color="#B22222">/* get 'adj' */</font>
<a name="line190">190: </a>      <font color="#4169E1">if</font> (cr_bs == 1) {
<a name="line191">191: </a>        <a href="../../../../../docs/manualpages/Mat/MatConvert.html">MatConvert</a>(Cmat, <a href="../../../../../docs/manualpages/Mat/MATMPIADJ.html">MATMPIADJ</a>, <a href="../../../../../docs/manualpages/Mat/MatReuse.html">MAT_INITIAL_MATRIX</a>, &amp;adj);
<a name="line192">192: </a>      } <font color="#4169E1">else</font> {
<a name="line193">193: </a>        <font color="#B22222">/* make a scalar matrix to partition (no Stokes here) */</font>
<a name="line194">194: </a>        <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a>                tMat;
<a name="line195">195: </a>        <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>           Istart_crs, Iend_crs, ncols, jj, Ii;
<a name="line196">196: </a>        const <a href="../../../../../docs/manualpages/Sys/PetscScalar.html">PetscScalar</a> *vals;
<a name="line197">197: </a>        const <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>    *idx;
<a name="line198">198: </a>        <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>          *d_nnz, *o_nnz, M, N;
<a name="line199">199: </a>        static <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>    llev = 0; <font color="#B22222">/* ugly but just used for debugging */</font>
<a name="line200">200: </a>        <a href="../../../../../docs/manualpages/Mat/MatType.html">MatType</a>            mtype;

<a name="line202">202: </a>        <a href="../../../../../docs/manualpages/Sys/PetscMalloc2.html">PetscMalloc2</a>(ncrs, &amp;d_nnz, ncrs, &amp;o_nnz);
<a name="line203">203: </a>        <a href="../../../../../docs/manualpages/Mat/MatGetOwnershipRange.html">MatGetOwnershipRange</a>(Cmat, &amp;Istart_crs, &amp;Iend_crs);
<a name="line204">204: </a>        <a href="../../../../../docs/manualpages/Mat/MatGetSize.html">MatGetSize</a>(Cmat, &amp;M, &amp;N);
<a name="line205">205: </a>        <font color="#4169E1">for</font> (Ii = Istart_crs, jj = 0; Ii &lt; Iend_crs; Ii += cr_bs, jj++) {
<a name="line206">206: </a>          <a href="../../../../../docs/manualpages/Mat/MatGetRow.html">MatGetRow</a>(Cmat, Ii, &amp;ncols, NULL, NULL);
<a name="line207">207: </a>          d_nnz[jj] = ncols / cr_bs;
<a name="line208">208: </a>          o_nnz[jj] = ncols / cr_bs;
<a name="line209">209: </a>          <a href="../../../../../docs/manualpages/Mat/MatRestoreRow.html">MatRestoreRow</a>(Cmat, Ii, &amp;ncols, NULL, NULL);
<a name="line210">210: </a>          <font color="#4169E1">if</font> (d_nnz[jj] &gt; ncrs) d_nnz[jj] = ncrs;
<a name="line211">211: </a>          <font color="#4169E1">if</font> (o_nnz[jj] &gt; (M / cr_bs - ncrs)) o_nnz[jj] = M / cr_bs - ncrs;
<a name="line212">212: </a>        }

<a name="line214">214: </a>        <a href="../../../../../docs/manualpages/Mat/MatGetType.html">MatGetType</a>(Amat_fine, &amp;mtype);
<a name="line215">215: </a>        <a href="../../../../../docs/manualpages/Mat/MatCreate.html">MatCreate</a>(comm, &amp;tMat);
<a name="line216">216: </a>        <a href="../../../../../docs/manualpages/Mat/MatSetSizes.html">MatSetSizes</a>(tMat, ncrs, ncrs, <a href="../../../../../docs/manualpages/Sys/PETSC_DETERMINE.html">PETSC_DETERMINE</a>, <a href="../../../../../docs/manualpages/Sys/PETSC_DETERMINE.html">PETSC_DETERMINE</a>);
<a name="line217">217: </a>        <a href="../../../../../docs/manualpages/Mat/MatSetType.html">MatSetType</a>(tMat, mtype);
<a name="line218">218: </a>        <a href="../../../../../docs/manualpages/Mat/MatSeqAIJSetPreallocation.html">MatSeqAIJSetPreallocation</a>(tMat, 0, d_nnz);
<a name="line219">219: </a>        <a href="../../../../../docs/manualpages/Mat/MatMPIAIJSetPreallocation.html">MatMPIAIJSetPreallocation</a>(tMat, 0, d_nnz, 0, o_nnz);
<a name="line220">220: </a>        <a href="../../../../../docs/manualpages/Sys/PetscFree2.html">PetscFree2</a>(d_nnz, o_nnz);

<a name="line222">222: </a>        <font color="#4169E1">for</font> (ii = Istart_crs; ii &lt; Iend_crs; ii++) {
<a name="line223">223: </a>          <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> dest_row = ii / cr_bs;
<a name="line224">224: </a>          <a href="../../../../../docs/manualpages/Mat/MatGetRow.html">MatGetRow</a>(Cmat, ii, &amp;ncols, &amp;idx, &amp;vals);
<a name="line225">225: </a>          <font color="#4169E1">for</font> (jj = 0; jj &lt; ncols; jj++) {
<a name="line226">226: </a>            <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>    dest_col = idx[jj] / cr_bs;
<a name="line227">227: </a>            <a href="../../../../../docs/manualpages/Sys/PetscScalar.html">PetscScalar</a> v        = 1.0;
<a name="line228">228: </a>            <a href="../../../../../docs/manualpages/Mat/MatSetValues.html">MatSetValues</a>(tMat, 1, &amp;dest_row, 1, &amp;dest_col, &amp;v, <a href="../../../../../docs/manualpages/Sys/ADD_VALUES.html">ADD_VALUES</a>);
<a name="line229">229: </a>          }
<a name="line230">230: </a>          <a href="../../../../../docs/manualpages/Mat/MatRestoreRow.html">MatRestoreRow</a>(Cmat, ii, &amp;ncols, &amp;idx, &amp;vals);
<a name="line231">231: </a>        }
<a name="line232">232: </a>        <a href="../../../../../docs/manualpages/Mat/MatAssemblyBegin.html">MatAssemblyBegin</a>(tMat, <a href="../../../../../docs/manualpages/Mat/MatAssemblyType.html">MAT_FINAL_ASSEMBLY</a>);
<a name="line233">233: </a>        <a href="../../../../../docs/manualpages/Mat/MatAssemblyEnd.html">MatAssemblyEnd</a>(tMat, <a href="../../../../../docs/manualpages/Mat/MatAssemblyType.html">MAT_FINAL_ASSEMBLY</a>);

<a name="line235">235: </a>        <font color="#4169E1">if</font> (llev++ == -1) {
<a name="line236">236: </a>          <a href="../../../../../docs/manualpages/Viewer/PetscViewer.html">PetscViewer</a> viewer;
<a name="line237">237: </a>          char        fname[32];
<a name="line238">238: </a>          <a href="../../../../../docs/manualpages/Sys/PetscSNPrintf.html">PetscSNPrintf</a>(fname, <font color="#4169E1">sizeof</font>(fname), <font color="#666666">"part_mat_%"</font> PetscInt_FMT <font color="#666666">".mat"</font>, llev);
<a name="line239">239: </a>          <a href="../../../../../docs/manualpages/Viewer/PetscViewerBinaryOpen.html">PetscViewerBinaryOpen</a>(comm, fname, <a href="../../../../../docs/manualpages/Sys/PetscFileMode.html">FILE_MODE_WRITE</a>, &amp;viewer);
<a name="line240">240: </a>          <a href="../../../../../docs/manualpages/Mat/MatView.html">MatView</a>(tMat, viewer);
<a name="line241">241: </a>          <a href="../../../../../docs/manualpages/Viewer/PetscViewerDestroy.html">PetscViewerDestroy</a>(&amp;viewer);
<a name="line242">242: </a>        }
<a name="line243">243: </a>        <a href="../../../../../docs/manualpages/Mat/MatConvert.html">MatConvert</a>(tMat, <a href="../../../../../docs/manualpages/Mat/MATMPIADJ.html">MATMPIADJ</a>, <a href="../../../../../docs/manualpages/Mat/MatReuse.html">MAT_INITIAL_MATRIX</a>, &amp;adj);
<a name="line244">244: </a>        <a href="../../../../../docs/manualpages/Mat/MatDestroy.html">MatDestroy</a>(&amp;tMat);
<a name="line245">245: </a>      } <font color="#B22222">/* create 'adj' */</font>

<a name="line247">247: </a>      { <font color="#B22222">/* partition: get newproc_idx */</font>
<a name="line248">248: </a>        char            prefix[256];
<a name="line249">249: </a>        const char     *pcpre;
<a name="line250">250: </a>        const <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> *is_idx;
<a name="line251">251: </a>        <a href="../../../../../docs/manualpages/Mat/MatPartitioning.html">MatPartitioning</a> mpart;
<a name="line252">252: </a>        <a href="../../../../../docs/manualpages/IS/IS.html">IS</a>              proc_is;

<a name="line254">254: </a>        <a href="../../../../../docs/manualpages/MatOrderings/MatPartitioningCreate.html">MatPartitioningCreate</a>(comm, &amp;mpart);
<a name="line255">255: </a>        <a href="../../../../../docs/manualpages/MatOrderings/MatPartitioningSetAdjacency.html">MatPartitioningSetAdjacency</a>(mpart, adj);
<a name="line256">256: </a>        <a href="../../../../../docs/manualpages/PC/PCGetOptionsPrefix.html">PCGetOptionsPrefix</a>(pc, &amp;pcpre);
<a name="line257">257: </a>        <a href="../../../../../docs/manualpages/Sys/PetscSNPrintf.html">PetscSNPrintf</a>(prefix, <font color="#4169E1">sizeof</font>(prefix), <font color="#666666">"%spc_gamg_"</font>, pcpre ? pcpre : <font color="#666666">""</font>);
<a name="line258">258: </a>        <a href="../../../../../docs/manualpages/Sys/PetscObjectSetOptionsPrefix.html">PetscObjectSetOptionsPrefix</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)mpart, prefix);
<a name="line259">259: </a>        <a href="../../../../../docs/manualpages/MatOrderings/MatPartitioningSetFromOptions.html">MatPartitioningSetFromOptions</a>(mpart);
<a name="line260">260: </a>        <a href="../../../../../docs/manualpages/MatOrderings/MatPartitioningSetNParts.html">MatPartitioningSetNParts</a>(mpart, new_size);
<a name="line261">261: </a>        <a href="../../../../../docs/manualpages/MatOrderings/MatPartitioningApply.html">MatPartitioningApply</a>(mpart, &amp;proc_is);
<a name="line262">262: </a>        <a href="../../../../../docs/manualpages/MatOrderings/MatPartitioningDestroy.html">MatPartitioningDestroy</a>(&amp;mpart);

<a name="line264">264: </a>        <font color="#B22222">/* collect <a href="../../../../../docs/manualpages/IS/IS.html">IS</a> info */</font>
<a name="line265">265: </a>        <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>(ncrs_eq, &amp;newproc_idx);
<a name="line266">266: </a>        <a href="../../../../../docs/manualpages/IS/ISGetIndices.html">ISGetIndices</a>(proc_is, &amp;is_idx);
<a name="line267">267: </a>        <font color="#4169E1">for</font> (kk = jj = 0; kk &lt; nloc_old; kk++) {
<a name="line268">268: </a>          <font color="#4169E1">for</font> (ii = 0; ii &lt; cr_bs; ii++, jj++) { newproc_idx[jj] = is_idx[kk] * expand_factor; <font color="#B22222">/* distribution */</font> }
<a name="line269">269: </a>        }
<a name="line270">270: </a>        <a href="../../../../../docs/manualpages/IS/ISRestoreIndices.html">ISRestoreIndices</a>(proc_is, &amp;is_idx);
<a name="line271">271: </a>        <a href="../../../../../docs/manualpages/IS/ISDestroy.html">ISDestroy</a>(&amp;proc_is);
<a name="line272">272: </a>      }
<a name="line273">273: </a>      <a href="../../../../../docs/manualpages/Mat/MatDestroy.html">MatDestroy</a>(&amp;adj);

<a name="line275">275: </a>      <a href="../../../../../docs/manualpages/IS/ISCreateGeneral.html">ISCreateGeneral</a>(comm, ncrs_eq, newproc_idx, <a href="../../../../../docs/manualpages/Sys/PetscCopyMode.html">PETSC_COPY_VALUES</a>, &amp;is_eq_newproc);
<a name="line276">276: </a>      <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(newproc_idx);
<a name="line277">277: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_events[GAMG_REPART], 0, 0, 0, 0);
<a name="line278">278: </a>    } <font color="#4169E1">else</font> { <font color="#B22222">/* simple aggregation of parts -- 'is_eq_newproc' */</font>
<a name="line279">279: </a>      <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> targetPE;
<a name="line281">281: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: Number of equations (loc) %"</font> PetscInt_FMT <font color="#666666">" with simple aggregation\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, ncrs_eq);
<a name="line282">282: </a>      targetPE = (rank / rfactor) * expand_factor;
<a name="line283">283: </a>      <a href="../../../../../docs/manualpages/IS/ISCreateStride.html">ISCreateStride</a>(comm, ncrs_eq, targetPE, 0, &amp;is_eq_newproc);
<a name="line284">284: </a>    } <font color="#B22222">/* end simple 'is_eq_newproc' */</font>

<a name="line286">286: </a>    <font color="#B22222">/*</font>
<a name="line287">287: </a><font color="#B22222">      Create an index set from the is_eq_newproc index set to indicate the mapping TO</font>
<a name="line288">288: </a><font color="#B22222">    */</font>
<a name="line289">289: </a>    <a href="../../../../../docs/manualpages/IS/ISPartitioningToNumbering.html">ISPartitioningToNumbering</a>(is_eq_newproc, &amp;is_eq_num);
<a name="line290">290: </a>    is_eq_num_prim = is_eq_num;
<a name="line291">291: </a>    <font color="#B22222">/*</font>
<a name="line292">292: </a><font color="#B22222">      Determine how many equations/vertices are assigned to each processor</font>
<a name="line293">293: </a><font color="#B22222">    */</font>
<a name="line294">294: </a>    <a href="../../../../../docs/manualpages/IS/ISPartitioningCount.html">ISPartitioningCount</a>(is_eq_newproc, size, counts);
<a name="line295">295: </a>    ncrs_eq_new = counts[rank];
<a name="line296">296: </a>    <a href="../../../../../docs/manualpages/IS/ISDestroy.html">ISDestroy</a>(&amp;is_eq_newproc);
<a name="line297">297: </a>    ncrs_new = ncrs_eq_new / cr_bs;

<a name="line299">299: </a>    <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(counts);
<a name="line300">300: </a>    <font color="#B22222">/* data movement scope -- this could be moved to subclasses so that we don't try to cram all auxiliary data into some complex abstracted thing */</font>
<a name="line301">301: </a>    {
<a name="line302">302: </a>      <a href="../../../../../docs/manualpages/Vec/Vec.html">Vec</a>             src_crd, dest_crd;
<a name="line303">303: </a>      const <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> *idx, ndata_rows = pc_gamg-&gt;data_cell_rows, ndata_cols = pc_gamg-&gt;data_cell_cols, node_data_sz = ndata_rows * ndata_cols;
<a name="line304">304: </a>      <a href="../../../../../docs/manualpages/PetscSF/VecScatter.html">VecScatter</a>      vecscat;
<a name="line305">305: </a>      <a href="../../../../../docs/manualpages/Sys/PetscScalar.html">PetscScalar</a>    *array;
<a name="line306">306: </a>      <a href="../../../../../docs/manualpages/IS/IS.html">IS</a>              isscat;
<a name="line307">307: </a>      <font color="#B22222">/* move data (for primal equations only) */</font>
<a name="line308">308: </a>      <font color="#B22222">/* Create a vector to contain the newly ordered element information */</font>
<a name="line309">309: </a>      <a href="../../../../../docs/manualpages/Vec/VecCreate.html">VecCreate</a>(comm, &amp;dest_crd);
<a name="line310">310: </a>      <a href="../../../../../docs/manualpages/Vec/VecSetSizes.html">VecSetSizes</a>(dest_crd, node_data_sz * ncrs_new, <a href="../../../../../docs/manualpages/Sys/PETSC_DECIDE.html">PETSC_DECIDE</a>);
<a name="line311">311: </a>      <a href="../../../../../docs/manualpages/Vec/VecSetType.html">VecSetType</a>(dest_crd, <a href="../../../../../docs/manualpages/Vec/VECSTANDARD.html">VECSTANDARD</a>); <font color="#B22222">/* this is needed! */</font>
<a name="line312">312: </a>      <font color="#B22222">/*</font>
<a name="line313">313: </a><font color="#B22222">        There are 'ndata_rows*ndata_cols' data items per node, (one can think of the vectors of having</font>
<a name="line314">314: </a><font color="#B22222">        a block size of ...).  Note, ISs are expanded into equation space by 'cr_bs'.</font>
<a name="line315">315: </a><font color="#B22222">      */</font>
<a name="line316">316: </a>      <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>(ncrs * node_data_sz, &amp;tidx);
<a name="line317">317: </a>      <a href="../../../../../docs/manualpages/IS/ISGetIndices.html">ISGetIndices</a>(is_eq_num_prim, &amp;idx);
<a name="line318">318: </a>      <font color="#4169E1">for</font> (ii = 0, jj = 0; ii &lt; ncrs; ii++) {
<a name="line319">319: </a>        <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> id = idx[ii * cr_bs] / cr_bs; <font color="#B22222">/* get node back */</font>
<a name="line320">320: </a>        <font color="#4169E1">for</font> (kk = 0; kk &lt; node_data_sz; kk++, jj++) tidx[jj] = id * node_data_sz + kk;
<a name="line321">321: </a>      }
<a name="line322">322: </a>      <a href="../../../../../docs/manualpages/IS/ISRestoreIndices.html">ISRestoreIndices</a>(is_eq_num_prim, &amp;idx);
<a name="line323">323: </a>      <a href="../../../../../docs/manualpages/IS/ISCreateGeneral.html">ISCreateGeneral</a>(comm, node_data_sz * ncrs, tidx, <a href="../../../../../docs/manualpages/Sys/PetscCopyMode.html">PETSC_COPY_VALUES</a>, &amp;isscat);
<a name="line324">324: </a>      <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(tidx);
<a name="line325">325: </a>      <font color="#B22222">/*</font>
<a name="line326">326: </a><font color="#B22222">        Create a vector to contain the original vertex information for each element</font>
<a name="line327">327: </a><font color="#B22222">      */</font>
<a name="line328">328: </a>      <a href="../../../../../docs/manualpages/Vec/VecCreateSeq.html">VecCreateSeq</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, node_data_sz * ncrs, &amp;src_crd);
<a name="line329">329: </a>      <font color="#4169E1">for</font> (jj = 0; jj &lt; ndata_cols; jj++) {
<a name="line330">330: </a>        const <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> stride0 = ncrs * pc_gamg-&gt;data_cell_rows;
<a name="line331">331: </a>        <font color="#4169E1">for</font> (ii = 0; ii &lt; ncrs; ii++) {
<a name="line332">332: </a>          <font color="#4169E1">for</font> (kk = 0; kk &lt; ndata_rows; kk++) {
<a name="line333">333: </a>            <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>    ix = ii * ndata_rows + kk + jj * stride0, jx = ii * node_data_sz + kk * ndata_cols + jj;
<a name="line334">334: </a>            <a href="../../../../../docs/manualpages/Sys/PetscScalar.html">PetscScalar</a> tt = (<a href="../../../../../docs/manualpages/Sys/PetscScalar.html">PetscScalar</a>)pc_gamg-&gt;data[ix];
<a name="line335">335: </a>            <a href="../../../../../docs/manualpages/Vec/VecSetValues.html">VecSetValues</a>(src_crd, 1, &amp;jx, &amp;tt, <a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html">INSERT_VALUES</a>);
<a name="line336">336: </a>          }
<a name="line337">337: </a>        }
<a name="line338">338: </a>      }
<a name="line339">339: </a>      <a href="../../../../../docs/manualpages/Vec/VecAssemblyBegin.html">VecAssemblyBegin</a>(src_crd);
<a name="line340">340: </a>      <a href="../../../../../docs/manualpages/Vec/VecAssemblyEnd.html">VecAssemblyEnd</a>(src_crd);
<a name="line341">341: </a>      <font color="#B22222">/*</font>
<a name="line342">342: </a><font color="#B22222">        Scatter the element vertex information (still in the original vertex ordering)</font>
<a name="line343">343: </a><font color="#B22222">        to the correct processor</font>
<a name="line344">344: </a><font color="#B22222">      */</font>
<a name="line345">345: </a>      <a href="../../../../../docs/manualpages/PetscSF/VecScatterCreate.html">VecScatterCreate</a>(src_crd, NULL, dest_crd, isscat, &amp;vecscat);
<a name="line346">346: </a>      <a href="../../../../../docs/manualpages/IS/ISDestroy.html">ISDestroy</a>(&amp;isscat);
<a name="line347">347: </a>      <a href="../../../../../docs/manualpages/PetscSF/VecScatterBegin.html">VecScatterBegin</a>(vecscat, src_crd, dest_crd, <a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html">INSERT_VALUES</a>, <a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html">SCATTER_FORWARD</a>);
<a name="line348">348: </a>      <a href="../../../../../docs/manualpages/PetscSF/VecScatterEnd.html">VecScatterEnd</a>(vecscat, src_crd, dest_crd, <a href="../../../../../docs/manualpages/Sys/INSERT_VALUES.html">INSERT_VALUES</a>, <a href="../../../../../docs/manualpages/Vec/SCATTER_FORWARD.html">SCATTER_FORWARD</a>);
<a name="line349">349: </a>      <a href="../../../../../docs/manualpages/PetscSF/VecScatterDestroy.html">VecScatterDestroy</a>(&amp;vecscat);
<a name="line350">350: </a>      <a href="../../../../../docs/manualpages/Vec/VecDestroy.html">VecDestroy</a>(&amp;src_crd);
<a name="line351">351: </a>      <font color="#B22222">/*</font>
<a name="line352">352: </a><font color="#B22222">        Put the element vertex data into a new allocation of the gdata-&gt;ele</font>
<a name="line353">353: </a><font color="#B22222">      */</font>
<a name="line354">354: </a>      <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(pc_gamg-&gt;data);
<a name="line355">355: </a>      <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>(node_data_sz * ncrs_new, &amp;pc_gamg-&gt;data);

<a name="line357">357: </a>      pc_gamg-&gt;data_sz = node_data_sz * ncrs_new;
<a name="line358">358: </a>      strideNew        = ncrs_new * ndata_rows;

<a name="line360">360: </a>      <a href="../../../../../docs/manualpages/Vec/VecGetArray.html">VecGetArray</a>(dest_crd, &amp;array);
<a name="line361">361: </a>      <font color="#4169E1">for</font> (jj = 0; jj &lt; ndata_cols; jj++) {
<a name="line362">362: </a>        <font color="#4169E1">for</font> (ii = 0; ii &lt; ncrs_new; ii++) {
<a name="line363">363: </a>          <font color="#4169E1">for</font> (kk = 0; kk &lt; ndata_rows; kk++) {
<a name="line364">364: </a>            <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> ix = ii * ndata_rows + kk + jj * strideNew, jx = ii * node_data_sz + kk * ndata_cols + jj;
<a name="line365">365: </a>            pc_gamg-&gt;data[ix] = <a href="../../../../../docs/manualpages/Sys/PetscRealPart.html">PetscRealPart</a>(array[jx]);
<a name="line366">366: </a>          }
<a name="line367">367: </a>        }
<a name="line368">368: </a>      }
<a name="line369">369: </a>      <a href="../../../../../docs/manualpages/Vec/VecRestoreArray.html">VecRestoreArray</a>(dest_crd, &amp;array);
<a name="line370">370: </a>      <a href="../../../../../docs/manualpages/Vec/VecDestroy.html">VecDestroy</a>(&amp;dest_crd);
<a name="line371">371: </a>    }
<a name="line372">372: </a>    <font color="#B22222">/* move A and P (columns) with new layout */</font>
<a name="line373">373: </a>    <font color="#B22222">/* <a href="../../../../../docs/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>(petsc_gamg_setup_events[SET13],0,0,0,0); */</font>
<a name="line374">374: </a>    <font color="#B22222">/*</font>
<a name="line375">375: </a><font color="#B22222">      Invert for <a href="../../../../../docs/manualpages/Mat/MatCreateSubMatrix.html">MatCreateSubMatrix</a></font>
<a name="line376">376: </a><font color="#B22222">    */</font>
<a name="line377">377: </a>    <a href="../../../../../docs/manualpages/IS/ISInvertPermutation.html">ISInvertPermutation</a>(is_eq_num, ncrs_eq_new, &amp;new_eq_indices);
<a name="line378">378: </a>    <a href="../../../../../docs/manualpages/IS/ISSort.html">ISSort</a>(new_eq_indices); <font color="#B22222">/* is this needed? */</font>
<a name="line379">379: </a>    <a href="../../../../../docs/manualpages/IS/ISSetBlockSize.html">ISSetBlockSize</a>(new_eq_indices, cr_bs);
<a name="line380">380: </a>    <font color="#4169E1">if</font> (is_eq_num != is_eq_num_prim) { <a href="../../../../../docs/manualpages/IS/ISDestroy.html">ISDestroy</a>(&amp;is_eq_num_prim); <font color="#B22222">/* could be same as 'is_eq_num' */</font> }
<a name="line381">381: </a>    <font color="#4169E1">if</font> (Pcolumnperm) {
<a name="line382">382: </a>      <a href="../../../../../docs/manualpages/Sys/PetscObjectReference.html">PetscObjectReference</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)new_eq_indices);
<a name="line383">383: </a>      *Pcolumnperm = new_eq_indices;
<a name="line384">384: </a>    }
<a name="line385">385: </a>    <a href="../../../../../docs/manualpages/IS/ISDestroy.html">ISDestroy</a>(&amp;is_eq_num);
<a name="line386">386: </a>    <font color="#B22222">/* <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_events[SET13],0,0,0,0); */</font>
<a name="line387">387: </a>    <font color="#B22222">/* <a href="../../../../../docs/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>(petsc_gamg_setup_events[SET14],0,0,0,0); */</font>

<a name="line389">389: </a>    <font color="#B22222">/* 'a_Amat_crs' output */</font>
<a name="line390">390: </a>    {
<a name="line391">391: </a>      <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a>       mat;
<a name="line392">392: </a>      <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> isset, isspd, isher;
<a name="line393">393: </a><font color="#A020F0">#if !defined(PETSC_USE_COMPLEX)</font>
<a name="line394">394: </a>      <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> issym;
<a name="line395">395: </a><font color="#A020F0">#endif</font>

<a name="line397">397: </a>      <a href="../../../../../docs/manualpages/Mat/MatCreateSubMatrix.html">MatCreateSubMatrix</a>(Cmat, new_eq_indices, new_eq_indices, <a href="../../../../../docs/manualpages/Mat/MatReuse.html">MAT_INITIAL_MATRIX</a>, &amp;mat);
<a name="line398">398: </a>      <a href="../../../../../docs/manualpages/Mat/MatIsSPDKnown.html">MatIsSPDKnown</a>(Cmat, &amp;isset, &amp;isspd); // like <a href="../../../../../docs/manualpages/Mat/MatPropagateSymmetryOptions.html">MatPropagateSymmetryOptions</a>, but should set <a href="../../../../../docs/manualpages/Mat/MatOption.html">MAT_STRUCTURALLY_SYMMETRIC</a> ?
<a name="line399">399: </a>      <font color="#4169E1">if</font> (isset) <a href="../../../../../docs/manualpages/Mat/MatSetOption.html">MatSetOption</a>(mat, <a href="../../../../../docs/manualpages/Mat/MatOption.html">MAT_SPD</a>, isspd);
<a name="line400">400: </a>      <font color="#4169E1">else</font> {
<a name="line401">401: </a>        <a href="../../../../../docs/manualpages/Mat/MatIsHermitianKnown.html">MatIsHermitianKnown</a>(Cmat, &amp;isset, &amp;isher);
<a name="line402">402: </a>        <font color="#4169E1">if</font> (isset) <a href="../../../../../docs/manualpages/Mat/MatSetOption.html">MatSetOption</a>(mat, <a href="../../../../../docs/manualpages/Mat/MatOption.html">MAT_HERMITIAN</a>, isher);
<a name="line403">403: </a>        <font color="#4169E1">else</font> {
<a name="line404">404: </a><font color="#A020F0">#if !defined(PETSC_USE_COMPLEX)</font>
<a name="line405">405: </a>          <a href="../../../../../docs/manualpages/Mat/MatIsSymmetricKnown.html">MatIsSymmetricKnown</a>(Cmat, &amp;isset, &amp;issym);
<a name="line406">406: </a>          <font color="#4169E1">if</font> (isset) <a href="../../../../../docs/manualpages/Mat/MatSetOption.html">MatSetOption</a>(mat, <a href="../../../../../docs/manualpages/Mat/MatOption.html">MAT_SYMMETRIC</a>, issym);
<a name="line407">407: </a><font color="#A020F0">#endif</font>
<a name="line408">408: </a>        }
<a name="line409">409: </a>      }
<a name="line410">410: </a>      *a_Amat_crs = mat;
<a name="line411">411: </a>    }
<a name="line412">412: </a>    <a href="../../../../../docs/manualpages/Mat/MatDestroy.html">MatDestroy</a>(&amp;Cmat);

<a name="line414">414: </a>    <font color="#B22222">/* <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_events[SET14],0,0,0,0); */</font>
<a name="line415">415: </a>    <font color="#B22222">/* prolongator */</font>
<a name="line416">416: </a>    {
<a name="line417">417: </a>      <a href="../../../../../docs/manualpages/IS/IS.html">IS</a>       findices;
<a name="line418">418: </a>      <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> Istart, Iend;
<a name="line419">419: </a>      <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a>      Pnew;

<a name="line421">421: </a>      <a href="../../../../../docs/manualpages/Mat/MatGetOwnershipRange.html">MatGetOwnershipRange</a>(Pold, &amp;Istart, &amp;Iend);
<a name="line422">422: </a>      <font color="#B22222">/* <a href="../../../../../docs/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>(petsc_gamg_setup_events[SET15],0,0,0,0); */</font>
<a name="line423">423: </a>      <a href="../../../../../docs/manualpages/IS/ISCreateStride.html">ISCreateStride</a>(comm, Iend - Istart, Istart, 1, &amp;findices);
<a name="line424">424: </a>      <a href="../../../../../docs/manualpages/IS/ISSetBlockSize.html">ISSetBlockSize</a>(findices, f_bs);
<a name="line425">425: </a>      <a href="../../../../../docs/manualpages/Mat/MatCreateSubMatrix.html">MatCreateSubMatrix</a>(Pold, findices, new_eq_indices, <a href="../../../../../docs/manualpages/Mat/MatReuse.html">MAT_INITIAL_MATRIX</a>, &amp;Pnew);
<a name="line426">426: </a>      <a href="../../../../../docs/manualpages/IS/ISDestroy.html">ISDestroy</a>(&amp;findices);
<a name="line427">427: </a>      <a href="../../../../../docs/manualpages/Mat/MatSetOption.html">MatSetOption</a>(Pnew, <a href="../../../../../docs/manualpages/Mat/MatOption.html">MAT_FORM_EXPLICIT_TRANSPOSE</a>, <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>);

<a name="line429">429: </a>      <font color="#B22222">/* <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_events[SET15],0,0,0,0); */</font>
<a name="line430">430: </a>      <a href="../../../../../docs/manualpages/Mat/MatDestroy.html">MatDestroy</a>(a_P_inout);

<a name="line432">432: </a>      <font color="#B22222">/* output - repartitioned */</font>
<a name="line433">433: </a>      *a_P_inout = Pnew;
<a name="line434">434: </a>    }
<a name="line435">435: </a>    <a href="../../../../../docs/manualpages/IS/ISDestroy.html">ISDestroy</a>(&amp;new_eq_indices);

<a name="line437">437: </a>    *a_nactive_proc = new_size; <font color="#B22222">/* output */</font>

<a name="line439">439: </a>    <font color="#B22222">/* pinning on reduced grids, not a bad heuristic and optimization gets folded into process reduction optimization */</font>
<a name="line440">440: </a>    <font color="#4169E1">if</font> (pc_gamg-&gt;cpu_pin_coarse_grids) {
<a name="line441">441: </a><font color="#A020F0">#if defined(PETSC_HAVE_VIENNACL) || defined(PETSC_HAVE_CUDA)</font>
<a name="line442">442: </a>      static <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> llev = 2;
<a name="line443">443: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: Pinning level %"</font> PetscInt_FMT <font color="#666666">" to the CPU\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, llev++);
<a name="line444">444: </a><font color="#A020F0">#endif</font>
<a name="line445">445: </a>      <a href="../../../../../docs/manualpages/Mat/MatBindToCPU.html">MatBindToCPU</a>(*a_Amat_crs, <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>);
<a name="line446">446: </a>      <a href="../../../../../docs/manualpages/Mat/MatBindToCPU.html">MatBindToCPU</a>(*a_P_inout, <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>);
<a name="line447">447: </a>      <font color="#4169E1">if</font> (1) { <font color="#B22222">/* HACK: move this to MatBindCPU_MPIAIJXXX; lvec is created, need to pin it, this is done in MatSetUpMultiply_MPIAIJ. Hack */</font>
<a name="line448">448: </a>        <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a>         A = *a_Amat_crs, P = *a_P_inout;
<a name="line449">449: </a>        <a href="../../../../../docs/manualpages/Sys/PetscMPIInt.html">PetscMPIInt</a> size;
<a name="line450">450: </a>        <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_size.html#MPI_Comm_size">MPI_Comm_size</a>(<a href="../../../../../docs/manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)A), &amp;size);
<a name="line451">451: </a>        <font color="#4169E1">if</font> (size &gt; 1) {
<a name="line452">452: </a>          Mat_MPIAIJ *a = (Mat_MPIAIJ *)A-&gt;data, *p = (Mat_MPIAIJ *)P-&gt;data;
<a name="line453">453: </a>          <a href="../../../../../docs/manualpages/Vec/VecBindToCPU.html">VecBindToCPU</a>(a-&gt;lvec, <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>);
<a name="line454">454: </a>          <a href="../../../../../docs/manualpages/Vec/VecBindToCPU.html">VecBindToCPU</a>(p-&gt;lvec, <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>);
<a name="line455">455: </a>        }
<a name="line456">456: </a>      }
<a name="line457">457: </a>    }
<a name="line458">458: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_events[GAMG_REDUCE], 0, 0, 0, 0);
<a name="line459">459: </a>  } // processor reduce
<a name="line460">460: </a>  <font color="#4169E1">return</font> 0;
<a name="line461">461: </a>}

<a name="line463">463: </a>// used in GEO
<a name="line464">464: </a><strong><font color="#4169E1"><a name="PCGAMGSquareGraph_GAMG"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSquareGraph_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> a_pc, <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a> Gmat1, <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a> *Gmat2)</font></strong>
<a name="line465">465: </a>{
<a name="line466">466: </a>  const char *prefix;
<a name="line467">467: </a>  char        addp[32];
<a name="line468">468: </a>  PC_MG      *mg      = (PC_MG *)a_pc-&gt;data;
<a name="line469">469: </a>  PC_GAMG    *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line471">471: </a>  <a href="../../../../../docs/manualpages/PC/PCGetOptionsPrefix.html">PCGetOptionsPrefix</a>(a_pc, &amp;prefix);
<a name="line472">472: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(a_pc, <font color="#666666">"%s: Square Graph on level %"</font> PetscInt_FMT <font color="#666666">"\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)a_pc)-&gt;prefix, pc_gamg-&gt;current_level + 1);
<a name="line473">473: </a>  <a href="../../../../../docs/manualpages/Mat/MatProductCreate.html">MatProductCreate</a>(Gmat1, Gmat1, NULL, Gmat2);
<a name="line474">474: </a>  <a href="../../../../../docs/manualpages/Mat/MatSetOptionsPrefix.html">MatSetOptionsPrefix</a>(*Gmat2, prefix);
<a name="line475">475: </a>  <a href="../../../../../docs/manualpages/Sys/PetscSNPrintf.html">PetscSNPrintf</a>(addp, <font color="#4169E1">sizeof</font>(addp), <font color="#666666">"pc_gamg_square_%"</font> PetscInt_FMT <font color="#666666">"_"</font>, pc_gamg-&gt;current_level);
<a name="line476">476: </a>  <a href="../../../../../docs/manualpages/Mat/MatAppendOptionsPrefix.html">MatAppendOptionsPrefix</a>(*Gmat2, addp);
<a name="line477">477: </a>  <font color="#4169E1">if</font> ((*Gmat2)-&gt;structurally_symmetric == <a href="../../../../../docs/manualpages/Sys/PetscBool3.html">PETSC_BOOL3_TRUE</a>) {
<a name="line478">478: </a>    <a href="../../../../../docs/manualpages/Mat/MatProductSetType.html">MatProductSetType</a>(*Gmat2, <a href="../../../../../docs/manualpages/Mat/MatProductType.html">MATPRODUCT_AB</a>);
<a name="line479">479: </a>  } <font color="#4169E1">else</font> {
<a name="line480">480: </a>    <a href="../../../../../docs/manualpages/Mat/MatSetOption.html">MatSetOption</a>(Gmat1, <a href="../../../../../docs/manualpages/Mat/MatOption.html">MAT_FORM_EXPLICIT_TRANSPOSE</a>, <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>);
<a name="line481">481: </a>    <a href="../../../../../docs/manualpages/Mat/MatProductSetType.html">MatProductSetType</a>(*Gmat2, <a href="../../../../../docs/manualpages/Mat/MatProductType.html">MATPRODUCT_AtB</a>);
<a name="line482">482: </a>  }
<a name="line483">483: </a>  <a href="../../../../../docs/manualpages/Mat/MatProductSetFromOptions.html">MatProductSetFromOptions</a>(*Gmat2);
<a name="line484">484: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>(petsc_gamg_setup_matmat_events[pc_gamg-&gt;current_level][0], 0, 0, 0, 0);
<a name="line485">485: </a>  <a href="../../../../../docs/manualpages/Mat/MatProductSymbolic.html">MatProductSymbolic</a>(*Gmat2);
<a name="line486">486: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_matmat_events[pc_gamg-&gt;current_level][0], 0, 0, 0, 0);
<a name="line487">487: </a>  <a href="../../../../../docs/manualpages/Mat/MatProductClear.html">MatProductClear</a>(*Gmat2);
<a name="line488">488: </a>  <font color="#B22222">/* we only need the sparsity, cheat and tell PETSc the matrix has been assembled */</font>
<a name="line489">489: </a>  (*Gmat2)-&gt;assembled = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>;
<a name="line490">490: </a>  <font color="#4169E1">return</font> 0;
<a name="line491">491: </a>}

<a name="line493">493: </a><font color="#B22222">/*</font>
<a name="line494">494: </a><font color="#B22222">   PCSetUp_GAMG - Prepares for the use of the GAMG preconditioner</font>
<a name="line495">495: </a><font color="#B22222">                    by setting data structures and options.</font>

<a name="line497">497: </a><font color="#B22222">   Input Parameter:</font>
<a name="line498">498: </a><font color="#B22222">.  pc - the preconditioner context</font>

<a name="line500">500: </a><font color="#B22222">*/</font>
<a name="line501">501: </a><strong><font color="#4169E1"><a name="PCSetUp_GAMG"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCSetUp_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc)</font></strong>
<a name="line502">502: </a>{
<a name="line503">503: </a>  PC_MG         *mg      = (PC_MG *)pc-&gt;data;
<a name="line504">504: </a>  PC_GAMG       *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;
<a name="line505">505: </a>  <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a>            Pmat    = pc-&gt;pmat;
<a name="line506">506: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>       fine_level, level, level1, bs, M, N, qq, lidx, nASMBlocksArr[PETSC_MG_MAXLEVELS];
<a name="line507">507: </a>  <a href="../../../../../docs/manualpages/Sys/MPI_Comm.html">MPI_Comm</a>       comm;
<a name="line508">508: </a>  <a href="../../../../../docs/manualpages/Sys/PetscMPIInt.html">PetscMPIInt</a>    rank, size, nactivepe;
<a name="line509">509: </a>  <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a>            Aarr[PETSC_MG_MAXLEVELS], Parr[PETSC_MG_MAXLEVELS];
<a name="line510">510: </a>  <a href="../../../../../docs/manualpages/IS/IS.html">IS</a>            *ASMLocalIDsArr[PETSC_MG_MAXLEVELS];
<a name="line511">511: </a>  <a href="../../../../../docs/manualpages/Sys/PetscLogDouble.html">PetscLogDouble</a> nnz0 = 0., nnztot = 0.;
<a name="line512">512: </a>  <a href="../../../../../docs/manualpages/Mat/MatInfo.html">MatInfo</a>        info;
<a name="line513">513: </a>  <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a>      is_last = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>;

<a name="line515">515: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectGetComm.html">PetscObjectGetComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, &amp;comm);
<a name="line516">516: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_rank.html#MPI_Comm_rank">MPI_Comm_rank</a>(comm, &amp;rank);
<a name="line517">517: </a>  <a href="http://www.mpich.org/static/docs/latest/www3/MPI_Comm_size.html#MPI_Comm_size">MPI_Comm_size</a>(comm, &amp;size);
<a name="line518">518: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>(petsc_gamg_setup_events[GAMG_SETUP], 0, 0, 0, 0);
<a name="line519">519: </a>  <font color="#4169E1">if</font> (pc-&gt;setupcalled) {
<a name="line520">520: </a>    <font color="#4169E1">if</font> (!pc_gamg-&gt;reuse_prol || pc-&gt;flag == <a href="../../../../../docs/manualpages/Mat/MatStructure.html">DIFFERENT_NONZERO_PATTERN</a>) {
<a name="line521">521: </a>      <font color="#B22222">/* reset everything */</font>
<a name="line522">522: </a>      PCReset_MG(pc);
<a name="line523">523: </a>      pc-&gt;setupcalled = 0;
<a name="line524">524: </a>    } <font color="#4169E1">else</font> {
<a name="line525">525: </a>      PC_MG_Levels **mglevels = mg-&gt;levels;
<a name="line526">526: </a>      <font color="#B22222">/* just do Galerkin grids */</font>
<a name="line527">527: </a>      <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a> B, dA, dB;
<a name="line528">528: </a>      <font color="#4169E1">if</font> (pc_gamg-&gt;Nlevels &gt; 1) {
<a name="line529">529: </a>        <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> gl;
<a name="line530">530: </a>        <font color="#B22222">/* currently only handle case where mat and pmat are the same on coarser levels */</font>
<a name="line531">531: </a>        <a href="../../../../../docs/manualpages/KSP/KSPGetOperators.html">KSPGetOperators</a>(mglevels[pc_gamg-&gt;Nlevels - 1]-&gt;smoothd, &amp;dA, &amp;dB);
<a name="line532">532: </a>        <font color="#B22222">/* (re)set to get dirty flag */</font>
<a name="line533">533: </a>        <a href="../../../../../docs/manualpages/KSP/KSPSetOperators.html">KSPSetOperators</a>(mglevels[pc_gamg-&gt;Nlevels - 1]-&gt;smoothd, dA, dB);

<a name="line535">535: </a>        <font color="#4169E1">for</font> (level = pc_gamg-&gt;Nlevels - 2, gl = 0; level &gt;= 0; level--, gl++) {
<a name="line536">536: </a>          <a href="../../../../../docs/manualpages/Mat/MatReuse.html">MatReuse</a> reuse = <a href="../../../../../docs/manualpages/Mat/MatReuse.html">MAT_INITIAL_MATRIX</a>;
<a name="line537">537: </a><font color="#A020F0">#if defined(GAMG_STAGES)</font>
<a name="line538">538: </a>          <a href="../../../../../docs/manualpages/Profiling/PetscLogStagePush.html">PetscLogStagePush</a>(gamg_stages[gl]);
<a name="line539">539: </a><font color="#A020F0">#endif</font>
<a name="line540">540: </a>          <font color="#B22222">/* matrix structure can change from repartitioning or process reduction but don't know if we have process reduction here. Should fix */</font>
<a name="line541">541: </a>          <a href="../../../../../docs/manualpages/KSP/KSPGetOperators.html">KSPGetOperators</a>(mglevels[level]-&gt;smoothd, NULL, &amp;B);
<a name="line542">542: </a>          <font color="#4169E1">if</font> (B-&gt;product) {
<a name="line543">543: </a>            <font color="#4169E1">if</font> (B-&gt;product-&gt;A == dB &amp;&amp; B-&gt;product-&gt;B == mglevels[level + 1]-&gt;interpolate) reuse = <a href="../../../../../docs/manualpages/Mat/MatReuse.html">MAT_REUSE_MATRIX</a>;
<a name="line544">544: </a>          }
<a name="line545">545: </a>          <font color="#4169E1">if</font> (reuse == <a href="../../../../../docs/manualpages/Mat/MatReuse.html">MAT_INITIAL_MATRIX</a>) <a href="../../../../../docs/manualpages/Mat/MatDestroy.html">MatDestroy</a>(&amp;mglevels[level]-&gt;A);
<a name="line546">546: </a>          <font color="#4169E1">if</font> (reuse == <a href="../../../../../docs/manualpages/Mat/MatReuse.html">MAT_REUSE_MATRIX</a>) {
<a name="line547">547: </a>            <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: RAP after first solve, reuse matrix level %"</font> PetscInt_FMT <font color="#666666">"\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, level);
<a name="line548">548: </a>          } <font color="#4169E1">else</font> {
<a name="line549">549: </a>            <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: RAP after first solve, new matrix level %"</font> PetscInt_FMT <font color="#666666">"\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, level);
<a name="line550">550: </a>          }
<a name="line551">551: </a>          <a href="../../../../../docs/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>(petsc_gamg_setup_matmat_events[gl][1], 0, 0, 0, 0);
<a name="line552">552: </a>          <a href="../../../../../docs/manualpages/Mat/MatPtAP.html">MatPtAP</a>(dB, mglevels[level + 1]-&gt;interpolate, reuse, <a href="../../../../../docs/manualpages/Sys/PETSC_DEFAULT.html">PETSC_DEFAULT</a>, &amp;B);
<a name="line553">553: </a>          <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_matmat_events[gl][1], 0, 0, 0, 0);
<a name="line554">554: </a>          <font color="#4169E1">if</font> (reuse == <a href="../../../../../docs/manualpages/Mat/MatReuse.html">MAT_INITIAL_MATRIX</a>) mglevels[level]-&gt;A = B;
<a name="line555">555: </a>          <a href="../../../../../docs/manualpages/KSP/KSPSetOperators.html">KSPSetOperators</a>(mglevels[level]-&gt;smoothd, B, B);
<a name="line556">556: </a>          dB = B;
<a name="line557">557: </a><font color="#A020F0">#if defined(GAMG_STAGES)</font>
<a name="line558">558: </a>          <a href="../../../../../docs/manualpages/Profiling/PetscLogStagePop.html">PetscLogStagePop</a>();
<a name="line559">559: </a><font color="#A020F0">#endif</font>
<a name="line560">560: </a>        }
<a name="line561">561: </a>      }

<a name="line563">563: </a>      PCSetUp_MG(pc);
<a name="line564">564: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_events[GAMG_SETUP], 0, 0, 0, 0);
<a name="line565">565: </a>      <font color="#4169E1">return</font> 0;
<a name="line566">566: </a>    }
<a name="line567">567: </a>  }

<a name="line569">569: </a>  <font color="#4169E1">if</font> (!pc_gamg-&gt;data) {
<a name="line570">570: </a>    <font color="#4169E1">if</font> (pc_gamg-&gt;orig_data) {
<a name="line571">571: </a>      <a href="../../../../../docs/manualpages/Mat/MatGetBlockSize.html">MatGetBlockSize</a>(Pmat, &amp;bs);
<a name="line572">572: </a>      <a href="../../../../../docs/manualpages/Mat/MatGetLocalSize.html">MatGetLocalSize</a>(Pmat, &amp;qq, NULL);

<a name="line574">574: </a>      pc_gamg-&gt;data_sz        = (qq / bs) * pc_gamg-&gt;orig_data_cell_rows * pc_gamg-&gt;orig_data_cell_cols;
<a name="line575">575: </a>      pc_gamg-&gt;data_cell_rows = pc_gamg-&gt;orig_data_cell_rows;
<a name="line576">576: </a>      pc_gamg-&gt;data_cell_cols = pc_gamg-&gt;orig_data_cell_cols;

<a name="line578">578: </a>      <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>(pc_gamg-&gt;data_sz, &amp;pc_gamg-&gt;data);
<a name="line579">579: </a>      <font color="#4169E1">for</font> (qq = 0; qq &lt; pc_gamg-&gt;data_sz; qq++) pc_gamg-&gt;data[qq] = pc_gamg-&gt;orig_data[qq];
<a name="line580">580: </a>    } <font color="#4169E1">else</font> {
<a name="line582">582: </a>      pc_gamg-&gt;ops-&gt;createdefaultdata(pc, Pmat);
<a name="line583">583: </a>    }
<a name="line584">584: </a>  }

<a name="line586">586: </a>  <font color="#B22222">/* cache original data for reuse */</font>
<a name="line587">587: </a>  <font color="#4169E1">if</font> (!pc_gamg-&gt;orig_data &amp;&amp; (<a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a>)(!pc_gamg-&gt;reuse_prol)) {
<a name="line588">588: </a>    <a href="../../../../../docs/manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>(pc_gamg-&gt;data_sz, &amp;pc_gamg-&gt;orig_data);
<a name="line589">589: </a>    <font color="#4169E1">for</font> (qq = 0; qq &lt; pc_gamg-&gt;data_sz; qq++) pc_gamg-&gt;orig_data[qq] = pc_gamg-&gt;data[qq];
<a name="line590">590: </a>    pc_gamg-&gt;orig_data_cell_rows = pc_gamg-&gt;data_cell_rows;
<a name="line591">591: </a>    pc_gamg-&gt;orig_data_cell_cols = pc_gamg-&gt;data_cell_cols;
<a name="line592">592: </a>  }

<a name="line594">594: </a>  <font color="#B22222">/* get basic dims */</font>
<a name="line595">595: </a>  <a href="../../../../../docs/manualpages/Mat/MatGetBlockSize.html">MatGetBlockSize</a>(Pmat, &amp;bs);
<a name="line596">596: </a>  <a href="../../../../../docs/manualpages/Mat/MatGetSize.html">MatGetSize</a>(Pmat, &amp;M, &amp;N);

<a name="line598">598: </a>  <a href="../../../../../docs/manualpages/Mat/MatGetInfo.html">MatGetInfo</a>(Pmat, <a href="../../../../../docs/manualpages/Mat/MatInfoType.html">MAT_GLOBAL_SUM</a>, &amp;info); <font color="#B22222">/* global reduction */</font>
<a name="line599">599: </a>  nnz0   = info.nz_used;
<a name="line600">600: </a>  nnztot = info.nz_used;
<a name="line601">601: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: level %d) N=%"</font> PetscInt_FMT <font color="#666666">", n data rows=%"</font> PetscInt_FMT <font color="#666666">", n data cols=%"</font> PetscInt_FMT <font color="#666666">", nnz/row (ave)=%"</font> PetscInt_FMT <font color="#666666">", np=%d\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, 0, M, pc_gamg-&gt;data_cell_rows, pc_gamg-&gt;data_cell_cols, (<a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>)(nnz0 / (<a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a>)M + 0.5), size);

<a name="line603">603: </a>  <font color="#B22222">/* Get A_i and R_i */</font>
<a name="line604">604: </a>  <font color="#4169E1">for</font> (level = 0, Aarr[0] = Pmat, nactivepe = size; level &lt; (pc_gamg-&gt;Nlevels - 1) &amp;&amp; (!level || M &gt; pc_gamg-&gt;coarse_eq_limit); level++) {
<a name="line605">605: </a>    pc_gamg-&gt;current_level = level;
<a name="line607">607: </a>    level1 = level + 1;
<a name="line608">608: </a><font color="#A020F0">#if defined(GAMG_STAGES)</font>
<a name="line609">609: </a>    <font color="#4169E1">if</font> (!gamg_stages[level]) {
<a name="line610">610: </a>      char str[32];
<a name="line611">611: </a>      sprintf(str, <font color="#666666">"GAMG Level %d"</font>, (int)level);
<a name="line612">612: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscLogStageRegister.html">PetscLogStageRegister</a>(str, &amp;gamg_stages[level]);
<a name="line613">613: </a>    }
<a name="line614">614: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscLogStagePush.html">PetscLogStagePush</a>(gamg_stages[level]);
<a name="line615">615: </a><font color="#A020F0">#endif</font>
<a name="line616">616: </a>    { <font color="#B22222">/* construct prolongator */</font>
<a name="line617">617: </a>      <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a>               Gmat;
<a name="line618">618: </a>      PetscCoarsenData *agg_lists;
<a name="line619">619: </a>      <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a>               Prol11;

<a name="line621">621: </a>      <a href="../../../../../docs/manualpages/PC/PCGAMGCreateGraph.html">PCGAMGCreateGraph</a>(pc, Aarr[level], &amp;Gmat);
<a name="line622">622: </a>      pc_gamg-&gt;ops-&gt;coarsen(pc, &amp;Gmat, &amp;agg_lists);
<a name="line623">623: </a>      pc_gamg-&gt;ops-&gt;prolongator(pc, Aarr[level], Gmat, agg_lists, &amp;Prol11);

<a name="line625">625: </a>      <font color="#B22222">/* could have failed to create new level */</font>
<a name="line626">626: </a>      <font color="#4169E1">if</font> (Prol11) {
<a name="line627">627: </a>        const char *prefix;
<a name="line628">628: </a>        char        addp[32];

<a name="line630">630: </a>        <font color="#B22222">/* get new block size of coarse matrices */</font>
<a name="line631">631: </a>        <a href="../../../../../docs/manualpages/Mat/MatGetBlockSizes.html">MatGetBlockSizes</a>(Prol11, NULL, &amp;bs);

<a name="line633">633: </a>        <font color="#4169E1">if</font> (pc_gamg-&gt;ops-&gt;optprolongator) {
<a name="line634">634: </a>          <font color="#B22222">/* smooth */</font>
<a name="line635">635: </a>          pc_gamg-&gt;ops-&gt;optprolongator(pc, Aarr[level], &amp;Prol11);
<a name="line636">636: </a>        }

<a name="line638">638: </a>        <font color="#4169E1">if</font> (pc_gamg-&gt;use_aggs_in_asm) {
<a name="line639">639: </a>          <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> bs;
<a name="line640">640: </a>          <a href="../../../../../docs/manualpages/Mat/MatGetBlockSizes.html">MatGetBlockSizes</a>(Prol11, &amp;bs, NULL); // not timed directly, ugly, could remove, but good ASM method
<a name="line641">641: </a>          PetscCDGetASMBlocks(agg_lists, bs, Gmat, &amp;nASMBlocksArr[level], &amp;ASMLocalIDsArr[level]);
<a name="line642">642: </a>        }

<a name="line644">644: </a>        <a href="../../../../../docs/manualpages/PC/PCGetOptionsPrefix.html">PCGetOptionsPrefix</a>(pc, &amp;prefix);
<a name="line645">645: </a>        <a href="../../../../../docs/manualpages/Mat/MatSetOptionsPrefix.html">MatSetOptionsPrefix</a>(Prol11, prefix);
<a name="line646">646: </a>        <a href="../../../../../docs/manualpages/Sys/PetscSNPrintf.html">PetscSNPrintf</a>(addp, <font color="#4169E1">sizeof</font>(addp), <font color="#666666">"pc_gamg_prolongator_%d_"</font>, (int)level);
<a name="line647">647: </a>        <a href="../../../../../docs/manualpages/Mat/MatAppendOptionsPrefix.html">MatAppendOptionsPrefix</a>(Prol11, addp);
<a name="line648">648: </a>        <font color="#B22222">/* Always generate the transpose with CUDA</font>
<a name="line649">649: </a><font color="#B22222">           Such behaviour can be adapted with -pc_gamg_prolongator_ prefixed options */</font>
<a name="line650">650: </a>        <a href="../../../../../docs/manualpages/Mat/MatSetOption.html">MatSetOption</a>(Prol11, <a href="../../../../../docs/manualpages/Mat/MatOption.html">MAT_FORM_EXPLICIT_TRANSPOSE</a>, <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>);
<a name="line651">651: </a>        <a href="../../../../../docs/manualpages/Mat/MatSetFromOptions.html">MatSetFromOptions</a>(Prol11);
<a name="line652">652: </a>        Parr[level1] = Prol11;
<a name="line653">653: </a>      } <font color="#4169E1">else</font> Parr[level1] = NULL; <font color="#B22222">/* failed to coarsen */</font>

<a name="line655">655: </a>      <a href="../../../../../docs/manualpages/Mat/MatDestroy.html">MatDestroy</a>(&amp;Gmat);
<a name="line656">656: </a>      PetscCDDestroy(agg_lists);
<a name="line657">657: </a>    }                           <font color="#B22222">/* construct prolongator scope */</font>
<a name="line658">658: </a>    <font color="#4169E1">if</font> (!level) Aarr[0] = Pmat; <font color="#B22222">/* use Pmat for finest level setup */</font>
<a name="line659">659: </a>    <font color="#4169E1">if</font> (!Parr[level1]) {        <font color="#B22222">/* failed to coarsen */</font>
<a name="line660">660: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: Stop gridding, level %"</font> PetscInt_FMT <font color="#666666">"\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, level);
<a name="line661">661: </a><font color="#A020F0">#if defined(GAMG_STAGES)</font>
<a name="line662">662: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscLogStagePop.html">PetscLogStagePop</a>();
<a name="line663">663: </a><font color="#A020F0">#endif</font>
<a name="line664">664: </a>      <font color="#4169E1">break</font>;
<a name="line665">665: </a>    }
<a name="line666">666: </a>    <a href="../../../../../docs/manualpages/Mat/MatGetSize.html">MatGetSize</a>(Parr[level1], &amp;M, &amp;N); <font color="#B22222">/* N is next M, a loop test variables */</font>
<a name="line668">668: </a>    <font color="#4169E1">if</font> (N &lt;= pc_gamg-&gt;coarse_eq_limit) is_last = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>;
<a name="line669">669: </a>    <font color="#4169E1">if</font> (level1 == pc_gamg-&gt;Nlevels - 1) is_last = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>;
<a name="line670">670: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>(petsc_gamg_setup_events[GAMG_LEVEL], 0, 0, 0, 0);
<a name="line671">671: </a>    pc_gamg-&gt;ops-&gt;createlevel(pc, Aarr[level], bs, &amp;Parr[level1], &amp;Aarr[level1], &amp;nactivepe, NULL, is_last);
<a name="line672">672: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_events[GAMG_LEVEL], 0, 0, 0, 0);

<a name="line674">674: </a>    <a href="../../../../../docs/manualpages/Mat/MatGetSize.html">MatGetSize</a>(Aarr[level1], &amp;M, &amp;N); <font color="#B22222">/* M is loop test variables */</font>
<a name="line675">675: </a>    <a href="../../../../../docs/manualpages/Mat/MatGetInfo.html">MatGetInfo</a>(Aarr[level1], <a href="../../../../../docs/manualpages/Mat/MatInfoType.html">MAT_GLOBAL_SUM</a>, &amp;info);
<a name="line676">676: </a>    nnztot += info.nz_used;
<a name="line677">677: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: %d) N=%"</font> PetscInt_FMT <font color="#666666">", n data cols=%"</font> PetscInt_FMT <font color="#666666">", nnz/row (ave)=%"</font> PetscInt_FMT <font color="#666666">", %d active pes\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, (int)level1, M, pc_gamg-&gt;data_cell_cols, (<a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>)(info.nz_used / (<a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a>)M), nactivepe);

<a name="line679">679: </a><font color="#A020F0">#if defined(GAMG_STAGES)</font>
<a name="line680">680: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscLogStagePop.html">PetscLogStagePop</a>();
<a name="line681">681: </a><font color="#A020F0">#endif</font>
<a name="line682">682: </a>    <font color="#B22222">/* stop if one node or one proc -- could pull back for singular problems */</font>
<a name="line683">683: </a>    <font color="#4169E1">if</font> ((pc_gamg-&gt;data_cell_cols &amp;&amp; M / pc_gamg-&gt;data_cell_cols &lt; 2) || (!pc_gamg-&gt;data_cell_cols &amp;&amp; M / bs &lt; 2)) {
<a name="line684">684: </a>      <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: HARD stop of coarsening on level %"</font> PetscInt_FMT <font color="#666666">".  Grid too small: %"</font> PetscInt_FMT <font color="#666666">" block nodes\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, level, M / bs);
<a name="line685">685: </a>      level++;
<a name="line686">686: </a>      <font color="#4169E1">break</font>;
<a name="line687">687: </a>    }
<a name="line688">688: </a>  } <font color="#B22222">/* levels */</font>
<a name="line689">689: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(pc_gamg-&gt;data);

<a name="line691">691: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: %"</font> PetscInt_FMT <font color="#666666">" levels, operator complexity = %g\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, level + 1, nnztot / nnz0);
<a name="line692">692: </a>  pc_gamg-&gt;Nlevels = level + 1;
<a name="line693">693: </a>  fine_level       = level;
<a name="line694">694: </a>  <a href="../../../../../docs/manualpages/PC/PCMGSetLevels.html">PCMGSetLevels</a>(pc, pc_gamg-&gt;Nlevels, NULL);

<a name="line696">696: </a>  <font color="#4169E1">if</font> (pc_gamg-&gt;Nlevels &gt; 1) { <font color="#B22222">/* don't setup MG if one level */</font>

<a name="line698">698: </a>    <font color="#B22222">/* set default smoothers &amp; set operators */</font>
<a name="line699">699: </a>    <font color="#4169E1">for</font> (lidx = 1, level = pc_gamg-&gt;Nlevels - 2; lidx &lt;= fine_level; lidx++, level--) {
<a name="line700">700: </a>      <a href="../../../../../docs/manualpages/KSP/KSP.html">KSP</a> smoother;
<a name="line701">701: </a>      <a href="../../../../../docs/manualpages/PC/PC.html">PC</a>  subpc;

<a name="line703">703: </a>      <a href="../../../../../docs/manualpages/PC/PCMGGetSmoother.html">PCMGGetSmoother</a>(pc, lidx, &amp;smoother);
<a name="line704">704: </a>      <a href="../../../../../docs/manualpages/KSP/KSPGetPC.html">KSPGetPC</a>(smoother, &amp;subpc);

<a name="line706">706: </a>      <a href="../../../../../docs/manualpages/KSP/KSPSetNormType.html">KSPSetNormType</a>(smoother, <a href="../../../../../docs/manualpages/KSP/KSP_NORM_NONE.html">KSP_NORM_NONE</a>);
<a name="line707">707: </a>      <font color="#B22222">/* set ops */</font>
<a name="line708">708: </a>      <a href="../../../../../docs/manualpages/KSP/KSPSetOperators.html">KSPSetOperators</a>(smoother, Aarr[level], Aarr[level]);
<a name="line709">709: </a>      <a href="../../../../../docs/manualpages/PC/PCMGSetInterpolation.html">PCMGSetInterpolation</a>(pc, lidx, Parr[level + 1]);

<a name="line711">711: </a>      <font color="#B22222">/* set defaults */</font>
<a name="line712">712: </a>      <a href="../../../../../docs/manualpages/KSP/KSPSetType.html">KSPSetType</a>(smoother, <a href="../../../../../docs/manualpages/KSP/KSPCHEBYSHEV.html">KSPCHEBYSHEV</a>);

<a name="line714">714: </a>      <font color="#B22222">/* set blocks for ASM smoother that uses the 'aggregates' */</font>
<a name="line715">715: </a>      <font color="#4169E1">if</font> (pc_gamg-&gt;use_aggs_in_asm) {
<a name="line716">716: </a>        <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> sz;
<a name="line717">717: </a>        <a href="../../../../../docs/manualpages/IS/IS.html">IS</a>      *iss;

<a name="line719">719: </a>        sz  = nASMBlocksArr[level];
<a name="line720">720: </a>        iss = ASMLocalIDsArr[level];
<a name="line721">721: </a>        <a href="../../../../../docs/manualpages/PC/PCSetType.html">PCSetType</a>(subpc, <a href="../../../../../docs/manualpages/PC/PCASM.html">PCASM</a>);
<a name="line722">722: </a>        <a href="../../../../../docs/manualpages/PC/PCASMSetOverlap.html">PCASMSetOverlap</a>(subpc, 0);
<a name="line723">723: </a>        <a href="../../../../../docs/manualpages/PC/PCASMSetType.html">PCASMSetType</a>(subpc, <a href="../../../../../docs/manualpages/PC/PCASMType.html">PC_ASM_BASIC</a>);
<a name="line724">724: </a>        <font color="#4169E1">if</font> (!sz) {
<a name="line725">725: </a>          <a href="../../../../../docs/manualpages/IS/IS.html">IS</a> is;
<a name="line726">726: </a>          <a href="../../../../../docs/manualpages/IS/ISCreateGeneral.html">ISCreateGeneral</a>(<a href="../../../../../docs/manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, 0, NULL, <a href="../../../../../docs/manualpages/Sys/PetscCopyMode.html">PETSC_COPY_VALUES</a>, &amp;is);
<a name="line727">727: </a>          <a href="../../../../../docs/manualpages/PC/PCASMSetLocalSubdomains.html">PCASMSetLocalSubdomains</a>(subpc, 1, NULL, &amp;is);
<a name="line728">728: </a>          <a href="../../../../../docs/manualpages/IS/ISDestroy.html">ISDestroy</a>(&amp;is);
<a name="line729">729: </a>        } <font color="#4169E1">else</font> {
<a name="line730">730: </a>          <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> kk;
<a name="line731">731: </a>          <a href="../../../../../docs/manualpages/PC/PCASMSetLocalSubdomains.html">PCASMSetLocalSubdomains</a>(subpc, sz, NULL, iss);
<a name="line732">732: </a>          <font color="#4169E1">for</font> (kk = 0; kk &lt; sz; kk++) <a href="../../../../../docs/manualpages/IS/ISDestroy.html">ISDestroy</a>(&amp;iss[kk]);
<a name="line733">733: </a>          <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(iss);
<a name="line734">734: </a>        }
<a name="line735">735: </a>        ASMLocalIDsArr[level] = NULL;
<a name="line736">736: </a>        nASMBlocksArr[level]  = 0;
<a name="line737">737: </a>      } <font color="#4169E1">else</font> {
<a name="line738">738: </a>        <a href="../../../../../docs/manualpages/PC/PCSetType.html">PCSetType</a>(subpc, <a href="../../../../../docs/manualpages/PC/PCJACOBI.html">PCJACOBI</a>);
<a name="line739">739: </a>      }
<a name="line740">740: </a>    }
<a name="line741">741: </a>    {
<a name="line742">742: </a>      <font color="#B22222">/* coarse grid */</font>
<a name="line743">743: </a>      <a href="../../../../../docs/manualpages/KSP/KSP.html">KSP</a>      smoother, *k2;
<a name="line744">744: </a>      <a href="../../../../../docs/manualpages/PC/PC.html">PC</a>       subpc, pc2;
<a name="line745">745: </a>      <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> ii, first;
<a name="line746">746: </a>      <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a>      Lmat = Aarr[(level = pc_gamg-&gt;Nlevels - 1)];
<a name="line747">747: </a>      lidx          = 0;

<a name="line749">749: </a>      <a href="../../../../../docs/manualpages/PC/PCMGGetSmoother.html">PCMGGetSmoother</a>(pc, lidx, &amp;smoother);
<a name="line750">750: </a>      <a href="../../../../../docs/manualpages/KSP/KSPSetOperators.html">KSPSetOperators</a>(smoother, Lmat, Lmat);
<a name="line751">751: </a>      <font color="#4169E1">if</font> (!pc_gamg-&gt;use_parallel_coarse_grid_solver) {
<a name="line752">752: </a>        <a href="../../../../../docs/manualpages/KSP/KSPSetNormType.html">KSPSetNormType</a>(smoother, <a href="../../../../../docs/manualpages/KSP/KSP_NORM_NONE.html">KSP_NORM_NONE</a>);
<a name="line753">753: </a>        <a href="../../../../../docs/manualpages/KSP/KSPGetPC.html">KSPGetPC</a>(smoother, &amp;subpc);
<a name="line754">754: </a>        <a href="../../../../../docs/manualpages/PC/PCSetType.html">PCSetType</a>(subpc, <a href="../../../../../docs/manualpages/PC/PCBJACOBI.html">PCBJACOBI</a>);
<a name="line755">755: </a>        <a href="../../../../../docs/manualpages/PC/PCSetUp.html">PCSetUp</a>(subpc);
<a name="line756">756: </a>        <a href="../../../../../docs/manualpages/PC/PCBJacobiGetSubKSP.html">PCBJacobiGetSubKSP</a>(subpc, &amp;ii, &amp;first, &amp;k2);
<a name="line758">758: </a>        <a href="../../../../../docs/manualpages/KSP/KSPGetPC.html">KSPGetPC</a>(k2[0], &amp;pc2);
<a name="line759">759: </a>        <a href="../../../../../docs/manualpages/PC/PCSetType.html">PCSetType</a>(pc2, <a href="../../../../../docs/manualpages/PC/PCLU.html">PCLU</a>);
<a name="line760">760: </a>        <a href="../../../../../docs/manualpages/PC/PCFactorSetShiftType.html">PCFactorSetShiftType</a>(pc2, MAT_SHIFT_INBLOCKS);
<a name="line761">761: </a>        <a href="../../../../../docs/manualpages/KSP/KSPSetTolerances.html">KSPSetTolerances</a>(k2[0], <a href="../../../../../docs/manualpages/Sys/PETSC_DEFAULT.html">PETSC_DEFAULT</a>, <a href="../../../../../docs/manualpages/Sys/PETSC_DEFAULT.html">PETSC_DEFAULT</a>, <a href="../../../../../docs/manualpages/Sys/PETSC_DEFAULT.html">PETSC_DEFAULT</a>, 1);
<a name="line762">762: </a>        <a href="../../../../../docs/manualpages/KSP/KSPSetType.html">KSPSetType</a>(k2[0], <a href="../../../../../docs/manualpages/KSP/KSPPREONLY.html">KSPPREONLY</a>);
<a name="line763">763: </a>      }
<a name="line764">764: </a>    }

<a name="line766">766: </a>    <font color="#B22222">/* should be called in PCSetFromOptions_GAMG(), but cannot be called prior to <a href="../../../../../docs/manualpages/PC/PCMGSetLevels.html">PCMGSetLevels</a>() */</font>
<a name="line767">767: </a>    <a href="../../../../../docs/manualpages/Sys/PetscObjectOptionsBegin.html">PetscObjectOptionsBegin</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc);
<a name="line768">768: </a>    PCSetFromOptions_MG(pc, PetscOptionsObject);
<a name="line769">769: </a>    <a href="../../../../../docs/manualpages/Sys/PetscOptionsEnd.html">PetscOptionsEnd</a>();
<a name="line770">770: </a>    <a href="../../../../../docs/manualpages/PC/PCMGSetGalerkin.html">PCMGSetGalerkin</a>(pc, <a href="../../../../../docs/manualpages/PC/PCMGalerkinType.html">PC_MG_GALERKIN_EXTERNAL</a>);

<a name="line772">772: </a>    <font color="#B22222">/* set cheby eigen estimates from SA to use in the solver */</font>
<a name="line773">773: </a>    <font color="#4169E1">if</font> (pc_gamg-&gt;use_sa_esteig) {
<a name="line774">774: </a>      <font color="#4169E1">for</font> (lidx = 1, level = pc_gamg-&gt;Nlevels - 2; level &gt;= 0; lidx++, level--) {
<a name="line775">775: </a>        <a href="../../../../../docs/manualpages/KSP/KSP.html">KSP</a>       smoother;
<a name="line776">776: </a>        <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> ischeb;

<a name="line778">778: </a>        <a href="../../../../../docs/manualpages/PC/PCMGGetSmoother.html">PCMGGetSmoother</a>(pc, lidx, &amp;smoother);
<a name="line779">779: </a>        <a href="../../../../../docs/manualpages/Sys/PetscObjectTypeCompare.html">PetscObjectTypeCompare</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)smoother, <a href="../../../../../docs/manualpages/KSP/KSPCHEBYSHEV.html">KSPCHEBYSHEV</a>, &amp;ischeb);
<a name="line780">780: </a>        <font color="#4169E1">if</font> (ischeb) {
<a name="line781">781: </a>          KSP_Chebyshev *cheb = (KSP_Chebyshev *)smoother-&gt;data;

<a name="line783">783: </a>          // The command line will override these settings because <a href="../../../../../docs/manualpages/KSP/KSPSetFromOptions.html">KSPSetFromOptions</a> is called in PCSetUp_MG
<a name="line784">784: </a>          <font color="#4169E1">if</font> (mg-&gt;max_eigen_DinvA[level] &gt; 0) {
<a name="line785">785: </a>            // SA uses Jacobi <font color="#4169E1">for</font> P; we use SA estimates <font color="#4169E1">if</font> the smoother is also Jacobi or <font color="#4169E1">if</font> the user explicitly requested it.
<a name="line786">786: </a>            // TODO: This should test whether it's the same Jacobi variant (DIAG, ROWSUM, etc.)
<a name="line787">787: </a>            <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> emax, emin;

<a name="line789">789: </a>            emin = mg-&gt;min_eigen_DinvA[level];
<a name="line790">790: </a>            emax = mg-&gt;max_eigen_DinvA[level];
<a name="line791">791: </a>            <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: PCSetUp_GAMG: call <a href="../../../../../docs/manualpages/KSP/KSPChebyshevSetEigenvalues.html">KSPChebyshevSetEigenvalues</a> on level %"</font> PetscInt_FMT <font color="#666666">" (N=%"</font> PetscInt_FMT <font color="#666666">") with emax = %g emin = %g\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix, level, Aarr[level]-&gt;rmap-&gt;N, (double)emax, (double)emin);
<a name="line792">792: </a>            cheb-&gt;emin_provided = emin;
<a name="line793">793: </a>            cheb-&gt;emax_provided = emax;
<a name="line794">794: </a>          }
<a name="line795">795: </a>        }
<a name="line796">796: </a>      }
<a name="line797">797: </a>    }

<a name="line799">799: </a>    PCSetUp_MG(pc);

<a name="line801">801: </a>    <font color="#B22222">/* clean up */</font>
<a name="line802">802: </a>    <font color="#4169E1">for</font> (level = 1; level &lt; pc_gamg-&gt;Nlevels; level++) {
<a name="line803">803: </a>      <a href="../../../../../docs/manualpages/Mat/MatDestroy.html">MatDestroy</a>(&amp;Parr[level]);
<a name="line804">804: </a>      <a href="../../../../../docs/manualpages/Mat/MatDestroy.html">MatDestroy</a>(&amp;Aarr[level]);
<a name="line805">805: </a>    }
<a name="line806">806: </a>  } <font color="#4169E1">else</font> {
<a name="line807">807: </a>    <a href="../../../../../docs/manualpages/KSP/KSP.html">KSP</a> smoother;

<a name="line809">809: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscInfo.html">PetscInfo</a>(pc, <font color="#666666">"%s: One level solver used (system is seen as DD). Using default solver.\n"</font>, ((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc)-&gt;prefix);
<a name="line810">810: </a>    <a href="../../../../../docs/manualpages/PC/PCMGGetSmoother.html">PCMGGetSmoother</a>(pc, 0, &amp;smoother);
<a name="line811">811: </a>    <a href="../../../../../docs/manualpages/KSP/KSPSetOperators.html">KSPSetOperators</a>(smoother, Aarr[0], Aarr[0]);
<a name="line812">812: </a>    <a href="../../../../../docs/manualpages/KSP/KSPSetType.html">KSPSetType</a>(smoother, <a href="../../../../../docs/manualpages/KSP/KSPPREONLY.html">KSPPREONLY</a>);
<a name="line813">813: </a>    PCSetUp_MG(pc);
<a name="line814">814: </a>  }
<a name="line815">815: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(petsc_gamg_setup_events[GAMG_SETUP], 0, 0, 0, 0);
<a name="line816">816: </a>  <font color="#4169E1">return</font> 0;
<a name="line817">817: </a>}

<a name="line819">819: </a><font color="#B22222">/*</font>
<a name="line820">820: </a><font color="#B22222"> PCDestroy_GAMG - Destroys the private context for the GAMG preconditioner</font>
<a name="line821">821: </a><font color="#B22222">   that was created with PCCreate_GAMG().</font>

<a name="line823">823: </a><font color="#B22222">   Input Parameter:</font>
<a name="line824">824: </a><font color="#B22222">.  pc - the preconditioner context</font>

<a name="line826">826: </a><font color="#B22222">   Application Interface Routine: <a href="../../../../../docs/manualpages/PC/PCDestroy.html">PCDestroy</a>()</font>
<a name="line827">827: </a><font color="#B22222">*/</font>
<a name="line828">828: </a><strong><font color="#4169E1"><a name="PCDestroy_GAMG"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCDestroy_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc)</font></strong>
<a name="line829">829: </a>{
<a name="line830">830: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line831">831: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line833">833: </a>  PCReset_GAMG(pc);
<a name="line834">834: </a>  <font color="#4169E1">if</font> (pc_gamg-&gt;ops-&gt;destroy) (*pc_gamg-&gt;ops-&gt;destroy)(pc);
<a name="line835">835: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(pc_gamg-&gt;ops);
<a name="line836">836: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(pc_gamg-&gt;gamg_type_name);
<a name="line837">837: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(pc_gamg);
<a name="line838">838: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetProcEqLim_C"</font>, NULL);
<a name="line839">839: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetCoarseEqLim_C"</font>, NULL);
<a name="line840">840: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetRepartition_C"</font>, NULL);
<a name="line841">841: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetEigenvalues_C"</font>, NULL);
<a name="line842">842: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetUseSAEstEig_C"</font>, NULL);
<a name="line843">843: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetReuseInterpolation_C"</font>, NULL);
<a name="line844">844: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGASMSetUseAggs_C"</font>, NULL);
<a name="line845">845: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetUseParallelCoarseGridSolve_C"</font>, NULL);
<a name="line846">846: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetCpuPinCoarseGrids_C"</font>, NULL);
<a name="line847">847: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetCoarseGridLayoutType_C"</font>, NULL);
<a name="line848">848: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetThreshold_C"</font>, NULL);
<a name="line849">849: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetRankReductionFactors_C"</font>, NULL);
<a name="line850">850: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetThresholdScale_C"</font>, NULL);
<a name="line851">851: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetType_C"</font>, NULL);
<a name="line852">852: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGGetType_C"</font>, NULL);
<a name="line853">853: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetNlevels_C"</font>, NULL);
<a name="line854">854: </a>  PCDestroy_MG(pc);
<a name="line855">855: </a>  <font color="#4169E1">return</font> 0;
<a name="line856">856: </a>}

<a name="line858">858: </a><font color="#B22222">/*@</font>
<a name="line859">859: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetProcEqLim.html">PCGAMGSetProcEqLim</a> - Set number of equations to aim for per process on the coarse grids via processor reduction in `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`</font>

<a name="line861">861: </a><font color="#B22222">   Logically Collective</font>

<a name="line863">863: </a><font color="#B22222">   Input Parameters:</font>
<a name="line864">864: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line865">865: </a><font color="#B22222">-  n - the number of equations</font>

<a name="line867">867: </a><font color="#B22222">   Options Database Key:</font>
<a name="line868">868: </a><font color="#B22222">.  -pc_gamg_process_eq_limit &lt;limit&gt; - set the limit</font>

<a name="line870">870: </a><font color="#B22222">   Note:</font>
<a name="line871">871: </a><font color="#B22222">   `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` will reduce the number of MPI processes used directly on the coarse grids so that there are around &lt;limit&gt; equations on each process</font>
<a name="line872">872: </a><font color="#B22222">   that has degrees of freedom</font>

<a name="line874">874: </a><font color="#B22222">   Level: intermediate</font>

<a name="line876">876: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetCoarseEqLim.html">PCGAMGSetCoarseEqLim</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetRankReductionFactors.html">PCGAMGSetRankReductionFactors</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetRepartition.html">PCGAMGSetRepartition</a>()`</font>
<a name="line877">877: </a><font color="#B22222">@*/</font>
<a name="line878">878: </a><strong><font color="#4169E1"><a name="PCGAMGSetProcEqLim"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetProcEqLim.html">PCGAMGSetProcEqLim</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> n)</font></strong>
<a name="line879">879: </a>{
<a name="line881">881: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetProcEqLim_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>), (pc, n));
<a name="line882">882: </a>  <font color="#4169E1">return</font> 0;
<a name="line883">883: </a>}

<a name="line885">885: </a><strong><font color="#4169E1"><a name="PCGAMGSetProcEqLim_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetProcEqLim_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> n)</font></strong>
<a name="line886">886: </a>{
<a name="line887">887: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line888">888: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line890">890: </a>  <font color="#4169E1">if</font> (n &gt; 0) pc_gamg-&gt;min_eq_proc = n;
<a name="line891">891: </a>  <font color="#4169E1">return</font> 0;
<a name="line892">892: </a>}

<a name="line894">894: </a><font color="#B22222">/*@</font>
<a name="line895">895: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetCoarseEqLim.html">PCGAMGSetCoarseEqLim</a> - Set maximum number of equations on the coarsest grid of `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`</font>

<a name="line897">897: </a><font color="#B22222">   Collective</font>

<a name="line899">899: </a><font color="#B22222">   Input Parameters:</font>
<a name="line900">900: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line901">901: </a><font color="#B22222">-  n - maximum number of equations to aim for</font>

<a name="line903">903: </a><font color="#B22222">   Options Database Key:</font>
<a name="line904">904: </a><font color="#B22222">.  -pc_gamg_coarse_eq_limit &lt;limit&gt; - set the limit</font>

<a name="line906">906: </a><font color="#B22222">   Note:</font>
<a name="line907">907: </a><font color="#B22222">   For example -pc_gamg_coarse_eq_limit 1000 will stop coarsening once the coarse grid</font>
<a name="line908">908: </a><font color="#B22222">   has less than 1000 unknowns.</font>

<a name="line910">910: </a><font color="#B22222">   Level: intermediate</font>

<a name="line912">912: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetProcEqLim.html">PCGAMGSetProcEqLim</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetRankReductionFactors.html">PCGAMGSetRankReductionFactors</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetRepartition.html">PCGAMGSetRepartition</a>()`</font>
<a name="line913">913: </a><font color="#B22222">@*/</font>
<a name="line914">914: </a><strong><font color="#4169E1"><a name="PCGAMGSetCoarseEqLim"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetCoarseEqLim.html">PCGAMGSetCoarseEqLim</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> n)</font></strong>
<a name="line915">915: </a>{
<a name="line917">917: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetCoarseEqLim_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>), (pc, n));
<a name="line918">918: </a>  <font color="#4169E1">return</font> 0;
<a name="line919">919: </a>}

<a name="line921">921: </a><strong><font color="#4169E1"><a name="PCGAMGSetCoarseEqLim_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetCoarseEqLim_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> n)</font></strong>
<a name="line922">922: </a>{
<a name="line923">923: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line924">924: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line926">926: </a>  <font color="#4169E1">if</font> (n &gt; 0) pc_gamg-&gt;coarse_eq_limit = n;
<a name="line927">927: </a>  <font color="#4169E1">return</font> 0;
<a name="line928">928: </a>}

<a name="line930">930: </a><font color="#B22222">/*@</font>
<a name="line931">931: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetRepartition.html">PCGAMGSetRepartition</a> - Repartition the degrees of freedom across the processors on the coarser grids when reducing the number of MPI ranks to use</font>

<a name="line933">933: </a><font color="#B22222">   Collective</font>

<a name="line935">935: </a><font color="#B22222">   Input Parameters:</font>
<a name="line936">936: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line937">937: </a><font color="#B22222">-  n - `<a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>` or `<a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>`</font>

<a name="line939">939: </a><font color="#B22222">   Options Database Key:</font>
<a name="line940">940: </a><font color="#B22222">.  -pc_gamg_repartition &lt;true,false&gt; - turn on the repartitioning</font>

<a name="line942">942: </a><font color="#B22222">   Note:</font>
<a name="line943">943: </a><font color="#B22222">   This will generally improve the loading balancing of the work on each level</font>

<a name="line945">945: </a><font color="#B22222">   Level: intermediate</font>

<a name="line947">947: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetProcEqLim.html">PCGAMGSetProcEqLim</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetRankReductionFactors.html">PCGAMGSetRankReductionFactors</a>()`</font>
<a name="line948">948: </a><font color="#B22222">@*/</font>
<a name="line949">949: </a><strong><font color="#4169E1"><a name="PCGAMGSetRepartition"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetRepartition.html">PCGAMGSetRepartition</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> n)</font></strong>
<a name="line950">950: </a>{
<a name="line952">952: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetRepartition_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a>), (pc, n));
<a name="line953">953: </a>  <font color="#4169E1">return</font> 0;
<a name="line954">954: </a>}

<a name="line956">956: </a><strong><font color="#4169E1"><a name="PCGAMGSetRepartition_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetRepartition_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> n)</font></strong>
<a name="line957">957: </a>{
<a name="line958">958: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line959">959: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line961">961: </a>  pc_gamg-&gt;repart = n;
<a name="line962">962: </a>  <font color="#4169E1">return</font> 0;
<a name="line963">963: </a>}

<a name="line965">965: </a><font color="#B22222">/*@</font>
<a name="line966">966: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetUseSAEstEig.html">PCGAMGSetUseSAEstEig</a> - Use the eigen estimate from smoothed aggregation for the Chebyshev smoother during the solution process</font>

<a name="line968">968: </a><font color="#B22222">   Collective</font>

<a name="line970">970: </a><font color="#B22222">   Input Parameters:</font>
<a name="line971">971: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line972">972: </a><font color="#B22222">-  n - number of its</font>

<a name="line974">974: </a><font color="#B22222">   Options Database Key:</font>
<a name="line975">975: </a><font color="#B22222">.  -pc_gamg_use_sa_esteig &lt;true,false&gt; - use the eigen estimate</font>

<a name="line977">977: </a><font color="#B22222">   Notes:</font>
<a name="line978">978: </a><font color="#B22222">   Smoothed aggregation constructs the smoothed prolongator $P = (I - \omega D^{-1} A) T$ where $T$ is the tentative prolongator and $D$ is the diagonal of $A$.</font>
<a name="line979">979: </a><font color="#B22222">   Eigenvalue estimates (based on a few `PCCG` or `PCGMRES` iterations) are computed to choose $\omega$ so that this is a stable smoothing operation.</font>
<a name="line980">980: </a><font color="#B22222">   If Chebyshev with Jacobi (diagonal) preconditioning is used for smoothing, then the eigenvalue estimates can be reused during the solution process</font>
<a name="line981">981: </a><font color="#B22222">   This option is only used when the smoother uses Jacobi, and should be turned off if a different `<a href="../../../../../docs/manualpages/PC/PCJacobiType.html">PCJacobiType</a>` is used.</font>
<a name="line982">982: </a><font color="#B22222">   It became default in PETSc 3.17.</font>

<a name="line984">984: </a><font color="#B22222">   Level: advanced</font>

<a name="line986">986: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/KSP/KSPChebyshevSetEigenvalues.html">KSPChebyshevSetEigenvalues</a>()`, `<a href="../../../../../docs/manualpages/KSP/KSPChebyshevEstEigSet.html">KSPChebyshevEstEigSet</a>()`</font>
<a name="line987">987: </a><font color="#B22222">@*/</font>
<a name="line988">988: </a><strong><font color="#4169E1"><a name="PCGAMGSetUseSAEstEig"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetUseSAEstEig.html">PCGAMGSetUseSAEstEig</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> n)</font></strong>
<a name="line989">989: </a>{
<a name="line991">991: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetUseSAEstEig_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a>), (pc, n));
<a name="line992">992: </a>  <font color="#4169E1">return</font> 0;
<a name="line993">993: </a>}

<a name="line995">995: </a><strong><font color="#4169E1"><a name="PCGAMGSetUseSAEstEig_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetUseSAEstEig_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> n)</font></strong>
<a name="line996">996: </a>{
<a name="line997">997: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line998">998: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line1000">1000: </a>  pc_gamg-&gt;use_sa_esteig = n;
<a name="line1001">1001: </a>  <font color="#4169E1">return</font> 0;
<a name="line1002">1002: </a>}

<a name="line1004">1004: </a><font color="#B22222">/*@</font>
<a name="line1005">1005: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetEigenvalues.html">PCGAMGSetEigenvalues</a> - Set WHAT eigenvalues WHY?</font>

<a name="line1007">1007: </a><font color="#B22222">   Collective</font>

<a name="line1009">1009: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1010">1010: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line1011">1011: </a><font color="#B22222">-  emax - max eigenvalue</font>
<a name="line1012">1012: </a><font color="#B22222">.  emin - min eigenvalue</font>

<a name="line1014">1014: </a><font color="#B22222">   Options Database Key:</font>
<a name="line1015">1015: </a><font color="#B22222">.  -pc_gamg_eigenvalues &lt;emin,emax&gt; - estimates of the eigenvalues</font>

<a name="line1017">1017: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1019">1019: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetUseSAEstEig.html">PCGAMGSetUseSAEstEig</a>()`</font>
<a name="line1020">1020: </a><font color="#B22222">@*/</font>
<a name="line1021">1021: </a><strong><font color="#4169E1"><a name="PCGAMGSetEigenvalues"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetEigenvalues.html">PCGAMGSetEigenvalues</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> emax, <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> emin)</font></strong>
<a name="line1022">1022: </a>{
<a name="line1024">1024: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetEigenvalues_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a>, <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a>), (pc, emax, emin));
<a name="line1025">1025: </a>  <font color="#4169E1">return</font> 0;
<a name="line1026">1026: </a>}

<a name="line1028">1028: </a><strong><font color="#4169E1"><a name="PCGAMGSetEigenvalues_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetEigenvalues_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> emax, <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> emin)</font></strong>
<a name="line1029">1029: </a>{
<a name="line1030">1030: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1031">1031: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line1035">1035: </a>  pc_gamg-&gt;emax = emax;
<a name="line1036">1036: </a>  pc_gamg-&gt;emin = emin;
<a name="line1037">1037: </a>  <font color="#4169E1">return</font> 0;
<a name="line1038">1038: </a>}

<a name="line1040">1040: </a><font color="#B22222">/*@</font>
<a name="line1041">1041: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetReuseInterpolation.html">PCGAMGSetReuseInterpolation</a> - Reuse prolongation when rebuilding a `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` algebraic multigrid preconditioner</font>

<a name="line1043">1043: </a><font color="#B22222">   Collective</font>

<a name="line1045">1045: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1046">1046: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line1047">1047: </a><font color="#B22222">-  n - `<a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>` or `<a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>`</font>

<a name="line1049">1049: </a><font color="#B22222">   Options Database Key:</font>
<a name="line1050">1050: </a><font color="#B22222">.  -pc_gamg_reuse_interpolation &lt;true,false&gt; - reuse the previous interpolation</font>

<a name="line1052">1052: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1054">1054: </a><font color="#B22222">   Note:</font>
<a name="line1055">1055: </a><font color="#B22222">   May negatively affect the convergence rate of the method on new matrices if the matrix entries change a great deal, but allows</font>
<a name="line1056">1056: </a><font color="#B22222">   rebuilding the preconditioner quicker.</font>

<a name="line1058">1058: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`</font>
<a name="line1059">1059: </a><font color="#B22222">@*/</font>
<a name="line1060">1060: </a><strong><font color="#4169E1"><a name="PCGAMGSetReuseInterpolation"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetReuseInterpolation.html">PCGAMGSetReuseInterpolation</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> n)</font></strong>
<a name="line1061">1061: </a>{
<a name="line1063">1063: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetReuseInterpolation_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a>), (pc, n));
<a name="line1064">1064: </a>  <font color="#4169E1">return</font> 0;
<a name="line1065">1065: </a>}

<a name="line1067">1067: </a><strong><font color="#4169E1"><a name="PCGAMGSetReuseInterpolation_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetReuseInterpolation_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> n)</font></strong>
<a name="line1068">1068: </a>{
<a name="line1069">1069: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1070">1070: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line1072">1072: </a>  pc_gamg-&gt;reuse_prol = n;
<a name="line1073">1073: </a>  <font color="#4169E1">return</font> 0;
<a name="line1074">1074: </a>}

<a name="line1076">1076: </a><font color="#B22222">/*@</font>
<a name="line1077">1077: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGASMSetUseAggs.html">PCGAMGASMSetUseAggs</a> - Have the `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` smoother on each level use the aggregates defined by the coarsening process as the subdomains for the additive Schwarz preconditioner</font>
<a name="line1078">1078: </a><font color="#B22222">   used as the smoother</font>

<a name="line1080">1080: </a><font color="#B22222">   Collective</font>

<a name="line1082">1082: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1083">1083: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line1084">1084: </a><font color="#B22222">-  flg - `<a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>` to use aggregates, `<a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>` to not</font>

<a name="line1086">1086: </a><font color="#B22222">   Options Database Key:</font>
<a name="line1087">1087: </a><font color="#B22222">.  -pc_gamg_asm_use_agg &lt;true,false&gt; - use aggregates to define the additive Schwarz subdomains</font>

<a name="line1089">1089: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1091">1091: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCASM.html">PCASM</a>`, `<a href="../../../../../docs/manualpages/PC/PCSetType.html">PCSetType</a>`</font>
<a name="line1092">1092: </a><font color="#B22222">@*/</font>
<a name="line1093">1093: </a><strong><font color="#4169E1"><a name="PCGAMGASMSetUseAggs"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGASMSetUseAggs.html">PCGAMGASMSetUseAggs</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> flg)</font></strong>
<a name="line1094">1094: </a>{
<a name="line1096">1096: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGASMSetUseAggs_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a>), (pc, flg));
<a name="line1097">1097: </a>  <font color="#4169E1">return</font> 0;
<a name="line1098">1098: </a>}

<a name="line1100">1100: </a><strong><font color="#4169E1"><a name="PCGAMGASMSetUseAggs_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGASMSetUseAggs_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> flg)</font></strong>
<a name="line1101">1101: </a>{
<a name="line1102">1102: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1103">1103: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line1105">1105: </a>  pc_gamg-&gt;use_aggs_in_asm = flg;
<a name="line1106">1106: </a>  <font color="#4169E1">return</font> 0;
<a name="line1107">1107: </a>}

<a name="line1109">1109: </a><font color="#B22222">/*@</font>
<a name="line1110">1110: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetUseParallelCoarseGridSolve.html">PCGAMGSetUseParallelCoarseGridSolve</a> - allow a parallel coarse grid solver</font>

<a name="line1112">1112: </a><font color="#B22222">   Collective</font>

<a name="line1114">1114: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1115">1115: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line1116">1116: </a><font color="#B22222">-  flg - `<a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>` to not force coarse grid onto one processor</font>

<a name="line1118">1118: </a><font color="#B22222">   Options Database Key:</font>
<a name="line1119">1119: </a><font color="#B22222">.  -pc_gamg_use_parallel_coarse_grid_solver - use a parallel coarse grid direct solver</font>

<a name="line1121">1121: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1123">1123: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetCoarseGridLayoutType.html">PCGAMGSetCoarseGridLayoutType</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetCpuPinCoarseGrids.html">PCGAMGSetCpuPinCoarseGrids</a>()`</font>
<a name="line1124">1124: </a><font color="#B22222">@*/</font>
<a name="line1125">1125: </a><strong><font color="#4169E1"><a name="PCGAMGSetUseParallelCoarseGridSolve"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetUseParallelCoarseGridSolve.html">PCGAMGSetUseParallelCoarseGridSolve</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> flg)</font></strong>
<a name="line1126">1126: </a>{
<a name="line1128">1128: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetUseParallelCoarseGridSolve_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a>), (pc, flg));
<a name="line1129">1129: </a>  <font color="#4169E1">return</font> 0;
<a name="line1130">1130: </a>}

<a name="line1132">1132: </a><strong><font color="#4169E1"><a name="PCGAMGSetUseParallelCoarseGridSolve_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetUseParallelCoarseGridSolve_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> flg)</font></strong>
<a name="line1133">1133: </a>{
<a name="line1134">1134: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1135">1135: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line1137">1137: </a>  pc_gamg-&gt;use_parallel_coarse_grid_solver = flg;
<a name="line1138">1138: </a>  <font color="#4169E1">return</font> 0;
<a name="line1139">1139: </a>}

<a name="line1141">1141: </a><font color="#B22222">/*@</font>
<a name="line1142">1142: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetCpuPinCoarseGrids.html">PCGAMGSetCpuPinCoarseGrids</a> - pin the coarse grids created in `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` to run only on the CPU since the problems may be too small to run efficiently on the GPUs</font>

<a name="line1144">1144: </a><font color="#B22222">   Collective</font>

<a name="line1146">1146: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1147">1147: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line1148">1148: </a><font color="#B22222">-  flg - `<a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>` to pin coarse grids to the CPU</font>

<a name="line1150">1150: </a><font color="#B22222">   Options Database Key:</font>
<a name="line1151">1151: </a><font color="#B22222">.  -pc_gamg_cpu_pin_coarse_grids - pin the coarse grids to the CPU</font>

<a name="line1153">1153: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1155">1155: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetCoarseGridLayoutType.html">PCGAMGSetCoarseGridLayoutType</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetUseParallelCoarseGridSolve.html">PCGAMGSetUseParallelCoarseGridSolve</a>()`</font>
<a name="line1156">1156: </a><font color="#B22222">@*/</font>
<a name="line1157">1157: </a><strong><font color="#4169E1"><a name="PCGAMGSetCpuPinCoarseGrids"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetCpuPinCoarseGrids.html">PCGAMGSetCpuPinCoarseGrids</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> flg)</font></strong>
<a name="line1158">1158: </a>{
<a name="line1160">1160: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetCpuPinCoarseGrids_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a>), (pc, flg));
<a name="line1161">1161: </a>  <font color="#4169E1">return</font> 0;
<a name="line1162">1162: </a>}

<a name="line1164">1164: </a><strong><font color="#4169E1"><a name="PCGAMGSetCpuPinCoarseGrids_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetCpuPinCoarseGrids_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a> flg)</font></strong>
<a name="line1165">1165: </a>{
<a name="line1166">1166: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1167">1167: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line1169">1169: </a>  pc_gamg-&gt;cpu_pin_coarse_grids = flg;
<a name="line1170">1170: </a>  <font color="#4169E1">return</font> 0;
<a name="line1171">1171: </a>}

<a name="line1173">1173: </a><font color="#B22222">/*@</font>
<a name="line1174">1174: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetCoarseGridLayoutType.html">PCGAMGSetCoarseGridLayoutType</a> - place coarse grids on processors with natural order (compact type)</font>

<a name="line1176">1176: </a><font color="#B22222">   Collective</font>

<a name="line1178">1178: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1179">1179: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line1180">1180: </a><font color="#B22222">-  flg - `<a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMGLayoutType</a>` type, either `<a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMG_LAYOUT_COMPACT</a>` or `<a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMG_LAYOUT_SPREAD</a>`</font>

<a name="line1182">1182: </a><font color="#B22222">   Options Database Key:</font>
<a name="line1183">1183: </a><font color="#B22222">.  -pc_gamg_coarse_grid_layout_type - place the coarse grids with natural ordering</font>

<a name="line1185">1185: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1187">1187: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetUseParallelCoarseGridSolve.html">PCGAMGSetUseParallelCoarseGridSolve</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetCpuPinCoarseGrids.html">PCGAMGSetCpuPinCoarseGrids</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMGLayoutType</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMG_LAYOUT_COMPACT</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMG_LAYOUT_SPREAD</a>`</font>
<a name="line1188">1188: </a><font color="#B22222">@*/</font>
<a name="line1189">1189: </a><strong><font color="#4169E1"><a name="PCGAMGSetCoarseGridLayoutType"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetCoarseGridLayoutType.html">PCGAMGSetCoarseGridLayoutType</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMGLayoutType</a> flg)</font></strong>
<a name="line1190">1190: </a>{
<a name="line1192">1192: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetCoarseGridLayoutType_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMGLayoutType</a>), (pc, flg));
<a name="line1193">1193: </a>  <font color="#4169E1">return</font> 0;
<a name="line1194">1194: </a>}

<a name="line1196">1196: </a><strong><font color="#4169E1"><a name="PCGAMGSetCoarseGridLayoutType_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetCoarseGridLayoutType_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMGLayoutType</a> flg)</font></strong>
<a name="line1197">1197: </a>{
<a name="line1198">1198: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1199">1199: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line1201">1201: </a>  pc_gamg-&gt;layout_type = flg;
<a name="line1202">1202: </a>  <font color="#4169E1">return</font> 0;
<a name="line1203">1203: </a>}

<a name="line1205">1205: </a><font color="#B22222">/*@</font>
<a name="line1206">1206: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetNlevels.html">PCGAMGSetNlevels</a> -  Sets the maximum number of levels `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` will use</font>

<a name="line1208">1208: </a><font color="#B22222">   Not collective</font>

<a name="line1210">1210: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1211">1211: </a><font color="#B22222">+  pc - the preconditioner</font>
<a name="line1212">1212: </a><font color="#B22222">-  n - the maximum number of levels to use</font>

<a name="line1214">1214: </a><font color="#B22222">   Options Database Key:</font>
<a name="line1215">1215: </a><font color="#B22222">.  -pc_mg_levels &lt;n&gt; - set the maximum number of levels to allow</font>

<a name="line1217">1217: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1219">1219: </a><font color="#B22222">   Developer Note:</font>
<a name="line1220">1220: </a><font color="#B22222">   Should be called `PCGAMGSetMaximumNumberlevels()` and possible be shared with `<a href="../../../../../docs/manualpages/PC/PCMG.html">PCMG</a>`</font>

<a name="line1222">1222: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`</font>
<a name="line1223">1223: </a><font color="#B22222">@*/</font>
<a name="line1224">1224: </a><strong><font color="#4169E1"><a name="PCGAMGSetNlevels"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetNlevels.html">PCGAMGSetNlevels</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> n)</font></strong>
<a name="line1225">1225: </a>{
<a name="line1227">1227: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetNlevels_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>), (pc, n));
<a name="line1228">1228: </a>  <font color="#4169E1">return</font> 0;
<a name="line1229">1229: </a>}

<a name="line1231">1231: </a><strong><font color="#4169E1"><a name="PCGAMGSetNlevels_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetNlevels_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> n)</font></strong>
<a name="line1232">1232: </a>{
<a name="line1233">1233: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1234">1234: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line1236">1236: </a>  pc_gamg-&gt;Nlevels = n;
<a name="line1237">1237: </a>  <font color="#4169E1">return</font> 0;
<a name="line1238">1238: </a>}

<a name="line1240">1240: </a><font color="#B22222">/*@</font>
<a name="line1241">1241: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetThreshold.html">PCGAMGSetThreshold</a> - Relative threshold to use for dropping edges in aggregation graph</font>

<a name="line1243">1243: </a><font color="#B22222">   Not collective</font>

<a name="line1245">1245: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1246">1246: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line1247">1247: </a><font color="#B22222">.  v - array of threshold values for finest n levels; 0.0 means keep all nonzero entries in the graph; negative means keep even zero entries in the graph</font>
<a name="line1248">1248: </a><font color="#B22222">-  n - number of threshold values provided in array</font>

<a name="line1250">1250: </a><font color="#B22222">   Options Database Key:</font>
<a name="line1251">1251: </a><font color="#B22222">.  -pc_gamg_threshold &lt;threshold&gt; - the threshold to drop edges</font>

<a name="line1253">1253: </a><font color="#B22222">   Notes:</font>
<a name="line1254">1254: </a><font color="#B22222">    Increasing the threshold decreases the rate of coarsening. Conversely reducing the threshold increases the rate of coarsening (aggressive coarsening) and thereby reduces the complexity of the coarse grids, and generally results in slower solver converge rates. Reducing coarse grid complexity reduced the complexity of Galerkin coarse grid construction considerably.</font>
<a name="line1255">1255: </a><font color="#B22222">    Before coarsening or aggregating the graph, `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` removes small values from the graph with this threshold, and thus reducing the coupling in the graph and a different (perhaps better) coarser set of points.</font>

<a name="line1257">1257: </a><font color="#B22222">    If n is less than the total number of coarsenings (see `<a href="../../../../../docs/manualpages/PC/PCGAMGSetNlevels.html">PCGAMGSetNlevels</a>()`), then threshold scaling (see `<a href="../../../../../docs/manualpages/PC/PCGAMGSetThresholdScale.html">PCGAMGSetThresholdScale</a>()`) is used for each successive coarsening.</font>
<a name="line1258">1258: </a><font color="#B22222">    In this case, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetThresholdScale.html">PCGAMGSetThresholdScale</a>()` must be called before `<a href="../../../../../docs/manualpages/PC/PCGAMGSetThreshold.html">PCGAMGSetThreshold</a>()`.</font>
<a name="line1259">1259: </a><font color="#B22222">    If n is greater than the total number of levels, the excess entries in threshold will not be used.</font>

<a name="line1261">1261: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1263">1263: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `PCGAMGFilterGraph()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetAggressiveLevels.html">PCGAMGSetAggressiveLevels</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetThresholdScale.html">PCGAMGSetThresholdScale</a>()`</font>
<a name="line1264">1264: </a><font color="#B22222">@*/</font>
<a name="line1265">1265: </a><strong><font color="#4169E1"><a name="PCGAMGSetThreshold"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetThreshold.html">PCGAMGSetThreshold</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> v[], <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> n)</font></strong>
<a name="line1266">1266: </a>{
<a name="line1269">1269: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetThreshold_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a>[], <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>), (pc, v, n));
<a name="line1270">1270: </a>  <font color="#4169E1">return</font> 0;
<a name="line1271">1271: </a>}

<a name="line1273">1273: </a><strong><font color="#4169E1"><a name="PCGAMGSetThreshold_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetThreshold_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> v[], <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> n)</font></strong>
<a name="line1274">1274: </a>{
<a name="line1275">1275: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1276">1276: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;
<a name="line1277">1277: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> i;
<a name="line1278">1278: </a>  <font color="#4169E1">for</font> (i = 0; i &lt; <a href="../../../../../docs/manualpages/Sys/PetscMin.html">PetscMin</a>(n, PETSC_MG_MAXLEVELS); i++) pc_gamg-&gt;threshold[i] = v[i];
<a name="line1279">1279: </a>  <font color="#4169E1">for</font> (; i &lt; PETSC_MG_MAXLEVELS; i++) pc_gamg-&gt;threshold[i] = pc_gamg-&gt;threshold[i - 1] * pc_gamg-&gt;threshold_scale;
<a name="line1280">1280: </a>  <font color="#4169E1">return</font> 0;
<a name="line1281">1281: </a>}

<a name="line1283">1283: </a><font color="#B22222">/*@</font>
<a name="line1284">1284: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetRankReductionFactors.html">PCGAMGSetRankReductionFactors</a> - Set a manual schedule for MPI rank reduction on coarse grids</font>

<a name="line1286">1286: </a><font color="#B22222">   Collective</font>

<a name="line1288">1288: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1289">1289: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line1290">1290: </a><font color="#B22222">.  v - array of reduction factors. 0 for first value forces a reduction to one process/device on first level in CUDA</font>
<a name="line1291">1291: </a><font color="#B22222">-  n - number of values provided in array</font>

<a name="line1293">1293: </a><font color="#B22222">   Options Database Key:</font>
<a name="line1294">1294: </a><font color="#B22222">.  -pc_gamg_rank_reduction_factors &lt;factors&gt; - provide the schedule</font>

<a name="line1296">1296: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1298">1298: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetProcEqLim.html">PCGAMGSetProcEqLim</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetCoarseEqLim.html">PCGAMGSetCoarseEqLim</a>()`</font>
<a name="line1299">1299: </a><font color="#B22222">@*/</font>
<a name="line1300">1300: </a><strong><font color="#4169E1"><a name="PCGAMGSetRankReductionFactors"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetRankReductionFactors.html">PCGAMGSetRankReductionFactors</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> v[], <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> n)</font></strong>
<a name="line1301">1301: </a>{
<a name="line1304">1304: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetRankReductionFactors_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>[], <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>), (pc, v, n));
<a name="line1305">1305: </a>  <font color="#4169E1">return</font> 0;
<a name="line1306">1306: </a>}

<a name="line1308">1308: </a><strong><font color="#4169E1"><a name="PCGAMGSetRankReductionFactors_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetRankReductionFactors_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> v[], <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> n)</font></strong>
<a name="line1309">1309: </a>{
<a name="line1310">1310: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1311">1311: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;
<a name="line1312">1312: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> i;
<a name="line1313">1313: </a>  <font color="#4169E1">for</font> (i = 0; i &lt; <a href="../../../../../docs/manualpages/Sys/PetscMin.html">PetscMin</a>(n, PETSC_MG_MAXLEVELS); i++) pc_gamg-&gt;level_reduction_factors[i] = v[i];
<a name="line1314">1314: </a>  <font color="#4169E1">for</font> (; i &lt; PETSC_MG_MAXLEVELS; i++) pc_gamg-&gt;level_reduction_factors[i] = -1; <font color="#B22222">/* 0 stop putting one process/device on first level */</font>
<a name="line1315">1315: </a>  <font color="#4169E1">return</font> 0;
<a name="line1316">1316: </a>}

<a name="line1318">1318: </a><font color="#B22222">/*@</font>
<a name="line1319">1319: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetThresholdScale.html">PCGAMGSetThresholdScale</a> - Relative threshold reduction at each level</font>

<a name="line1321">1321: </a><font color="#B22222">   Not collective</font>

<a name="line1323">1323: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1324">1324: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line1325">1325: </a><font color="#B22222">-  scale - the threshold value reduction, usually &lt; 1.0</font>

<a name="line1327">1327: </a><font color="#B22222">   Options Database Key:</font>
<a name="line1328">1328: </a><font color="#B22222">.  -pc_gamg_threshold_scale &lt;v&gt; - set the relative threshold reduction on each level</font>

<a name="line1330">1330: </a><font color="#B22222">   Note:</font>
<a name="line1331">1331: </a><font color="#B22222">   The initial threshold (for an arbitrary number of levels starting from the finest) can be set with `<a href="../../../../../docs/manualpages/PC/PCGAMGSetThreshold.html">PCGAMGSetThreshold</a>()`.</font>
<a name="line1332">1332: </a><font color="#B22222">   This scaling is used for each subsequent coarsening, but must be called before `<a href="../../../../../docs/manualpages/PC/PCGAMGSetThreshold.html">PCGAMGSetThreshold</a>()`.</font>

<a name="line1334">1334: </a><font color="#B22222">   Level: advanced</font>

<a name="line1336">1336: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetThreshold.html">PCGAMGSetThreshold</a>()`</font>
<a name="line1337">1337: </a><font color="#B22222">@*/</font>
<a name="line1338">1338: </a><strong><font color="#4169E1"><a name="PCGAMGSetThresholdScale"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetThresholdScale.html">PCGAMGSetThresholdScale</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> v)</font></strong>
<a name="line1339">1339: </a>{
<a name="line1341">1341: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetThresholdScale_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a>), (pc, v));
<a name="line1342">1342: </a>  <font color="#4169E1">return</font> 0;
<a name="line1343">1343: </a>}

<a name="line1345">1345: </a><strong><font color="#4169E1"><a name="PCGAMGSetThresholdScale_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetThresholdScale_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> v)</font></strong>
<a name="line1346">1346: </a>{
<a name="line1347">1347: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1348">1348: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;
<a name="line1349">1349: </a>  pc_gamg-&gt;threshold_scale = v;
<a name="line1350">1350: </a>  <font color="#4169E1">return</font> 0;
<a name="line1351">1351: </a>}

<a name="line1353">1353: </a><font color="#B22222">/*@C</font>
<a name="line1354">1354: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGSetType.html">PCGAMGSetType</a> - Set the type of algorithm `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` should use</font>

<a name="line1356">1356: </a><font color="#B22222">   Collective</font>

<a name="line1358">1358: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1359">1359: </a><font color="#B22222">+  pc - the preconditioner context</font>
<a name="line1360">1360: </a><font color="#B22222">-  type - `PCGAMGAGG`, `PCGAMGGEO`, or `PCGAMGCLASSICAL`</font>

<a name="line1362">1362: </a><font color="#B22222">   Options Database Key:</font>
<a name="line1363">1363: </a><font color="#B22222">.  -pc_gamg_type &lt;agg,geo,classical&gt; - type of algebraic multigrid to apply</font>

<a name="line1365">1365: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1367">1367: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMGGetType.html">PCGAMGGetType</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGType.html">PCGAMGType</a>`</font>
<a name="line1368">1368: </a><font color="#B22222">@*/</font>
<a name="line1369">1369: </a><strong><font color="#4169E1"><a name="PCGAMGSetType"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGSetType.html">PCGAMGSetType</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/PC/PCGAMGType.html">PCGAMGType</a> type)</font></strong>
<a name="line1370">1370: </a>{
<a name="line1372">1372: </a>  <a href="../../../../../docs/manualpages/Sys/PetscTryMethod.html">PetscTryMethod</a>(pc, <font color="#666666">"PCGAMGSetType_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/PC/PCGAMGType.html">PCGAMGType</a>), (pc, type));
<a name="line1373">1373: </a>  <font color="#4169E1">return</font> 0;
<a name="line1374">1374: </a>}

<a name="line1376">1376: </a><font color="#B22222">/*@C</font>
<a name="line1377">1377: </a><font color="#B22222">   <a href="../../../../../docs/manualpages/PC/PCGAMGGetType.html">PCGAMGGetType</a> - Get the type of algorithm `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` will use</font>

<a name="line1379">1379: </a><font color="#B22222">   Collective</font>

<a name="line1381">1381: </a><font color="#B22222">   Input Parameter:</font>
<a name="line1382">1382: </a><font color="#B22222">.  pc - the preconditioner context</font>

<a name="line1384">1384: </a><font color="#B22222">   Output Parameter:</font>
<a name="line1385">1385: </a><font color="#B22222">.  type - the type of algorithm used</font>

<a name="line1387">1387: </a><font color="#B22222">   Level: intermediate</font>

<a name="line1389">1389: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetType.html">PCGAMGSetType</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGType.html">PCGAMGType</a>`</font>
<a name="line1390">1390: </a><font color="#B22222">@*/</font>
<a name="line1391">1391: </a><strong><font color="#4169E1"><a name="PCGAMGGetType"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGGetType.html">PCGAMGGetType</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/PC/PCGAMGType.html">PCGAMGType</a> *type)</font></strong>
<a name="line1392">1392: </a>{
<a name="line1394">1394: </a>  <a href="../../../../../docs/manualpages/Sys/PetscUseMethod.html">PetscUseMethod</a>(pc, <font color="#666666">"PCGAMGGetType_C"</font>, (<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>, <a href="../../../../../docs/manualpages/PC/PCGAMGType.html">PCGAMGType</a> *), (pc, type));
<a name="line1395">1395: </a>  <font color="#4169E1">return</font> 0;
<a name="line1396">1396: </a>}

<a name="line1398">1398: </a><strong><font color="#4169E1"><a name="PCGAMGGetType_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGGetType_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/PC/PCGAMGType.html">PCGAMGType</a> *type)</font></strong>
<a name="line1399">1399: </a>{
<a name="line1400">1400: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1401">1401: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line1403">1403: </a>  *type = pc_gamg-&gt;type;
<a name="line1404">1404: </a>  <font color="#4169E1">return</font> 0;
<a name="line1405">1405: </a>}

<a name="line1407">1407: </a><strong><font color="#4169E1"><a name="PCGAMGSetType_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCGAMGSetType_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/PC/PCGAMGType.html">PCGAMGType</a> type)</font></strong>
<a name="line1408">1408: </a>{
<a name="line1409">1409: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1410">1410: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;
<a name="line1411">1411: </a>  <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> (*r)(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>);

<a name="line1413">1413: </a>  pc_gamg-&gt;type = type;
<a name="line1414">1414: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFunctionListFind.html">PetscFunctionListFind</a>(GAMGList, type, &amp;r);
<a name="line1416">1416: </a>  <font color="#4169E1">if</font> (pc_gamg-&gt;ops-&gt;destroy) {
<a name="line1417">1417: </a>    (*pc_gamg-&gt;ops-&gt;destroy)(pc);
<a name="line1418">1418: </a>    <a href="../../../../../docs/manualpages/Sys/PetscMemzero.html">PetscMemzero</a>(pc_gamg-&gt;ops, <font color="#4169E1">sizeof</font>(<font color="#4169E1">struct _PCGAMGOps</font>));
<a name="line1419">1419: </a>    pc_gamg-&gt;ops-&gt;createlevel = PCGAMGCreateLevel_GAMG;
<a name="line1420">1420: </a>    <font color="#B22222">/* cleaning up common data in pc_gamg - this should disappear someday */</font>
<a name="line1421">1421: </a>    pc_gamg-&gt;data_cell_cols      = 0;
<a name="line1422">1422: </a>    pc_gamg-&gt;data_cell_rows      = 0;
<a name="line1423">1423: </a>    pc_gamg-&gt;orig_data_cell_cols = 0;
<a name="line1424">1424: </a>    pc_gamg-&gt;orig_data_cell_rows = 0;
<a name="line1425">1425: </a>    <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(pc_gamg-&gt;data);
<a name="line1426">1426: </a>    pc_gamg-&gt;data_sz = 0;
<a name="line1427">1427: </a>  }
<a name="line1428">1428: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFree.html">PetscFree</a>(pc_gamg-&gt;gamg_type_name);
<a name="line1429">1429: </a>  <a href="../../../../../docs/manualpages/Sys/PetscStrallocpy.html">PetscStrallocpy</a>(type, &amp;pc_gamg-&gt;gamg_type_name);
<a name="line1430">1430: </a>  (*r)(pc);
<a name="line1431">1431: </a>  <font color="#4169E1">return</font> 0;
<a name="line1432">1432: </a>}

<a name="line1434">1434: </a><strong><font color="#4169E1"><a name="PCView_GAMG"></a>static <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCView_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Viewer/PetscViewer.html">PetscViewer</a> viewer)</font></strong>
<a name="line1435">1435: </a>{
<a name="line1436">1436: </a>  PC_MG    *mg      = (PC_MG *)pc-&gt;data;
<a name="line1437">1437: </a>  PC_GAMG  *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;
<a name="line1438">1438: </a>  <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> gc = 0, oc = 0;

<a name="line1440">1440: </a>  <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"    GAMG specific options\n"</font>);
<a name="line1441">1441: </a>  <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"      Threshold for dropping small values in graph on each level ="</font>);
<a name="line1442">1442: </a>  <font color="#4169E1">for</font> (<a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> i = 0; i &lt; mg-&gt;nlevels; i++) <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">" %g"</font>, (double)pc_gamg-&gt;threshold[i]);
<a name="line1443">1443: </a>  <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"\n"</font>);
<a name="line1444">1444: </a>  <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"      Threshold scaling factor for each level not specified = %g\n"</font>, (double)pc_gamg-&gt;threshold_scale);
<a name="line1445">1445: </a>  <font color="#4169E1">if</font> (pc_gamg-&gt;use_aggs_in_asm) <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"      Using aggregates from coarsening process to define subdomains for <a href="../../../../../docs/manualpages/PC/PCASM.html">PCASM</a>\n"</font>);
<a name="line1446">1446: </a>  <font color="#4169E1">if</font> (pc_gamg-&gt;use_parallel_coarse_grid_solver) <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"      Using parallel coarse grid solver (all coarse grid equations not put on one process)\n"</font>);
<a name="line1447">1447: </a>  <font color="#4169E1">if</font> (pc_gamg-&gt;ops-&gt;view) (*pc_gamg-&gt;ops-&gt;view)(pc, viewer);
<a name="line1448">1448: </a>  <a href="../../../../../docs/manualpages/PC/PCMGGetGridComplexity.html">PCMGGetGridComplexity</a>(pc, &amp;gc, &amp;oc);
<a name="line1449">1449: </a>  <a href="../../../../../docs/manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(viewer, <font color="#666666">"      Complexity:    grid = %g    operator = %g\n"</font>, (double)gc, (double)oc);
<a name="line1450">1450: </a>  <font color="#4169E1">return</font> 0;
<a name="line1451">1451: </a>}

<a name="line1453">1453: </a><strong><font color="#4169E1"><a name="PCSetFromOptions_GAMG"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCSetFromOptions_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, PetscOptionItems *PetscOptionsObject)</font></strong>
<a name="line1454">1454: </a>{
<a name="line1455">1455: </a>  PC_MG             *mg      = (PC_MG *)pc-&gt;data;
<a name="line1456">1456: </a>  PC_GAMG           *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;
<a name="line1457">1457: </a>  <a href="../../../../../docs/manualpages/Sys/PetscBool.html">PetscBool</a>          flag;
<a name="line1458">1458: </a>  <a href="../../../../../docs/manualpages/Sys/MPI_Comm.html">MPI_Comm</a>           comm;
<a name="line1459">1459: </a>  char               prefix[256], tname[32];
<a name="line1460">1460: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a>           i, n;
<a name="line1461">1461: </a>  const char        *pcpre;
<a name="line1462">1462: </a>  static const char *LayoutTypes[] = {<font color="#666666">"compact"</font>, <font color="#666666">"spread"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMGLayoutType</a>"</font>, <font color="#666666">"PC_GAMG_LAYOUT"</font>, NULL};
<a name="line1463">1463: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectGetComm.html">PetscObjectGetComm</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, &amp;comm);
<a name="line1464">1464: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsHeadBegin.html">PetscOptionsHeadBegin</a>(PetscOptionsObject, <font color="#666666">"GAMG options"</font>);
<a name="line1465">1465: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsFList.html">PetscOptionsFList</a>(<font color="#666666">"-pc_gamg_type"</font>, <font color="#666666">"Type of AMG method"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetType.html">PCGAMGSetType</a>"</font>, GAMGList, pc_gamg-&gt;gamg_type_name, tname, <font color="#4169E1">sizeof</font>(tname), &amp;flag);
<a name="line1466">1466: </a>  <font color="#4169E1">if</font> (flag) <a href="../../../../../docs/manualpages/PC/PCGAMGSetType.html">PCGAMGSetType</a>(pc, tname);
<a name="line1467">1467: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html">PetscOptionsBool</a>(<font color="#666666">"-pc_gamg_repartition"</font>, <font color="#666666">"Repartion coarse grids"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetRepartition.html">PCGAMGSetRepartition</a>"</font>, pc_gamg-&gt;repart, &amp;pc_gamg-&gt;repart, NULL);
<a name="line1468">1468: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html">PetscOptionsBool</a>(<font color="#666666">"-pc_gamg_use_sa_esteig"</font>, <font color="#666666">"Use eigen estimate from smoothed aggregation for smoother"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetUseSAEstEig.html">PCGAMGSetUseSAEstEig</a>"</font>, pc_gamg-&gt;use_sa_esteig, &amp;pc_gamg-&gt;use_sa_esteig, NULL);
<a name="line1469">1469: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html">PetscOptionsBool</a>(<font color="#666666">"-pc_gamg_reuse_interpolation"</font>, <font color="#666666">"Reuse prolongation operator"</font>, <font color="#666666">"PCGAMGReuseInterpolation"</font>, pc_gamg-&gt;reuse_prol, &amp;pc_gamg-&gt;reuse_prol, NULL);
<a name="line1470">1470: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html">PetscOptionsBool</a>(<font color="#666666">"-pc_gamg_asm_use_agg"</font>, <font color="#666666">"Use aggregation aggregates for ASM smoother"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGASMSetUseAggs.html">PCGAMGASMSetUseAggs</a>"</font>, pc_gamg-&gt;use_aggs_in_asm, &amp;pc_gamg-&gt;use_aggs_in_asm, NULL);
<a name="line1471">1471: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html">PetscOptionsBool</a>(<font color="#666666">"-pc_gamg_use_parallel_coarse_grid_solver"</font>, <font color="#666666">"Use parallel coarse grid solver (otherwise put last grid on one process)"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetUseParallelCoarseGridSolve.html">PCGAMGSetUseParallelCoarseGridSolve</a>"</font>, pc_gamg-&gt;use_parallel_coarse_grid_solver, &amp;pc_gamg-&gt;use_parallel_coarse_grid_solver, NULL);
<a name="line1472">1472: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsBool.html">PetscOptionsBool</a>(<font color="#666666">"-pc_gamg_cpu_pin_coarse_grids"</font>, <font color="#666666">"Pin coarse grids to the CPU"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetCpuPinCoarseGrids.html">PCGAMGSetCpuPinCoarseGrids</a>"</font>, pc_gamg-&gt;cpu_pin_coarse_grids, &amp;pc_gamg-&gt;cpu_pin_coarse_grids, NULL);
<a name="line1473">1473: </a>  <a href="../../../../../docs/manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../docs/manualpages/Sys/PetscOptionsEnum.html">PetscOptionsEnum</a>(<font color="#666666">"-pc_gamg_coarse_grid_layout_type"</font>, <font color="#666666">"compact: place reduced grids on processes in natural order; spread: distribute to whole machine for more memory bandwidth"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetCoarseGridLayoutType.html">PCGAMGSetCoarseGridLayoutType</a>"</font>, LayoutTypes,
<a name="line1474">1474: </a>                             (<a href="../../../../../docs/manualpages/Sys/PetscEnum.html">PetscEnum</a>)pc_gamg-&gt;layout_type, (<a href="../../../../../docs/manualpages/Sys/PetscEnum.html">PetscEnum</a> *)&amp;pc_gamg-&gt;layout_type, NULL));
<a name="line1475">1475: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html">PetscOptionsInt</a>(<font color="#666666">"-pc_gamg_process_eq_limit"</font>, <font color="#666666">"Limit (goal) on number of equations per process on coarse grids"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetProcEqLim.html">PCGAMGSetProcEqLim</a>"</font>, pc_gamg-&gt;min_eq_proc, &amp;pc_gamg-&gt;min_eq_proc, NULL);
<a name="line1476">1476: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html">PetscOptionsInt</a>(<font color="#666666">"-pc_gamg_coarse_eq_limit"</font>, <font color="#666666">"Limit on number of equations for the coarse grid"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetCoarseEqLim.html">PCGAMGSetCoarseEqLim</a>"</font>, pc_gamg-&gt;coarse_eq_limit, &amp;pc_gamg-&gt;coarse_eq_limit, NULL);
<a name="line1477">1477: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsReal.html">PetscOptionsReal</a>(<font color="#666666">"-pc_gamg_threshold_scale"</font>, <font color="#666666">"Scaling of threshold for each level not specified"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetThresholdScale.html">PCGAMGSetThresholdScale</a>"</font>, pc_gamg-&gt;threshold_scale, &amp;pc_gamg-&gt;threshold_scale, NULL);
<a name="line1478">1478: </a>  n = PETSC_MG_MAXLEVELS;
<a name="line1479">1479: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsRealArray.html">PetscOptionsRealArray</a>(<font color="#666666">"-pc_gamg_threshold"</font>, <font color="#666666">"Relative threshold to use for dropping edges in aggregation graph"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetThreshold.html">PCGAMGSetThreshold</a>"</font>, pc_gamg-&gt;threshold, &amp;n, &amp;flag);
<a name="line1480">1480: </a>  <font color="#4169E1">if</font> (!flag || n &lt; PETSC_MG_MAXLEVELS) {
<a name="line1481">1481: </a>    <font color="#4169E1">if</font> (!flag) n = 1;
<a name="line1482">1482: </a>    i = n;
<a name="line1483">1483: </a>    <font color="#4169E1">do</font> {
<a name="line1484">1484: </a>      pc_gamg-&gt;threshold[i] = pc_gamg-&gt;threshold[i - 1] * pc_gamg-&gt;threshold_scale;
<a name="line1485">1485: </a>    } <font color="#4169E1">while</font> (++i &lt; PETSC_MG_MAXLEVELS);
<a name="line1486">1486: </a>  }
<a name="line1487">1487: </a>  n = PETSC_MG_MAXLEVELS;
<a name="line1488">1488: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsIntArray.html">PetscOptionsIntArray</a>(<font color="#666666">"-pc_gamg_rank_reduction_factors"</font>, <font color="#666666">"Manual schedule of coarse grid reduction factors that overrides internal heuristics (0 for first reduction puts one process/device)"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetRankReductionFactors.html">PCGAMGSetRankReductionFactors</a>"</font>, pc_gamg-&gt;level_reduction_factors, &amp;n, &amp;flag);
<a name="line1489">1489: </a>  <font color="#4169E1">if</font> (!flag) i = 0;
<a name="line1490">1490: </a>  <font color="#4169E1">else</font> i = n;
<a name="line1491">1491: </a>  <font color="#4169E1">do</font> {
<a name="line1492">1492: </a>    pc_gamg-&gt;level_reduction_factors[i] = -1;
<a name="line1493">1493: </a>  } <font color="#4169E1">while</font> (++i &lt; PETSC_MG_MAXLEVELS);
<a name="line1494">1494: </a>  <a href="../../../../../docs/manualpages/Sys/PetscOptionsInt.html">PetscOptionsInt</a>(<font color="#666666">"-pc_mg_levels"</font>, <font color="#666666">"Set number of MG levels"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetNlevels.html">PCGAMGSetNlevels</a>"</font>, pc_gamg-&gt;Nlevels, &amp;pc_gamg-&gt;Nlevels, NULL);
<a name="line1495">1495: </a>  {
<a name="line1496">1496: </a>    <a href="../../../../../docs/manualpages/Sys/PetscReal.html">PetscReal</a> eminmax[2] = {0., 0.};
<a name="line1497">1497: </a>    n                    = 2;
<a name="line1498">1498: </a>    <a href="../../../../../docs/manualpages/Sys/PetscOptionsRealArray.html">PetscOptionsRealArray</a>(<font color="#666666">"-pc_gamg_eigenvalues"</font>, <font color="#666666">"extreme eigenvalues for smoothed aggregation"</font>, <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMGSetEigenvalues.html">PCGAMGSetEigenvalues</a>"</font>, eminmax, &amp;n, &amp;flag);
<a name="line1499">1499: </a>    <font color="#4169E1">if</font> (flag) {
<a name="line1501">1501: </a>      <a href="../../../../../docs/manualpages/PC/PCGAMGSetEigenvalues.html">PCGAMGSetEigenvalues</a>(pc, eminmax[1], eminmax[0]);
<a name="line1502">1502: </a>    }
<a name="line1503">1503: </a>  }
<a name="line1504">1504: </a>  <font color="#B22222">/* set options for subtype */</font>
<a name="line1505">1505: </a>  (*pc_gamg-&gt;ops-&gt;setfromoptions)(pc, PetscOptionsObject);

<a name="line1507">1507: </a>  <a href="../../../../../docs/manualpages/PC/PCGetOptionsPrefix.html">PCGetOptionsPrefix</a>(pc, &amp;pcpre);
<a name="line1508">1508: </a>  <a href="../../../../../docs/manualpages/Sys/PetscSNPrintf.html">PetscSNPrintf</a>(prefix, <font color="#4169E1">sizeof</font>(prefix), <font color="#666666">"%spc_gamg_"</font>, pcpre ? pcpre : <font color="#666666">""</font>);
<a name="line1509">1509: </a>  PetscOptionsHeadEnd();
<a name="line1510">1510: </a>  <font color="#4169E1">return</font> 0;
<a name="line1511">1511: </a>}

<a name="line1513">1513: </a><font color="#B22222">/*MC</font>
<a name="line1514">1514: </a><font color="#B22222">     <a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a> - Geometric algebraic multigrid (AMG) preconditioner</font>

<a name="line1516">1516: </a><font color="#B22222">   Options Database Keys:</font>
<a name="line1517">1517: </a><font color="#B22222">+   -pc_gamg_type &lt;type,default=agg&gt; - one of agg, geo, or classical</font>
<a name="line1518">1518: </a><font color="#B22222">.   -pc_gamg_repartition  &lt;bool,default=false&gt; - repartition the degrees of freedom across the coarse grids as they are determined</font>
<a name="line1519">1519: </a><font color="#B22222">.   -pc_gamg_asm_use_agg &lt;bool,default=false&gt; - use the aggregates from the coasening process to defined the subdomains on each level for the <a href="../../../../../docs/manualpages/PC/PCASM.html">PCASM</a> smoother</font>
<a name="line1520">1520: </a><font color="#B22222">.   -pc_gamg_process_eq_limit &lt;limit, default=50&gt; - `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` will reduce the number of MPI ranks used directly on the coarse grids so that there are around &lt;limit&gt;</font>
<a name="line1521">1521: </a><font color="#B22222">                                        equations on each process that has degrees of freedom</font>
<a name="line1522">1522: </a><font color="#B22222">.   -pc_gamg_coarse_eq_limit &lt;limit, default=50&gt; - Set maximum number of equations on coarsest grid to aim for.</font>
<a name="line1523">1523: </a><font color="#B22222">.   -pc_gamg_reuse_interpolation &lt;bool,default=true&gt; - when rebuilding the algebraic multigrid preconditioner reuse the previously computed interpolations (should always be true)</font>
<a name="line1524">1524: </a><font color="#B22222">.   -pc_gamg_threshold[] &lt;thresh,default=[-1,...]&gt; - Before aggregating the graph `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` will remove small values from the graph on each level (&lt; 0 does no filtering)</font>
<a name="line1525">1525: </a><font color="#B22222">-   -pc_gamg_threshold_scale &lt;scale,default=1&gt; - Scaling of threshold on each coarser grid if not specified</font>

<a name="line1527">1527: </a><font color="#B22222">   Options Database Keys for Aggregation:</font>
<a name="line1528">1528: </a><font color="#B22222">+  -pc_gamg_agg_nsmooths &lt;nsmooth, default=1&gt; - number of smoothing steps to use with smooth aggregation</font>
<a name="line1529">1529: </a><font color="#B22222">.  -pc_gamg_square_graph &lt;n,default=1&gt; - alias for pc_gamg_aggressive_coarsening (deprecated)</font>
<a name="line1530">1530: </a><font color="#B22222">-  -pc_gamg_aggressive_coarsening &lt;n,default=1&gt; - number of aggressive coarsening (MIS-2) levels from finest.</font>

<a name="line1532">1532: </a><font color="#B22222">   Options Database Keys for Multigrid:</font>
<a name="line1533">1533: </a><font color="#B22222">+  -pc_mg_cycles &lt;v&gt; - v or w, see `<a href="../../../../../docs/manualpages/PC/PCMGSetCycleType.html">PCMGSetCycleType</a>()`</font>
<a name="line1534">1534: </a><font color="#B22222">.  -pc_mg_distinct_smoothup - configure the up and down (pre and post) smoothers separately, see <a href="../../../../../docs/manualpages/PC/PCMGSetDistinctSmoothUp.html">PCMGSetDistinctSmoothUp</a>()</font>
<a name="line1535">1535: </a><font color="#B22222">.  -pc_mg_type &lt;multiplicative&gt; - (one of) additive multiplicative full kascade</font>
<a name="line1536">1536: </a><font color="#B22222">-  -pc_mg_levels &lt;levels&gt; - Number of levels of multigrid to use. GAMG has a heuristic so pc_mg_levels is not usually used with GAMG</font>

<a name="line1538">1538: </a><font color="#B22222">  Notes:</font>
<a name="line1539">1539: </a><font color="#B22222">  To obtain good performance for `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` for vector valued problems you must</font>
<a name="line1540">1540: </a><font color="#B22222">  call `<a href="../../../../../docs/manualpages/Mat/MatSetBlockSize.html">MatSetBlockSize</a>()` to indicate the number of degrees of freedom per grid point</font>
<a name="line1541">1541: </a><font color="#B22222">  call `<a href="../../../../../docs/manualpages/Mat/MatSetNearNullSpace.html">MatSetNearNullSpace</a>()` (or `<a href="../../../../../docs/manualpages/PC/PCSetCoordinates.html">PCSetCoordinates</a>()` if solving the equations of elasticity) to indicate the near null space of the operator</font>

<a name="line1543">1543: </a><font color="#B22222">  See [the Users Manual section on <a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>](sec_amg) for more details.</font>

<a name="line1545">1545: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1547">1547: </a><font color="#B22222">.seealso: `<a href="../../../../../docs/manualpages/PC/PCCreate.html">PCCreate</a>()`, `<a href="../../../../../docs/manualpages/PC/PCSetType.html">PCSetType</a>()`, `<a href="../../../../../docs/manualpages/Mat/MatSetBlockSize.html">MatSetBlockSize</a>()`, `<a href="../../../../../docs/manualpages/PC/PCMGType.html">PCMGType</a>`, `<a href="../../../../../docs/manualpages/PC/PCSetCoordinates.html">PCSetCoordinates</a>()`, `<a href="../../../../../docs/manualpages/Mat/MatSetNearNullSpace.html">MatSetNearNullSpace</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetType.html">PCGAMGSetType</a>()`, `PCGAMGAGG`, `PCGAMGGEO`, `PCGAMGCLASSICAL`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetProcEqLim.html">PCGAMGSetProcEqLim</a>()`,</font>
<a name="line1548">1548: </a><font color="#B22222">          `<a href="../../../../../docs/manualpages/PC/PCGAMGSetCoarseEqLim.html">PCGAMGSetCoarseEqLim</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetRepartition.html">PCGAMGSetRepartition</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGRegister.html">PCGAMGRegister</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetReuseInterpolation.html">PCGAMGSetReuseInterpolation</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGASMSetUseAggs.html">PCGAMGASMSetUseAggs</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetUseParallelCoarseGridSolve.html">PCGAMGSetUseParallelCoarseGridSolve</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetNlevels.html">PCGAMGSetNlevels</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetThreshold.html">PCGAMGSetThreshold</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGGetType.html">PCGAMGGetType</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetReuseInterpolation.html">PCGAMGSetReuseInterpolation</a>()`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetUseSAEstEig.html">PCGAMGSetUseSAEstEig</a>()`</font>
<a name="line1549">1549: </a><font color="#B22222">M*/</font>

<a name="line1551">1551: </a><strong><font color="#4169E1"><a name="PCCreate_GAMG"></a>PETSC_EXTERN <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PCCreate_GAMG(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc)</font></strong>
<a name="line1552">1552: </a>{
<a name="line1553">1553: </a>  PC_GAMG *pc_gamg;
<a name="line1554">1554: </a>  PC_MG   *mg;

<a name="line1556">1556: </a>  <font color="#B22222">/* register AMG type */</font>
<a name="line1557">1557: </a>  <a href="../../../../../docs/manualpages/PC/PCGAMGInitializePackage.html">PCGAMGInitializePackage</a>();

<a name="line1559">1559: </a>  <font color="#B22222">/* <a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a> is an inherited class of <a href="../../../../../docs/manualpages/PC/PCMG.html">PCMG</a>. Initialize pc as <a href="../../../../../docs/manualpages/PC/PCMG.html">PCMG</a> */</font>
<a name="line1560">1560: </a>  <a href="../../../../../docs/manualpages/PC/PCSetType.html">PCSetType</a>(pc, <a href="../../../../../docs/manualpages/PC/PCMG.html">PCMG</a>);
<a name="line1561">1561: </a>  PetscObjectChangeTypeName((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>);

<a name="line1563">1563: </a>  <font color="#B22222">/* create a supporting struct and attach it to pc */</font>
<a name="line1564">1564: </a>  <a href="../../../../../docs/manualpages/Sys/PetscNew.html">PetscNew</a>(&amp;pc_gamg);
<a name="line1565">1565: </a>  <a href="../../../../../docs/manualpages/PC/PCMGSetGalerkin.html">PCMGSetGalerkin</a>(pc, <a href="../../../../../docs/manualpages/PC/PCMGalerkinType.html">PC_MG_GALERKIN_EXTERNAL</a>);
<a name="line1566">1566: </a>  mg           = (PC_MG *)pc-&gt;data;
<a name="line1567">1567: </a>  mg-&gt;innerctx = pc_gamg;

<a name="line1569">1569: </a>  <a href="../../../../../docs/manualpages/Sys/PetscNew.html">PetscNew</a>(&amp;pc_gamg-&gt;ops);

<a name="line1571">1571: </a>  <font color="#B22222">/* these should be in subctx but repartitioning needs simple arrays */</font>
<a name="line1572">1572: </a>  pc_gamg-&gt;data_sz = 0;
<a name="line1573">1573: </a>  pc_gamg-&gt;data    = NULL;

<a name="line1575">1575: </a>  <font color="#B22222">/* overwrite the pointers of <a href="../../../../../docs/manualpages/PC/PCMG.html">PCMG</a> by the functions of base class <a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a> */</font>
<a name="line1576">1576: </a>  pc-&gt;ops-&gt;setfromoptions = PCSetFromOptions_GAMG;
<a name="line1577">1577: </a>  pc-&gt;ops-&gt;setup          = PCSetUp_GAMG;
<a name="line1578">1578: </a>  pc-&gt;ops-&gt;reset          = PCReset_GAMG;
<a name="line1579">1579: </a>  pc-&gt;ops-&gt;destroy        = PCDestroy_GAMG;
<a name="line1580">1580: </a>  mg-&gt;view                = PCView_GAMG;

<a name="line1582">1582: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetProcEqLim_C"</font>, PCGAMGSetProcEqLim_GAMG);
<a name="line1583">1583: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetCoarseEqLim_C"</font>, PCGAMGSetCoarseEqLim_GAMG);
<a name="line1584">1584: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetRepartition_C"</font>, PCGAMGSetRepartition_GAMG);
<a name="line1585">1585: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetEigenvalues_C"</font>, PCGAMGSetEigenvalues_GAMG);
<a name="line1586">1586: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetUseSAEstEig_C"</font>, PCGAMGSetUseSAEstEig_GAMG);
<a name="line1587">1587: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetReuseInterpolation_C"</font>, PCGAMGSetReuseInterpolation_GAMG);
<a name="line1588">1588: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGASMSetUseAggs_C"</font>, PCGAMGASMSetUseAggs_GAMG);
<a name="line1589">1589: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetUseParallelCoarseGridSolve_C"</font>, PCGAMGSetUseParallelCoarseGridSolve_GAMG);
<a name="line1590">1590: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetCpuPinCoarseGrids_C"</font>, PCGAMGSetCpuPinCoarseGrids_GAMG);
<a name="line1591">1591: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetCoarseGridLayoutType_C"</font>, PCGAMGSetCoarseGridLayoutType_GAMG);
<a name="line1592">1592: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetThreshold_C"</font>, PCGAMGSetThreshold_GAMG);
<a name="line1593">1593: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetRankReductionFactors_C"</font>, PCGAMGSetRankReductionFactors_GAMG);
<a name="line1594">1594: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetThresholdScale_C"</font>, PCGAMGSetThresholdScale_GAMG);
<a name="line1595">1595: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetType_C"</font>, PCGAMGSetType_GAMG);
<a name="line1596">1596: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGGetType_C"</font>, PCGAMGGetType_GAMG);
<a name="line1597">1597: </a>  <a href="../../../../../docs/manualpages/Sys/PetscObjectComposeFunction.html">PetscObjectComposeFunction</a>((<a href="../../../../../docs/manualpages/Sys/PetscObject.html">PetscObject</a>)pc, <font color="#666666">"PCGAMGSetNlevels_C"</font>, PCGAMGSetNlevels_GAMG);
<a name="line1598">1598: </a>  pc_gamg-&gt;repart                          = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>;
<a name="line1599">1599: </a>  pc_gamg-&gt;reuse_prol                      = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>;
<a name="line1600">1600: </a>  pc_gamg-&gt;use_aggs_in_asm                 = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>;
<a name="line1601">1601: </a>  pc_gamg-&gt;use_parallel_coarse_grid_solver = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>;
<a name="line1602">1602: </a>  pc_gamg-&gt;cpu_pin_coarse_grids            = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>;
<a name="line1603">1603: </a>  pc_gamg-&gt;layout_type                     = <a href="../../../../../docs/manualpages/PC/PCGAMGLayoutType.html">PCGAMG_LAYOUT_SPREAD</a>;
<a name="line1604">1604: </a>  pc_gamg-&gt;min_eq_proc                     = 50;
<a name="line1605">1605: </a>  pc_gamg-&gt;coarse_eq_limit                 = 50;
<a name="line1606">1606: </a>  <font color="#4169E1">for</font> (int i = 0; i &lt; PETSC_MG_MAXLEVELS; i++) pc_gamg-&gt;threshold[i] = -1;
<a name="line1607">1607: </a>  pc_gamg-&gt;threshold_scale = 1.;
<a name="line1608">1608: </a>  pc_gamg-&gt;Nlevels         = PETSC_MG_MAXLEVELS;
<a name="line1609">1609: </a>  pc_gamg-&gt;current_level   = 0; <font color="#B22222">/* don't need to init really */</font>
<a name="line1610">1610: </a>  pc_gamg-&gt;use_sa_esteig   = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>;
<a name="line1611">1611: </a>  pc_gamg-&gt;emin            = 0;
<a name="line1612">1612: </a>  pc_gamg-&gt;emax            = 0;

<a name="line1614">1614: </a>  pc_gamg-&gt;ops-&gt;createlevel = PCGAMGCreateLevel_GAMG;

<a name="line1616">1616: </a>  <font color="#B22222">/* PCSetUp_GAMG assumes that the type has been set, so set it to the default now */</font>
<a name="line1617">1617: </a>  <a href="../../../../../docs/manualpages/PC/PCGAMGSetType.html">PCGAMGSetType</a>(pc, PCGAMGAGG);
<a name="line1618">1618: </a>  <font color="#4169E1">return</font> 0;
<a name="line1619">1619: </a>}

<a name="line1621">1621: </a><font color="#B22222">/*@C</font>
<a name="line1622">1622: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCGAMGInitializePackage.html">PCGAMGInitializePackage</a> - This function initializes everything in the `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` package. It is called</font>
<a name="line1623">1623: </a><font color="#B22222">    from `<a href="../../../../../docs/manualpages/KSP/PCInitializePackage.html">PCInitializePackage</a>()`.</font>

<a name="line1625">1625: </a><font color="#B22222"> Level: developer</font>

<a name="line1627">1627: </a><font color="#B22222"> .seealso: `<a href="../../../../../docs/manualpages/Sys/PetscInitialize.html">PetscInitialize</a>()`</font>
<a name="line1628">1628: </a><font color="#B22222">@*/</font>
<a name="line1629">1629: </a><strong><font color="#4169E1"><a name="PCGAMGInitializePackage"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGInitializePackage.html">PCGAMGInitializePackage</a>(void)</font></strong>
<a name="line1630">1630: </a>{
<a name="line1631">1631: </a>  <a href="../../../../../docs/manualpages/Sys/PetscInt.html">PetscInt</a> l;

<a name="line1633">1633: </a>  <font color="#4169E1">if</font> (PCGAMGPackageInitialized) <font color="#4169E1">return</font> 0;
<a name="line1634">1634: </a>  PCGAMGPackageInitialized = <a href="../../../../../docs/manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>;
<a name="line1635">1635: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFunctionListAdd.html">PetscFunctionListAdd</a>(&amp;GAMGList, PCGAMGGEO, PCCreateGAMG_GEO);
<a name="line1636">1636: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFunctionListAdd.html">PetscFunctionListAdd</a>(&amp;GAMGList, PCGAMGAGG, PCCreateGAMG_AGG);
<a name="line1637">1637: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFunctionListAdd.html">PetscFunctionListAdd</a>(&amp;GAMGList, PCGAMGCLASSICAL, PCCreateGAMG_Classical);
<a name="line1638">1638: </a>  <a href="../../../../../docs/manualpages/Sys/PetscRegisterFinalize.html">PetscRegisterFinalize</a>(<a href="../../../../../docs/manualpages/PC/PCGAMGFinalizePackage.html">PCGAMGFinalizePackage</a>);

<a name="line1640">1640: </a>  <font color="#B22222">/* general events */</font>
<a name="line1641">1641: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">"PCSetUp_GAMG+"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_SETUP]);
<a name="line1642">1642: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">" PCGAMGCreateG"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_GRAPH]);
<a name="line1643">1643: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">" GAMG Coarsen"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_COARSEN]);
<a name="line1644">1644: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">"  GAMG MIS/Agg"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_MIS]);
<a name="line1645">1645: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">" PCGAMGProl"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_PROL]);
<a name="line1646">1646: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">"  GAMG Prol-col"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_PROLA]);
<a name="line1647">1647: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">"  GAMG Prol-lift"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_PROLB]);
<a name="line1648">1648: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">" PCGAMGOptProl"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_OPT]);
<a name="line1649">1649: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">"  GAMG smooth"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_OPTSM]);
<a name="line1650">1650: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">" PCGAMGCreateL"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_LEVEL]);
<a name="line1651">1651: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">"  GAMG PtAP"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_PTAP]);
<a name="line1652">1652: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">"  GAMG Reduce"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_REDUCE]);
<a name="line1653">1653: </a>  <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(<font color="#666666">"   GAMG Repart"</font>, PC_CLASSID, &amp;petsc_gamg_setup_events[GAMG_REPART]);
<a name="line1654">1654: </a>  <font color="#B22222">/* <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>("   GAMG Inv-Srt", PC_CLASSID, &amp;petsc_gamg_setup_events[SET13]); */</font>
<a name="line1655">1655: </a>  <font color="#B22222">/* <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>("   GAMG Move A", PC_CLASSID, &amp;petsc_gamg_setup_events[SET14]); */</font>
<a name="line1656">1656: </a>  <font color="#B22222">/* <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>("   GAMG Move P", PC_CLASSID, &amp;petsc_gamg_setup_events[SET15]); */</font>
<a name="line1657">1657: </a>  <font color="#4169E1">for</font> (l = 0; l &lt; PETSC_MG_MAXLEVELS; l++) {
<a name="line1658">1658: </a>    char ename[32];

<a name="line1660">1660: </a>    <a href="../../../../../docs/manualpages/Sys/PetscSNPrintf.html">PetscSNPrintf</a>(ename, <font color="#4169E1">sizeof</font>(ename), <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a> Squ l%02"</font> PetscInt_FMT, l);
<a name="line1661">1661: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(ename, PC_CLASSID, &amp;petsc_gamg_setup_matmat_events[l][0]);
<a name="line1662">1662: </a>    <a href="../../../../../docs/manualpages/Sys/PetscSNPrintf.html">PetscSNPrintf</a>(ename, <font color="#4169E1">sizeof</font>(ename), <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a> Gal l%02"</font> PetscInt_FMT, l);
<a name="line1663">1663: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(ename, PC_CLASSID, &amp;petsc_gamg_setup_matmat_events[l][1]);
<a name="line1664">1664: </a>    <a href="../../../../../docs/manualpages/Sys/PetscSNPrintf.html">PetscSNPrintf</a>(ename, <font color="#4169E1">sizeof</font>(ename), <font color="#666666">"<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a> Opt l%02"</font> PetscInt_FMT, l);
<a name="line1665">1665: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscLogEventRegister.html">PetscLogEventRegister</a>(ename, PC_CLASSID, &amp;petsc_gamg_setup_matmat_events[l][2]);
<a name="line1666">1666: </a>  }
<a name="line1667">1667: </a><font color="#A020F0">#if defined(GAMG_STAGES)</font>
<a name="line1668">1668: </a>  { <font color="#B22222">/* create timer stages */</font>
<a name="line1669">1669: </a>    char str[32];
<a name="line1670">1670: </a>    sprintf(str, <font color="#666666">"GAMG Level %d"</font>, 0);
<a name="line1671">1671: </a>    <a href="../../../../../docs/manualpages/Profiling/PetscLogStageRegister.html">PetscLogStageRegister</a>(str, &amp;gamg_stages[0]);
<a name="line1672">1672: </a>  }
<a name="line1673">1673: </a><font color="#A020F0">#endif</font>
<a name="line1674">1674: </a>  <font color="#4169E1">return</font> 0;
<a name="line1675">1675: </a>}

<a name="line1677">1677: </a><font color="#B22222">/*@C</font>
<a name="line1678">1678: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCGAMGFinalizePackage.html">PCGAMGFinalizePackage</a> - This function frees everything from the `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` package. It is</font>
<a name="line1679">1679: </a><font color="#B22222">    called from `<a href="../../../../../docs/manualpages/Sys/PetscFinalize.html">PetscFinalize</a>()` automatically.</font>

<a name="line1681">1681: </a><font color="#B22222"> Level: developer</font>

<a name="line1683">1683: </a><font color="#B22222"> .seealso: `<a href="../../../../../docs/manualpages/Sys/PetscFinalize.html">PetscFinalize</a>()`</font>
<a name="line1684">1684: </a><font color="#B22222">@*/</font>
<a name="line1685">1685: </a><strong><font color="#4169E1"><a name="PCGAMGFinalizePackage"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGFinalizePackage.html">PCGAMGFinalizePackage</a>(void)</font></strong>
<a name="line1686">1686: </a>{
<a name="line1687">1687: </a>  PCGAMGPackageInitialized = <a href="../../../../../docs/manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>;
<a name="line1688">1688: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFunctionListDestroy.html">PetscFunctionListDestroy</a>(&amp;GAMGList);
<a name="line1689">1689: </a>  <font color="#4169E1">return</font> 0;
<a name="line1690">1690: </a>}

<a name="line1692">1692: </a><font color="#B22222">/*@C</font>
<a name="line1693">1693: </a><font color="#B22222"> <a href="../../../../../docs/manualpages/PC/PCGAMGRegister.html">PCGAMGRegister</a> - Register a `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` implementation.</font>

<a name="line1695">1695: </a><font color="#B22222"> Input Parameters:</font>
<a name="line1696">1696: </a><font color="#B22222"> + type - string that will be used as the name of the `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>` type.</font>
<a name="line1697">1697: </a><font color="#B22222"> - create - function for creating the gamg context.</font>

<a name="line1699">1699: </a><font color="#B22222">  Level: developer</font>

<a name="line1701">1701: </a><font color="#B22222"> .seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMGType.html">PCGAMGType</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetType.html">PCGAMGSetType</a>()`</font>
<a name="line1702">1702: </a><font color="#B22222">@*/</font>
<a name="line1703">1703: </a><strong><font color="#4169E1"><a name="PCGAMGRegister"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGRegister.html">PCGAMGRegister</a>(<a href="../../../../../docs/manualpages/PC/PCGAMGType.html">PCGAMGType</a> type, <a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> (*create)(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a>))</font></strong>
<a name="line1704">1704: </a>{
<a name="line1705">1705: </a>  <a href="../../../../../docs/manualpages/PC/PCGAMGInitializePackage.html">PCGAMGInitializePackage</a>();
<a name="line1706">1706: </a>  <a href="../../../../../docs/manualpages/Sys/PetscFunctionListAdd.html">PetscFunctionListAdd</a>(&amp;GAMGList, type, create);
<a name="line1707">1707: </a>  <font color="#4169E1">return</font> 0;
<a name="line1708">1708: </a>}

<a name="line1710">1710: </a><font color="#B22222">/*@C</font>
<a name="line1711">1711: </a><font color="#B22222">    <a href="../../../../../docs/manualpages/PC/PCGAMGCreateGraph.html">PCGAMGCreateGraph</a> - Creates a graph that is used by the ``<a href="../../../../../docs/manualpages/PC/PCGAMGType.html">PCGAMGType</a>`` in the coarsening process</font>

<a name="line1713">1713: </a><font color="#B22222">   Input Parameters:</font>
<a name="line1714">1714: </a><font color="#B22222">+  pc - the `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`</font>
<a name="line1715">1715: </a><font color="#B22222">-  A - the matrix, for any level</font>

<a name="line1717">1717: </a><font color="#B22222">   Output Parameter:</font>
<a name="line1718">1718: </a><font color="#B22222">.  G - the graph</font>

<a name="line1720">1720: </a><font color="#B22222">  Level: advanced</font>

<a name="line1722">1722: </a><font color="#B22222"> .seealso: `<a href="../../../../../docs/manualpages/PC/PCGAMGType.html">PCGAMGType</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMG.html">PCGAMG</a>`, `<a href="../../../../../docs/manualpages/PC/PCGAMGSetType.html">PCGAMGSetType</a>()`</font>
<a name="line1723">1723: </a><font color="#B22222">@*/</font>
<a name="line1724">1724: </a><strong><font color="#4169E1"><a name="PCGAMGCreateGraph"></a><a href="../../../../../docs/manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../docs/manualpages/PC/PCGAMGCreateGraph.html">PCGAMGCreateGraph</a>(<a href="../../../../../docs/manualpages/PC/PC.html">PC</a> pc, <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a> A, <a href="../../../../../docs/manualpages/Mat/Mat.html">Mat</a> *G)</font></strong>
<a name="line1725">1725: </a>{
<a name="line1726">1726: </a>  PC_MG   *mg      = (PC_MG *)pc-&gt;data;
<a name="line1727">1727: </a>  PC_GAMG *pc_gamg = (PC_GAMG *)mg-&gt;innerctx;

<a name="line1729">1729: </a>  pc_gamg-&gt;ops-&gt;creategraph(pc, A, G);
<a name="line1730">1730: </a>  <font color="#4169E1">return</font> 0;
<a name="line1731">1731: </a>}
</pre>
</body>

</html>
