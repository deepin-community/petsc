<center><a href="https://gitlab.com/petsc/petsc/-/blob/183cd29ee28cacc3ee84c625478d276606b77b2c/src/dm/dt/dualspace/interface/dualspace.c">Actual source code: dualspace.c</a></center><br>

<html>
<head>
<title></title>
<meta name="generator" content="c2html 0.9.4">
<meta name="date" content="2024-03-29T14:12:25+00:00">
</head>

<body bgcolor="#FFFFFF">
<pre width="80">
<a name="line1">  1: </a>#include <A href="../../../../../include/petsc/private/petscfeimpl.h.html">&lt;petsc/private/petscfeimpl.h&gt;</A>
<a name="line2">  2: </a>#include <A href="../../../../../include/petscdmplex.h.html">&lt;petscdmplex.h&gt;</A>

<a name="line4">  4: </a><a href="../../../../../manualpages/Sys/PetscClassId.html">PetscClassId</a> PETSCDUALSPACE_CLASSID = 0;

<a name="line6">  6: </a><a href="../../../../../manualpages/Profiling/PetscLogEvent.html">PetscLogEvent</a> PETSCDUALSPACE_SetUp;

<a name="line8">  8: </a><a href="../../../../../manualpages/Sys/PetscFunctionList.html">PetscFunctionList</a> PetscDualSpaceList              = NULL;
<a name="line9">  9: </a><a href="../../../../../manualpages/Sys/PetscBool.html">PetscBool</a>         PetscDualSpaceRegisterAllCalled = <a href="../../../../../manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>;

<a name="line11"> 11: </a><font color="#B22222">/*</font>
<a name="line12"> 12: </a><font color="#B22222">  PetscDualSpaceLatticePointLexicographic_Internal - Returns all tuples of size 'len' with nonnegative integers that sum up to at most 'max'.</font>
<a name="line13"> 13: </a><font color="#B22222">                                                     Ordering is lexicographic with lowest index as least significant in ordering.</font>
<a name="line14"> 14: </a><font color="#B22222">                                                     e.g. for len == 2 and max == 2, this will return, in order, {0,0}, {1,0}, {2,0}, {0,1}, {1,1}, {0,2}.</font>

<a name="line16"> 16: </a><font color="#B22222">  Input Parameters:</font>
<a name="line17"> 17: </a><font color="#B22222">+ len - The length of the tuple</font>
<a name="line18"> 18: </a><font color="#B22222">. max - The maximum sum</font>
<a name="line19"> 19: </a><font color="#B22222">- tup - A tuple of length len+1: tup[len] &gt; 0 indicates a stopping condition</font>

<a name="line21"> 21: </a><font color="#B22222">  Output Parameter:</font>
<a name="line22"> 22: </a><font color="#B22222">. tup - A tuple of `len` integers whose sum is at most `max`</font>

<a name="line24"> 24: </a><font color="#B22222">  Level: developer</font>

<a name="line26"> 26: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceType.html">PetscDualSpaceType</a>`, `PetscDualSpaceTensorPointLexicographic_Internal()`</font>
<a name="line27"> 27: </a><font color="#B22222">*/</font>
<a name="line28"> 28: </a><strong><font color="#4169E1"><a name="PetscDualSpaceLatticePointLexicographic_Internal"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PetscDualSpaceLatticePointLexicographic_Internal(<a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> len, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> max, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> tup[])</font></strong>
<a name="line29"> 29: </a>{
<a name="line30"> 30: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line31"> 31: </a>  <font color="#4169E1">while</font> (len--) {
<a name="line32"> 32: </a>    max -= tup[len];
<a name="line33"> 33: </a>    <font color="#4169E1">if</font> (!max) {
<a name="line34"> 34: </a>      tup[len] = 0;
<a name="line35"> 35: </a>      <font color="#4169E1">break</font>;
<a name="line36"> 36: </a>    }
<a name="line37"> 37: </a>  }
<a name="line38"> 38: </a>  tup[++len]++;
<a name="line39"> 39: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line40"> 40: </a>}

<a name="line42"> 42: </a><font color="#B22222">/*</font>
<a name="line43"> 43: </a><font color="#B22222">  PetscDualSpaceTensorPointLexicographic_Internal - Returns all tuples of size 'len' with nonnegative integers that are all less than or equal to 'max'.</font>
<a name="line44"> 44: </a><font color="#B22222">                                                    Ordering is lexicographic with lowest index as least significant in ordering.</font>
<a name="line45"> 45: </a><font color="#B22222">                                                    e.g. for len == 2 and max == 2, this will return, in order, {0,0}, {1,0}, {2,0}, {0,1}, {1,1}, {2,1}, {0,2}, {1,2}, {2,2}.</font>

<a name="line47"> 47: </a><font color="#B22222">  Input Parameters:</font>
<a name="line48"> 48: </a><font color="#B22222">+ len - The length of the tuple</font>
<a name="line49"> 49: </a><font color="#B22222">. max - The maximum value</font>
<a name="line50"> 50: </a><font color="#B22222">- tup - A tuple of length len+1: tup[len] &gt; 0 indicates a stopping condition</font>

<a name="line52"> 52: </a><font color="#B22222">  Output Parameter:</font>
<a name="line53"> 53: </a><font color="#B22222">. tup - A tuple of `len` integers whose entries are at most `max`</font>

<a name="line55"> 55: </a><font color="#B22222">  Level: developer</font>

<a name="line57"> 57: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceType.html">PetscDualSpaceType</a>`, `PetscDualSpaceLatticePointLexicographic_Internal()`</font>
<a name="line58"> 58: </a><font color="#B22222">*/</font>
<a name="line59"> 59: </a><strong><font color="#4169E1"><a name="PetscDualSpaceTensorPointLexicographic_Internal"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PetscDualSpaceTensorPointLexicographic_Internal(<a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> len, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> max, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> tup[])</font></strong>
<a name="line60"> 60: </a>{
<a name="line61"> 61: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> i;

<a name="line63"> 63: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line64"> 64: </a>  <font color="#4169E1">for</font> (i = 0; i &lt; len; i++) {
<a name="line65"> 65: </a>    <font color="#4169E1">if</font> (tup[i] &lt; max) {
<a name="line66"> 66: </a>      <font color="#4169E1">break</font>;
<a name="line67"> 67: </a>    } <font color="#4169E1">else</font> {
<a name="line68"> 68: </a>      tup[i] = 0;
<a name="line69"> 69: </a>    }
<a name="line70"> 70: </a>  }
<a name="line71"> 71: </a>  tup[i]++;
<a name="line72"> 72: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line73"> 73: </a>}

<a name="line75"> 75: </a><font color="#B22222">/*@C</font>
<a name="line76"> 76: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceRegister.html">PetscDualSpaceRegister</a> - Adds a new `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceType.html">PetscDualSpaceType</a>`</font>

<a name="line78"> 78: </a><font color="#B22222">  Not Collective</font>

<a name="line80"> 80: </a><font color="#B22222">  Input Parameters:</font>
<a name="line81"> 81: </a><font color="#B22222">+ sname    - The name of a new user-defined creation routine</font>
<a name="line82"> 82: </a><font color="#B22222">- function - The creation routine</font>

<a name="line84"> 84: </a><font color="#B22222">  Example Usage:</font>
<a name="line85"> 85: </a><font color="#B22222">.vb</font>
<a name="line86"> 86: </a><font color="#B22222">    <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceRegister.html">PetscDualSpaceRegister</a>("my_space", MyPetscDualSpaceCreate);</font>
<a name="line87"> 87: </a><font color="#B22222">.ve</font>

<a name="line89"> 89: </a><font color="#B22222">  Then, your <a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> type can be chosen with the procedural interface via</font>
<a name="line90"> 90: </a><font color="#B22222">.vb</font>
<a name="line91"> 91: </a><font color="#B22222">    <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>(<a href="../../../../../manualpages/Sys/MPI_Comm.html">MPI_Comm</a>, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> *);</font>
<a name="line92"> 92: </a><font color="#B22222">    <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetType.html">PetscDualSpaceSetType</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>, "my_dual_space");</font>
<a name="line93"> 93: </a><font color="#B22222">.ve</font>
<a name="line94"> 94: </a><font color="#B22222">  or at runtime via the option</font>
<a name="line95"> 95: </a><font color="#B22222">.vb</font>
<a name="line96"> 96: </a><font color="#B22222">    -petscdualspace_type my_dual_space</font>
<a name="line97"> 97: </a><font color="#B22222">.ve</font>

<a name="line99"> 99: </a><font color="#B22222">  Level: advanced</font>

<a name="line101">101: </a><font color="#B22222">  Note:</font>
<a name="line102">102: </a><font color="#B22222">  `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceRegister.html">PetscDualSpaceRegister</a>()` may be called multiple times to add several user-defined `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line104">104: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceType.html">PetscDualSpaceType</a>`, `<a href="../../../../../manualpages/DM/PetscDualSpaceRegisterAll.html">PetscDualSpaceRegisterAll</a>()`, `PetscDualSpaceRegisterDestroy()`</font>
<a name="line105">105: </a><font color="#B22222">@*/</font>
<a name="line106">106: </a><strong><font color="#4169E1"><a name="PetscDualSpaceRegister"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceRegister.html">PetscDualSpaceRegister</a>(const char sname[], <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> (*function)(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>))</font></strong>
<a name="line107">107: </a>{
<a name="line108">108: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line109">109: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscFunctionListAdd.html">PetscFunctionListAdd</a>(&amp;PetscDualSpaceList, sname, function));
<a name="line110">110: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line111">111: </a>}

<a name="line113">113: </a><font color="#B22222">/*@C</font>
<a name="line114">114: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetType.html">PetscDualSpaceSetType</a> - Builds a particular `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` based on its `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceType.html">PetscDualSpaceType</a>`</font>

<a name="line116">116: </a><font color="#B22222">  Collective</font>

<a name="line118">118: </a><font color="#B22222">  Input Parameters:</font>
<a name="line119">119: </a><font color="#B22222">+ sp   - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>
<a name="line120">120: </a><font color="#B22222">- name - The kind of space</font>

<a name="line122">122: </a><font color="#B22222">  Options Database Key:</font>
<a name="line123">123: </a><font color="#B22222">. -petscdualspace_type &lt;type&gt; - Sets the <a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> type; use -help for a list of available types</font>

<a name="line125">125: </a><font color="#B22222">  Level: intermediate</font>

<a name="line127">127: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceType.html">PetscDualSpaceType</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetType.html">PetscDualSpaceGetType</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line128">128: </a><font color="#B22222">@*/</font>
<a name="line129">129: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetType"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetType.html">PetscDualSpaceSetType</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceType.html">PetscDualSpaceType</a> name)</font></strong>
<a name="line130">130: </a>{
<a name="line131">131: </a>  <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> (*r)(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>);
<a name="line132">132: </a>  <a href="../../../../../manualpages/Sys/PetscBool.html">PetscBool</a> match;

<a name="line134">134: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line136">136: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscObjectTypeCompare.html">PetscObjectTypeCompare</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp, name, &amp;match));
<a name="line137">137: </a>  <font color="#4169E1">if</font> (match) <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);

<a name="line139">139: </a>  <font color="#4169E1">if</font> (!PetscDualSpaceRegisterAllCalled) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/PetscDualSpaceRegisterAll.html">PetscDualSpaceRegisterAll</a>());
<a name="line140">140: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscFunctionListFind.html">PetscFunctionListFind</a>(PetscDualSpaceList, name, &amp;r));
<a name="line141">141: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(r, <a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_UNKNOWN_TYPE</a>, <font color="#666666">"Unknown <a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> type: %s"</font>, name);

<a name="line143">143: </a>  <a href="../../../../../manualpages/Sys/PetscTryTypeMethod.html">PetscTryTypeMethod</a>(sp, destroy);
<a name="line144">144: </a>  sp-&gt;ops-&gt;destroy = NULL;

<a name="line146">146: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>((*r)(sp));
<a name="line147">147: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(PetscObjectChangeTypeName((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp, name));
<a name="line148">148: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line149">149: </a>}

<a name="line151">151: </a><font color="#B22222">/*@C</font>
<a name="line152">152: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetType.html">PetscDualSpaceGetType</a> - Gets the `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceType.html">PetscDualSpaceType</a>` name (as a string) from the object.</font>

<a name="line154">154: </a><font color="#B22222">  Not Collective</font>

<a name="line156">156: </a><font color="#B22222">  Input Parameter:</font>
<a name="line157">157: </a><font color="#B22222">. sp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line159">159: </a><font color="#B22222">  Output Parameter:</font>
<a name="line160">160: </a><font color="#B22222">. name - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceType.html">PetscDualSpaceType</a>` name</font>

<a name="line162">162: </a><font color="#B22222">  Level: intermediate</font>

<a name="line164">164: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceType.html">PetscDualSpaceType</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetType.html">PetscDualSpaceSetType</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line165">165: </a><font color="#B22222">@*/</font>
<a name="line166">166: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetType"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetType.html">PetscDualSpaceGetType</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceType.html">PetscDualSpaceType</a> *name)</font></strong>
<a name="line167">167: </a>{
<a name="line168">168: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line170">170: </a>  PetscAssertPointer(name, 2);
<a name="line171">171: </a>  <font color="#4169E1">if</font> (!PetscDualSpaceRegisterAllCalled) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/PetscDualSpaceRegisterAll.html">PetscDualSpaceRegisterAll</a>());
<a name="line172">172: </a>  *name = ((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp)-&gt;type_name;
<a name="line173">173: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line174">174: </a>}

<a name="line176">176: </a><strong><font color="#4169E1"><a name="PetscDualSpaceView_ASCII"></a>static <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PetscDualSpaceView_ASCII(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Viewer/PetscViewer.html">PetscViewer</a> v)</font></strong>
<a name="line177">177: </a>{
<a name="line178">178: </a>  <a href="../../../../../manualpages/Viewer/PetscViewerFormat.html">PetscViewerFormat</a> format;
<a name="line179">179: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>          pdim, f;

<a name="line181">181: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line182">182: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDimension.html">PetscDualSpaceGetDimension</a>(sp, &amp;pdim));
<a name="line183">183: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscObjectPrintClassNamePrefixType.html">PetscObjectPrintClassNamePrefixType</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp, v));
<a name="line184">184: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Viewer/PetscViewerASCIIPushTab.html">PetscViewerASCIIPushTab</a>(v));
<a name="line185">185: </a>  <font color="#4169E1">if</font> (sp-&gt;k != 0 &amp;&amp; sp-&gt;k != <a href="../../../../../manualpages/DT/PETSC_FORM_DEGREE_UNDEFINED.html">PETSC_FORM_DEGREE_UNDEFINED</a>) {
<a name="line186">186: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(v, <font color="#666666">"Dual space for %"</font> PetscInt_FMT <font color="#666666">"-forms %swith %"</font> PetscInt_FMT <font color="#666666">" components, size %"</font> PetscInt_FMT <font color="#666666">"\n"</font>, <a href="../../../../../manualpages/Sys/PetscAbsInt.html">PetscAbsInt</a>(sp-&gt;k), sp-&gt;k &lt; 0 ? <font color="#666666">"(stored in dual form) "</font> : <font color="#666666">""</font>, sp-&gt;Nc, pdim));
<a name="line187">187: </a>  } <font color="#4169E1">else</font> {
<a name="line188">188: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(v, <font color="#666666">"Dual space with %"</font> PetscInt_FMT <font color="#666666">" components, size %"</font> PetscInt_FMT <font color="#666666">"\n"</font>, sp-&gt;Nc, pdim));
<a name="line189">189: </a>  }
<a name="line190">190: </a>  <a href="../../../../../manualpages/Sys/PetscTryTypeMethod.html">PetscTryTypeMethod</a>(sp, view, v);
<a name="line191">191: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Viewer/PetscViewerGetFormat.html">PetscViewerGetFormat</a>(v, &amp;format));
<a name="line192">192: </a>  <font color="#4169E1">if</font> (format == <a href="../../../../../manualpages/Viewer/PetscViewerFormat.html">PETSC_VIEWER_ASCII_INFO_DETAIL</a>) {
<a name="line193">193: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Viewer/PetscViewerASCIIPushTab.html">PetscViewerASCIIPushTab</a>(v));
<a name="line194">194: </a>    <font color="#4169E1">for</font> (f = 0; f &lt; pdim; ++f) {
<a name="line195">195: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Viewer/PetscViewerASCIIPrintf.html">PetscViewerASCIIPrintf</a>(v, <font color="#666666">"Dual basis vector %"</font> PetscInt_FMT <font color="#666666">"\n"</font>, f));
<a name="line196">196: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Viewer/PetscViewerASCIIPushTab.html">PetscViewerASCIIPushTab</a>(v));
<a name="line197">197: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureView.html">PetscQuadratureView</a>(sp-&gt;functional[f], v));
<a name="line198">198: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Viewer/PetscViewerASCIIPopTab.html">PetscViewerASCIIPopTab</a>(v));
<a name="line199">199: </a>    }
<a name="line200">200: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Viewer/PetscViewerASCIIPopTab.html">PetscViewerASCIIPopTab</a>(v));
<a name="line201">201: </a>  }
<a name="line202">202: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Viewer/PetscViewerASCIIPopTab.html">PetscViewerASCIIPopTab</a>(v));
<a name="line203">203: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line204">204: </a>}

<a name="line206">206: </a><font color="#B22222">/*@C</font>
<a name="line207">207: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceViewFromOptions.html">PetscDualSpaceViewFromOptions</a> - View a `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` based on values in the options database</font>

<a name="line209">209: </a><font color="#B22222">  Collective</font>

<a name="line211">211: </a><font color="#B22222">  Input Parameters:</font>
<a name="line212">212: </a><font color="#B22222">+ A    - the `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>
<a name="line213">213: </a><font color="#B22222">. obj  - Optional object, provides the options prefix</font>
<a name="line214">214: </a><font color="#B22222">- name - command line option name</font>

<a name="line216">216: </a><font color="#B22222">  Level: intermediate</font>

<a name="line218">218: </a><font color="#B22222">  Note:</font>
<a name="line219">219: </a><font color="#B22222">  See `<a href="../../../../../manualpages/Sys/PetscObjectViewFromOptions.html">PetscObjectViewFromOptions</a>()` for possible command line values</font>

<a name="line221">221: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceView.html">PetscDualSpaceView</a>()`, `<a href="../../../../../manualpages/Sys/PetscObjectViewFromOptions.html">PetscObjectViewFromOptions</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line222">222: </a><font color="#B22222">@*/</font>
<a name="line223">223: </a><strong><font color="#4169E1"><a name="PetscDualSpaceViewFromOptions"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceViewFromOptions.html">PetscDualSpaceViewFromOptions</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> A, <a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a> obj, const char name[])</font></strong>
<a name="line224">224: </a>{
<a name="line225">225: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line227">227: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscObjectViewFromOptions.html">PetscObjectViewFromOptions</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)A, obj, name));
<a name="line228">228: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line229">229: </a>}

<a name="line231">231: </a><font color="#B22222">/*@</font>
<a name="line232">232: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceView.html">PetscDualSpaceView</a> - Views a `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line234">234: </a><font color="#B22222">  Collective</font>

<a name="line236">236: </a><font color="#B22222">  Input Parameters:</font>
<a name="line237">237: </a><font color="#B22222">+ sp - the `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object to view</font>
<a name="line238">238: </a><font color="#B22222">- v  - the viewer</font>

<a name="line240">240: </a><font color="#B22222">  Level: beginner</font>

<a name="line242">242: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/Viewer/PetscViewer.html">PetscViewer</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceDestroy.html">PetscDualSpaceDestroy</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line243">243: </a><font color="#B22222">@*/</font>
<a name="line244">244: </a><strong><font color="#4169E1"><a name="PetscDualSpaceView"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceView.html">PetscDualSpaceView</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Viewer/PetscViewer.html">PetscViewer</a> v)</font></strong>
<a name="line245">245: </a>{
<a name="line246">246: </a>  <a href="../../../../../manualpages/Sys/PetscBool.html">PetscBool</a> iascii;

<a name="line248">248: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line251">251: </a>  <font color="#4169E1">if</font> (!v) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Viewer/PetscViewerASCIIGetStdout.html">PetscViewerASCIIGetStdout</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp), &amp;v));
<a name="line252">252: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscObjectTypeCompare.html">PetscObjectTypeCompare</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)v, <a href="../../../../../manualpages/Viewer/PETSCVIEWERASCII.html">PETSCVIEWERASCII</a>, &amp;iascii));
<a name="line253">253: </a>  <font color="#4169E1">if</font> (iascii) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(PetscDualSpaceView_ASCII(sp, v));
<a name="line254">254: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line255">255: </a>}

<a name="line257">257: </a><font color="#B22222">/*@</font>
<a name="line258">258: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetFromOptions.html">PetscDualSpaceSetFromOptions</a> - sets parameters in a `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` from the options database</font>

<a name="line260">260: </a><font color="#B22222">  Collective</font>

<a name="line262">262: </a><font color="#B22222">  Input Parameter:</font>
<a name="line263">263: </a><font color="#B22222">. sp - the `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object to set options for</font>

<a name="line265">265: </a><font color="#B22222">  Options Database Keys:</font>
<a name="line266">266: </a><font color="#B22222">+ -petscdualspace_order &lt;order&gt;                 - the approximation order of the space</font>
<a name="line267">267: </a><font color="#B22222">. -petscdualspace_form_degree &lt;deg&gt;             - the form degree, say 0 for point evaluations, or 2 for area integrals</font>
<a name="line268">268: </a><font color="#B22222">. -petscdualspace_components &lt;c&gt;                - the number of components, say d for a vector field</font>
<a name="line269">269: </a><font color="#B22222">. -petscdualspace_refcell &lt;celltype&gt;            - Reference cell type name</font>
<a name="line270">270: </a><font color="#B22222">. -petscdualspace_lagrange_continuity           - Flag for continuous element</font>
<a name="line271">271: </a><font color="#B22222">. -petscdualspace_lagrange_tensor               - Flag for tensor dual space</font>
<a name="line272">272: </a><font color="#B22222">. -petscdualspace_lagrange_trimmed              - Flag for trimmed dual space</font>
<a name="line273">273: </a><font color="#B22222">. -petscdualspace_lagrange_node_type &lt;nodetype&gt; - Lagrange node location type</font>
<a name="line274">274: </a><font color="#B22222">. -petscdualspace_lagrange_node_endpoints       - Flag for nodes that include endpoints</font>
<a name="line275">275: </a><font color="#B22222">. -petscdualspace_lagrange_node_exponent        - Gauss-Jacobi weight function exponent</font>
<a name="line276">276: </a><font color="#B22222">. -petscdualspace_lagrange_use_moments          - Use moments (where appropriate) for functionals</font>
<a name="line277">277: </a><font color="#B22222">- -petscdualspace_lagrange_moment_order &lt;order&gt; - Quadrature order for moment functionals</font>

<a name="line279">279: </a><font color="#B22222">  Level: intermediate</font>

<a name="line281">281: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceView.html">PetscDualSpaceView</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/Sys/PetscObjectSetFromOptions.html">PetscObjectSetFromOptions</a>()`</font>
<a name="line282">282: </a><font color="#B22222">@*/</font>
<a name="line283">283: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetFromOptions"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetFromOptions.html">PetscDualSpaceSetFromOptions</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp)</font></strong>
<a name="line284">284: </a>{
<a name="line285">285: </a>  <a href="../../../../../manualpages/DM/DMPolytopeType.html">DMPolytopeType</a> refCell = <a href="../../../../../manualpages/DM/DMPolytopeType.html">DM_POLYTOPE_TRIANGLE</a>;
<a name="line286">286: </a>  const char    *defaultType;
<a name="line287">287: </a>  char           name[256];
<a name="line288">288: </a>  <a href="../../../../../manualpages/Sys/PetscBool.html">PetscBool</a>      flg;

<a name="line290">290: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line292">292: </a>  <font color="#4169E1">if</font> (!((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp)-&gt;type_name) {
<a name="line293">293: </a>    defaultType = <a href="../../../../../manualpages/DUALSPACE/PETSCDUALSPACELAGRANGE.html">PETSCDUALSPACELAGRANGE</a>;
<a name="line294">294: </a>  } <font color="#4169E1">else</font> {
<a name="line295">295: </a>    defaultType = ((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp)-&gt;type_name;
<a name="line296">296: </a>  }
<a name="line297">297: </a>  <font color="#4169E1">if</font> (!PetscSpaceRegisterAllCalled) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/PetscSpaceRegisterAll.html">PetscSpaceRegisterAll</a>());

<a name="line299">299: </a>  <a href="../../../../../manualpages/Sys/PetscObjectOptionsBegin.html">PetscObjectOptionsBegin</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp);
<a name="line300">300: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscOptionsFList.html">PetscOptionsFList</a>(<font color="#666666">"-petscdualspace_type"</font>, <font color="#666666">"Dual space"</font>, <font color="#666666">"<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetType.html">PetscDualSpaceSetType</a>"</font>, PetscDualSpaceList, defaultType, name, 256, &amp;flg));
<a name="line301">301: </a>  <font color="#4169E1">if</font> (flg) {
<a name="line302">302: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetType.html">PetscDualSpaceSetType</a>(sp, name));
<a name="line303">303: </a>  } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (!((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp)-&gt;type_name) {
<a name="line304">304: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetType.html">PetscDualSpaceSetType</a>(sp, defaultType));
<a name="line305">305: </a>  }
<a name="line306">306: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscOptionsBoundedInt.html">PetscOptionsBoundedInt</a>(<font color="#666666">"-petscdualspace_order"</font>, <font color="#666666">"The approximation order"</font>, <font color="#666666">"<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetOrder.html">PetscDualSpaceSetOrder</a>"</font>, sp-&gt;order, &amp;sp-&gt;order, NULL, 0));
<a name="line307">307: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscOptionsInt.html">PetscOptionsInt</a>(<font color="#666666">"-petscdualspace_form_degree"</font>, <font color="#666666">"The form degree of the dofs"</font>, <font color="#666666">"<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetFormDegree.html">PetscDualSpaceSetFormDegree</a>"</font>, sp-&gt;k, &amp;sp-&gt;k, NULL));
<a name="line308">308: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscOptionsBoundedInt.html">PetscOptionsBoundedInt</a>(<font color="#666666">"-petscdualspace_components"</font>, <font color="#666666">"The number of components"</font>, <font color="#666666">"<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetNumComponents.html">PetscDualSpaceSetNumComponents</a>"</font>, sp-&gt;Nc, &amp;sp-&gt;Nc, NULL, 1));
<a name="line309">309: </a>  <a href="../../../../../manualpages/Sys/PetscTryTypeMethod.html">PetscTryTypeMethod</a>(sp, setfromoptions, PetscOptionsObject);
<a name="line310">310: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscOptionsEnum.html">PetscOptionsEnum</a>(<font color="#666666">"-petscdualspace_refcell"</font>, <font color="#666666">"Reference cell shape"</font>, <font color="#666666">"PetscDualSpaceSetReferenceCell"</font>, DMPolytopeTypes, (<a href="../../../../../manualpages/Sys/PetscEnum.html">PetscEnum</a>)refCell, (<a href="../../../../../manualpages/Sys/PetscEnum.html">PetscEnum</a> *)&amp;refCell, &amp;flg));
<a name="line311">311: </a>  <font color="#4169E1">if</font> (flg) {
<a name="line312">312: </a>    <a href="../../../../../manualpages/DM/DM.html">DM</a> K;

<a name="line314">314: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexCreateReferenceCell.html">DMPlexCreateReferenceCell</a>(<a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, refCell, &amp;K));
<a name="line315">315: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetDM.html">PetscDualSpaceSetDM</a>(sp, K));
<a name="line316">316: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMDestroy.html">DMDestroy</a>(&amp;K));
<a name="line317">317: </a>  }

<a name="line319">319: </a>  <font color="#B22222">/* process any options handlers added with <a href="../../../../../manualpages/Sys/PetscObjectAddOptionsHandler.html">PetscObjectAddOptionsHandler</a>() */</font>
<a name="line320">320: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscObjectProcessOptionsHandlers.html">PetscObjectProcessOptionsHandlers</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp, PetscOptionsObject));
<a name="line321">321: </a>  <a href="../../../../../manualpages/Sys/PetscOptionsEnd.html">PetscOptionsEnd</a>();
<a name="line322">322: </a>  sp-&gt;setfromoptionscalled = <a href="../../../../../manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>;
<a name="line323">323: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line324">324: </a>}

<a name="line326">326: </a><font color="#B22222">/*@</font>
<a name="line327">327: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetUp.html">PetscDualSpaceSetUp</a> - Construct a basis for a `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line329">329: </a><font color="#B22222">  Collective</font>

<a name="line331">331: </a><font color="#B22222">  Input Parameter:</font>
<a name="line332">332: </a><font color="#B22222">. sp - the `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object to setup</font>

<a name="line334">334: </a><font color="#B22222">  Level: intermediate</font>

<a name="line336">336: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceView.html">PetscDualSpaceView</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceDestroy.html">PetscDualSpaceDestroy</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line337">337: </a><font color="#B22222">@*/</font>
<a name="line338">338: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetUp"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetUp.html">PetscDualSpaceSetUp</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp)</font></strong>
<a name="line339">339: </a>{
<a name="line340">340: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line342">342: </a>  <font color="#4169E1">if</font> (sp-&gt;setupcalled) <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line343">343: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Profiling/PetscLogEventBegin.html">PetscLogEventBegin</a>(PETSCDUALSPACE_SetUp, sp, 0, 0, 0));
<a name="line344">344: </a>  sp-&gt;setupcalled = <a href="../../../../../manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>;
<a name="line345">345: </a>  <a href="../../../../../manualpages/Sys/PetscTryTypeMethod.html">PetscTryTypeMethod</a>(sp, setup);
<a name="line346">346: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Profiling/PetscLogEventEnd.html">PetscLogEventEnd</a>(PETSCDUALSPACE_SetUp, sp, 0, 0, 0));
<a name="line347">347: </a>  <font color="#4169E1">if</font> (sp-&gt;setfromoptionscalled) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceViewFromOptions.html">PetscDualSpaceViewFromOptions</a>(sp, NULL, <font color="#666666">"-petscdualspace_view"</font>));
<a name="line348">348: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line349">349: </a>}

<a name="line351">351: </a><strong><font color="#4169E1"><a name="PetscDualSpaceClearDMData_Internal"></a>static <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PetscDualSpaceClearDMData_Internal(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/DM/DM.html">DM</a> dm)</font></strong>
<a name="line352">352: </a>{
<a name="line353">353: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> pStart = -1, pEnd = -1, depth = -1;

<a name="line355">355: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line356">356: </a>  <font color="#4169E1">if</font> (!dm) <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line357">357: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetChart.html">DMPlexGetChart</a>(dm, &amp;pStart, &amp;pEnd));
<a name="line358">358: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetDepth.html">DMPlexGetDepth</a>(dm, &amp;depth));

<a name="line360">360: </a>  <font color="#4169E1">if</font> (sp-&gt;pointSpaces) {
<a name="line361">361: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> i;

<a name="line363">363: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; pEnd - pStart; i++) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceDestroy.html">PetscDualSpaceDestroy</a>(&amp;(sp-&gt;pointSpaces[i])));
<a name="line364">364: </a>  }
<a name="line365">365: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscFree.html">PetscFree</a>(sp-&gt;pointSpaces));

<a name="line367">367: </a>  <font color="#4169E1">if</font> (sp-&gt;heightSpaces) {
<a name="line368">368: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> i;

<a name="line370">370: </a>    <font color="#4169E1">for</font> (i = 0; i &lt;= depth; i++) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceDestroy.html">PetscDualSpaceDestroy</a>(&amp;(sp-&gt;heightSpaces[i])));
<a name="line371">371: </a>  }
<a name="line372">372: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscFree.html">PetscFree</a>(sp-&gt;heightSpaces));

<a name="line374">374: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionDestroy.html">PetscSectionDestroy</a>(&amp;(sp-&gt;pointSection)));
<a name="line375">375: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionDestroy.html">PetscSectionDestroy</a>(&amp;(sp-&gt;intPointSection)));
<a name="line376">376: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureDestroy.html">PetscQuadratureDestroy</a>(&amp;(sp-&gt;intNodes)));
<a name="line377">377: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Vec/VecDestroy.html">VecDestroy</a>(&amp;(sp-&gt;intDofValues)));
<a name="line378">378: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Vec/VecDestroy.html">VecDestroy</a>(&amp;(sp-&gt;intNodeValues)));
<a name="line379">379: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatDestroy.html">MatDestroy</a>(&amp;(sp-&gt;intMat)));
<a name="line380">380: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureDestroy.html">PetscQuadratureDestroy</a>(&amp;(sp-&gt;allNodes)));
<a name="line381">381: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Vec/VecDestroy.html">VecDestroy</a>(&amp;(sp-&gt;allDofValues)));
<a name="line382">382: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Vec/VecDestroy.html">VecDestroy</a>(&amp;(sp-&gt;allNodeValues)));
<a name="line383">383: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatDestroy.html">MatDestroy</a>(&amp;(sp-&gt;allMat)));
<a name="line384">384: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscFree.html">PetscFree</a>(sp-&gt;numDof));
<a name="line385">385: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line386">386: </a>}

<a name="line388">388: </a><font color="#B22222">/*@</font>
<a name="line389">389: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceDestroy.html">PetscDualSpaceDestroy</a> - Destroys a `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>

<a name="line391">391: </a><font color="#B22222">  Collective</font>

<a name="line393">393: </a><font color="#B22222">  Input Parameter:</font>
<a name="line394">394: </a><font color="#B22222">. sp - the `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object to destroy</font>

<a name="line396">396: </a><font color="#B22222">  Level: beginner</font>

<a name="line398">398: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceView.html">PetscDualSpaceView</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line399">399: </a><font color="#B22222">@*/</font>
<a name="line400">400: </a><strong><font color="#4169E1"><a name="PetscDualSpaceDestroy"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceDestroy.html">PetscDualSpaceDestroy</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> *sp)</font></strong>
<a name="line401">401: </a>{
<a name="line402">402: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dim, f;
<a name="line403">403: </a>  <a href="../../../../../manualpages/DM/DM.html">DM</a>       dm;

<a name="line405">405: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line406">406: </a>  <font color="#4169E1">if</font> (!*sp) <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);

<a name="line409">409: </a>  <font color="#4169E1">if</font> (--((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)(*sp))-&gt;refct &gt; 0) {
<a name="line410">410: </a>    *sp = NULL;
<a name="line411">411: </a>    <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line412">412: </a>  }
<a name="line413">413: </a>  ((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)(*sp))-&gt;refct = 0;

<a name="line415">415: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDimension.html">PetscDualSpaceGetDimension</a>(*sp, &amp;dim));
<a name="line416">416: </a>  dm = (*sp)-&gt;dm;

<a name="line418">418: </a>  <a href="../../../../../manualpages/Sys/PetscTryTypeMethod.html">PetscTryTypeMethod</a>((*sp), destroy);
<a name="line419">419: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(PetscDualSpaceClearDMData_Internal(*sp, dm));

<a name="line421">421: </a>  <font color="#4169E1">for</font> (f = 0; f &lt; dim; ++f) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureDestroy.html">PetscQuadratureDestroy</a>(&amp;(*sp)-&gt;functional[f]));
<a name="line422">422: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscFree.html">PetscFree</a>((*sp)-&gt;functional));
<a name="line423">423: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMDestroy.html">DMDestroy</a>(&amp;(*sp)-&gt;dm));
<a name="line424">424: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscHeaderDestroy.html">PetscHeaderDestroy</a>(sp));
<a name="line425">425: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line426">426: </a>}

<a name="line428">428: </a><font color="#B22222">/*@</font>
<a name="line429">429: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a> - Creates an empty `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object. The type can then be set with `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetType.html">PetscDualSpaceSetType</a>()`.</font>

<a name="line431">431: </a><font color="#B22222">  Collective</font>

<a name="line433">433: </a><font color="#B22222">  Input Parameter:</font>
<a name="line434">434: </a><font color="#B22222">. comm - The communicator for the `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>

<a name="line436">436: </a><font color="#B22222">  Output Parameter:</font>
<a name="line437">437: </a><font color="#B22222">. sp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>

<a name="line439">439: </a><font color="#B22222">  Level: beginner</font>

<a name="line441">441: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetType.html">PetscDualSpaceSetType</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PETSCDUALSPACELAGRANGE.html">PETSCDUALSPACELAGRANGE</a>`</font>
<a name="line442">442: </a><font color="#B22222">@*/</font>
<a name="line443">443: </a><strong><font color="#4169E1"><a name="PetscDualSpaceCreate"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>(<a href="../../../../../manualpages/Sys/MPI_Comm.html">MPI_Comm</a> comm, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> *sp)</font></strong>
<a name="line444">444: </a>{
<a name="line445">445: </a>  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> s;

<a name="line447">447: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line448">448: </a>  PetscAssertPointer(sp, 2);
<a name="line449">449: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscCitationsRegister.html">PetscCitationsRegister</a>(FECitation, &amp;FEcite));
<a name="line450">450: </a>  *sp = NULL;
<a name="line451">451: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/PetscFEInitializePackage.html">PetscFEInitializePackage</a>());

<a name="line453">453: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscHeaderCreate.html">PetscHeaderCreate</a>(s, PETSCDUALSPACE_CLASSID, <font color="#666666">"<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>"</font>, <font color="#666666">"Dual Space"</font>, <font color="#666666">"<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>"</font>, comm, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceDestroy.html">PetscDualSpaceDestroy</a>, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceView.html">PetscDualSpaceView</a>));

<a name="line455">455: </a>  s-&gt;order       = 0;
<a name="line456">456: </a>  s-&gt;Nc          = 1;
<a name="line457">457: </a>  s-&gt;k           = 0;
<a name="line458">458: </a>  s-&gt;spdim       = -1;
<a name="line459">459: </a>  s-&gt;spintdim    = -1;
<a name="line460">460: </a>  s-&gt;uniform     = <a href="../../../../../manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>;
<a name="line461">461: </a>  s-&gt;setupcalled = <a href="../../../../../manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>;

<a name="line463">463: </a>  *sp = s;
<a name="line464">464: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line465">465: </a>}

<a name="line467">467: </a><font color="#B22222">/*@</font>
<a name="line468">468: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceDuplicate.html">PetscDualSpaceDuplicate</a> - Creates a duplicate `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object that is not setup.</font>

<a name="line470">470: </a><font color="#B22222">  Collective</font>

<a name="line472">472: </a><font color="#B22222">  Input Parameter:</font>
<a name="line473">473: </a><font color="#B22222">. sp - The original `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line475">475: </a><font color="#B22222">  Output Parameter:</font>
<a name="line476">476: </a><font color="#B22222">. spNew - The duplicate `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line478">478: </a><font color="#B22222">  Level: beginner</font>

<a name="line480">480: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetType.html">PetscDualSpaceSetType</a>()`</font>
<a name="line481">481: </a><font color="#B22222">@*/</font>
<a name="line482">482: </a><strong><font color="#4169E1"><a name="PetscDualSpaceDuplicate"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceDuplicate.html">PetscDualSpaceDuplicate</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> *spNew)</font></strong>
<a name="line483">483: </a>{
<a name="line484">484: </a>  <a href="../../../../../manualpages/DM/DM.html">DM</a>                 dm;
<a name="line485">485: </a>  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceType.html">PetscDualSpaceType</a> type;
<a name="line486">486: </a>  const char        *name;

<a name="line488">488: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line490">490: </a>  PetscAssertPointer(spNew, 2);
<a name="line491">491: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp), spNew));
<a name="line492">492: </a>  name = ((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp)-&gt;name;
<a name="line493">493: </a>  <font color="#4169E1">if</font> (name) { <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscObjectSetName.html">PetscObjectSetName</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)*spNew, name)); }
<a name="line494">494: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetType.html">PetscDualSpaceGetType</a>(sp, &amp;type));
<a name="line495">495: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetType.html">PetscDualSpaceSetType</a>(*spNew, type));
<a name="line496">496: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDM.html">PetscDualSpaceGetDM</a>(sp, &amp;dm));
<a name="line497">497: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetDM.html">PetscDualSpaceSetDM</a>(*spNew, dm));

<a name="line499">499: </a>  (*spNew)-&gt;order   = sp-&gt;order;
<a name="line500">500: </a>  (*spNew)-&gt;k       = sp-&gt;k;
<a name="line501">501: </a>  (*spNew)-&gt;Nc      = sp-&gt;Nc;
<a name="line502">502: </a>  (*spNew)-&gt;uniform = sp-&gt;uniform;
<a name="line503">503: </a>  <a href="../../../../../manualpages/Sys/PetscTryTypeMethod.html">PetscTryTypeMethod</a>(sp, duplicate, *spNew);
<a name="line504">504: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line505">505: </a>}

<a name="line507">507: </a><font color="#B22222">/*@</font>
<a name="line508">508: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDM.html">PetscDualSpaceGetDM</a> - Get the `<a href="../../../../../manualpages/DM/DM.html">DM</a>` representing the reference cell of a `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line510">510: </a><font color="#B22222">  Not Collective</font>

<a name="line512">512: </a><font color="#B22222">  Input Parameter:</font>
<a name="line513">513: </a><font color="#B22222">. sp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line515">515: </a><font color="#B22222">  Output Parameter:</font>
<a name="line516">516: </a><font color="#B22222">. dm - The reference cell, that is a `<a href="../../../../../manualpages/DM/DM.html">DM</a>` that consists of a single cell</font>

<a name="line518">518: </a><font color="#B22222">  Level: intermediate</font>

<a name="line520">520: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetDM.html">PetscDualSpaceSetDM</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line521">521: </a><font color="#B22222">@*/</font>
<a name="line522">522: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetDM"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDM.html">PetscDualSpaceGetDM</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/DM/DM.html">DM</a> *dm)</font></strong>
<a name="line523">523: </a>{
<a name="line524">524: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line526">526: </a>  PetscAssertPointer(dm, 2);
<a name="line527">527: </a>  *dm = sp-&gt;dm;
<a name="line528">528: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line529">529: </a>}

<a name="line531">531: </a><font color="#B22222">/*@</font>
<a name="line532">532: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetDM.html">PetscDualSpaceSetDM</a> - Get the `<a href="../../../../../manualpages/DM/DM.html">DM</a>` representing the reference cell</font>

<a name="line534">534: </a><font color="#B22222">  Not Collective</font>

<a name="line536">536: </a><font color="#B22222">  Input Parameters:</font>
<a name="line537">537: </a><font color="#B22222">+ sp - The `PetscDual`Space</font>
<a name="line538">538: </a><font color="#B22222">- dm - The reference cell</font>

<a name="line540">540: </a><font color="#B22222">  Level: intermediate</font>

<a name="line542">542: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DM/DM.html">DM</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDM.html">PetscDualSpaceGetDM</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line543">543: </a><font color="#B22222">@*/</font>
<a name="line544">544: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetDM"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetDM.html">PetscDualSpaceSetDM</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/DM/DM.html">DM</a> dm)</font></strong>
<a name="line545">545: </a>{
<a name="line546">546: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line549">549: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(!sp-&gt;setupcalled, <a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_WRONGSTATE</a>, <font color="#666666">"Cannot change <a href="../../../../../manualpages/DM/DM.html">DM</a> after dualspace is set up"</font>);
<a name="line550">550: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscObjectReference.html">PetscObjectReference</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dm));
<a name="line551">551: </a>  <font color="#4169E1">if</font> (sp-&gt;dm &amp;&amp; sp-&gt;dm != dm) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(PetscDualSpaceClearDMData_Internal(sp, sp-&gt;dm));
<a name="line552">552: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMDestroy.html">DMDestroy</a>(&amp;sp-&gt;dm));
<a name="line553">553: </a>  sp-&gt;dm = dm;
<a name="line554">554: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line555">555: </a>}

<a name="line557">557: </a><font color="#B22222">/*@</font>
<a name="line558">558: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetOrder.html">PetscDualSpaceGetOrder</a> - Get the order of the dual space</font>

<a name="line560">560: </a><font color="#B22222">  Not Collective</font>

<a name="line562">562: </a><font color="#B22222">  Input Parameter:</font>
<a name="line563">563: </a><font color="#B22222">. sp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line565">565: </a><font color="#B22222">  Output Parameter:</font>
<a name="line566">566: </a><font color="#B22222">. order - The order</font>

<a name="line568">568: </a><font color="#B22222">  Level: intermediate</font>

<a name="line570">570: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetOrder.html">PetscDualSpaceSetOrder</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line571">571: </a><font color="#B22222">@*/</font>
<a name="line572">572: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetOrder"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetOrder.html">PetscDualSpaceGetOrder</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> *order)</font></strong>
<a name="line573">573: </a>{
<a name="line574">574: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line576">576: </a>  PetscAssertPointer(order, 2);
<a name="line577">577: </a>  *order = sp-&gt;order;
<a name="line578">578: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line579">579: </a>}

<a name="line581">581: </a><font color="#B22222">/*@</font>
<a name="line582">582: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetOrder.html">PetscDualSpaceSetOrder</a> - Set the order of the dual space</font>

<a name="line584">584: </a><font color="#B22222">  Not Collective</font>

<a name="line586">586: </a><font color="#B22222">  Input Parameters:</font>
<a name="line587">587: </a><font color="#B22222">+ sp    - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line588">588: </a><font color="#B22222">- order - The order</font>

<a name="line590">590: </a><font color="#B22222">  Level: intermediate</font>

<a name="line592">592: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetOrder.html">PetscDualSpaceGetOrder</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line593">593: </a><font color="#B22222">@*/</font>
<a name="line594">594: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetOrder"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetOrder.html">PetscDualSpaceSetOrder</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> order)</font></strong>
<a name="line595">595: </a>{
<a name="line596">596: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line598">598: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(!sp-&gt;setupcalled, <a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_WRONGSTATE</a>, <font color="#666666">"Cannot change order after dualspace is set up"</font>);
<a name="line599">599: </a>  sp-&gt;order = order;
<a name="line600">600: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line601">601: </a>}

<a name="line603">603: </a><font color="#B22222">/*@</font>
<a name="line604">604: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html">PetscDualSpaceGetNumComponents</a> - Return the number of components for this space</font>

<a name="line606">606: </a><font color="#B22222">  Input Parameter:</font>
<a name="line607">607: </a><font color="#B22222">. sp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line609">609: </a><font color="#B22222">  Output Parameter:</font>
<a name="line610">610: </a><font color="#B22222">. Nc - The number of components</font>

<a name="line612">612: </a><font color="#B22222">  Level: intermediate</font>

<a name="line614">614: </a><font color="#B22222">  Note:</font>
<a name="line615">615: </a><font color="#B22222">  A vector space, for example, will have d components, where d is the spatial dimension</font>

<a name="line617">617: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetNumComponents.html">PetscDualSpaceSetNumComponents</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDimension.html">PetscDualSpaceGetDimension</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line618">618: </a><font color="#B22222">@*/</font>
<a name="line619">619: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetNumComponents"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html">PetscDualSpaceGetNumComponents</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> *Nc)</font></strong>
<a name="line620">620: </a>{
<a name="line621">621: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line623">623: </a>  PetscAssertPointer(Nc, 2);
<a name="line624">624: </a>  *Nc = sp-&gt;Nc;
<a name="line625">625: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line626">626: </a>}

<a name="line628">628: </a><font color="#B22222">/*@</font>
<a name="line629">629: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetNumComponents.html">PetscDualSpaceSetNumComponents</a> - Set the number of components for this space</font>

<a name="line631">631: </a><font color="#B22222">  Input Parameters:</font>
<a name="line632">632: </a><font color="#B22222">+ sp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line633">633: </a><font color="#B22222">- Nc - The number of components</font>

<a name="line635">635: </a><font color="#B22222">  Level: intermediate</font>

<a name="line637">637: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html">PetscDualSpaceGetNumComponents</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line638">638: </a><font color="#B22222">@*/</font>
<a name="line639">639: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetNumComponents"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetNumComponents.html">PetscDualSpaceSetNumComponents</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nc)</font></strong>
<a name="line640">640: </a>{
<a name="line641">641: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line643">643: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(!sp-&gt;setupcalled, <a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_WRONGSTATE</a>, <font color="#666666">"Cannot change number of components after dualspace is set up"</font>);
<a name="line644">644: </a>  sp-&gt;Nc = Nc;
<a name="line645">645: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line646">646: </a>}

<a name="line648">648: </a><font color="#B22222">/*@</font>
<a name="line649">649: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a> - Get the i-th basis functional in the dual space</font>

<a name="line651">651: </a><font color="#B22222">  Not Collective</font>

<a name="line653">653: </a><font color="#B22222">  Input Parameters:</font>
<a name="line654">654: </a><font color="#B22222">+ sp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line655">655: </a><font color="#B22222">- i  - The basis number</font>

<a name="line657">657: </a><font color="#B22222">  Output Parameter:</font>
<a name="line658">658: </a><font color="#B22222">. functional - The basis functional</font>

<a name="line660">660: </a><font color="#B22222">  Level: intermediate</font>

<a name="line662">662: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDimension.html">PetscDualSpaceGetDimension</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line663">663: </a><font color="#B22222">@*/</font>
<a name="line664">664: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetFunctional"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> i, <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a> *functional)</font></strong>
<a name="line665">665: </a>{
<a name="line666">666: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dim;

<a name="line668">668: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line670">670: </a>  PetscAssertPointer(functional, 3);
<a name="line671">671: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDimension.html">PetscDualSpaceGetDimension</a>(sp, &amp;dim));
<a name="line672">672: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(!(i &lt; 0) &amp;&amp; !(i &gt;= dim), <a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Functional index %"</font> PetscInt_FMT <font color="#666666">" must be in [0, %"</font> PetscInt_FMT <font color="#666666">")"</font>, i, dim);
<a name="line673">673: </a>  *functional = sp-&gt;functional[i];
<a name="line674">674: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line675">675: </a>}

<a name="line677">677: </a><font color="#B22222">/*@</font>
<a name="line678">678: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDimension.html">PetscDualSpaceGetDimension</a> - Get the dimension of the dual space, i.e. the number of basis functionals</font>

<a name="line680">680: </a><font color="#B22222">  Not Collective</font>

<a name="line682">682: </a><font color="#B22222">  Input Parameter:</font>
<a name="line683">683: </a><font color="#B22222">. sp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line685">685: </a><font color="#B22222">  Output Parameter:</font>
<a name="line686">686: </a><font color="#B22222">. dim - The dimension</font>

<a name="line688">688: </a><font color="#B22222">  Level: intermediate</font>

<a name="line690">690: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line691">691: </a><font color="#B22222">@*/</font>
<a name="line692">692: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetDimension"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDimension.html">PetscDualSpaceGetDimension</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> *dim)</font></strong>
<a name="line693">693: </a>{
<a name="line694">694: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line696">696: </a>  PetscAssertPointer(dim, 2);
<a name="line697">697: </a>  <font color="#4169E1">if</font> (sp-&gt;spdim &lt; 0) {
<a name="line698">698: </a>    <a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a> section;

<a name="line700">700: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSection.html">PetscDualSpaceGetSection</a>(sp, &amp;section));
<a name="line701">701: </a>    <font color="#4169E1">if</font> (section) {
<a name="line702">702: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetStorageSize.html">PetscSectionGetStorageSize</a>(section, &amp;(sp-&gt;spdim)));
<a name="line703">703: </a>    } <font color="#4169E1">else</font> sp-&gt;spdim = 0;
<a name="line704">704: </a>  }
<a name="line705">705: </a>  *dim = sp-&gt;spdim;
<a name="line706">706: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line707">707: </a>}

<a name="line709">709: </a><font color="#B22222">/*@</font>
<a name="line710">710: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorDimension.html">PetscDualSpaceGetInteriorDimension</a> - Get the interior dimension of the dual space, i.e. the number of basis functionals assigned to the interior of the reference domain</font>

<a name="line712">712: </a><font color="#B22222">  Not Collective</font>

<a name="line714">714: </a><font color="#B22222">  Input Parameter:</font>
<a name="line715">715: </a><font color="#B22222">. sp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line717">717: </a><font color="#B22222">  Output Parameter:</font>
<a name="line718">718: </a><font color="#B22222">. intdim - The dimension</font>

<a name="line720">720: </a><font color="#B22222">  Level: intermediate</font>

<a name="line722">722: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line723">723: </a><font color="#B22222">@*/</font>
<a name="line724">724: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetInteriorDimension"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorDimension.html">PetscDualSpaceGetInteriorDimension</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> *intdim)</font></strong>
<a name="line725">725: </a>{
<a name="line726">726: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line728">728: </a>  PetscAssertPointer(intdim, 2);
<a name="line729">729: </a>  <font color="#4169E1">if</font> (sp-&gt;spintdim &lt; 0) {
<a name="line730">730: </a>    <a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a> section;

<a name="line732">732: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSection.html">PetscDualSpaceGetSection</a>(sp, &amp;section));
<a name="line733">733: </a>    <font color="#4169E1">if</font> (section) {
<a name="line734">734: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetConstrainedStorageSize.html">PetscSectionGetConstrainedStorageSize</a>(section, &amp;(sp-&gt;spintdim)));
<a name="line735">735: </a>    } <font color="#4169E1">else</font> sp-&gt;spintdim = 0;
<a name="line736">736: </a>  }
<a name="line737">737: </a>  *intdim = sp-&gt;spintdim;
<a name="line738">738: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line739">739: </a>}

<a name="line741">741: </a><font color="#B22222">/*@</font>
<a name="line742">742: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetUniform.html">PetscDualSpaceGetUniform</a> - Whether this dual space is uniform</font>

<a name="line744">744: </a><font color="#B22222">  Not Collective</font>

<a name="line746">746: </a><font color="#B22222">  Input Parameter:</font>
<a name="line747">747: </a><font color="#B22222">. sp - A dual space</font>

<a name="line749">749: </a><font color="#B22222">  Output Parameter:</font>
<a name="line750">750: </a><font color="#B22222">. uniform - `<a href="../../../../../manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>` if (a) the dual space is the same for each point in a stratum of the reference `<a href="../../../../../manualpages/DMPlex/DMPLEX.html">DMPLEX</a>`, and</font>
<a name="line751">751: </a><font color="#B22222">             (b) every symmetry of each point in the reference `<a href="../../../../../manualpages/DMPlex/DMPLEX.html">DMPLEX</a>` is also a symmetry of the point's dual space.</font>

<a name="line753">753: </a><font color="#B22222">  Level: advanced</font>

<a name="line755">755: </a><font color="#B22222">  Note:</font>
<a name="line756">756: </a><font color="#B22222">  All of the usual spaces on simplex or tensor-product elements will be uniform, only reference cells</font>
<a name="line757">757: </a><font color="#B22222">  with non-uniform strata (like trianguar-prisms) or anisotropic hp dual spaces will not be uniform.</font>

<a name="line759">759: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetPointSubspace.html">PetscDualSpaceGetPointSubspace</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSymmetries.html">PetscDualSpaceGetSymmetries</a>()`</font>
<a name="line760">760: </a><font color="#B22222">@*/</font>
<a name="line761">761: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetUniform"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetUniform.html">PetscDualSpaceGetUniform</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscBool.html">PetscBool</a> *uniform)</font></strong>
<a name="line762">762: </a>{
<a name="line763">763: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line765">765: </a>  PetscAssertPointer(uniform, 2);
<a name="line766">766: </a>  *uniform = sp-&gt;uniform;
<a name="line767">767: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line768">768: </a>}

<a name="line770">770: </a><font color="#B22222">/*@C</font>
<a name="line771">771: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetNumDof.html">PetscDualSpaceGetNumDof</a> - Get the number of degrees of freedom for each spatial (topological) dimension</font>

<a name="line773">773: </a><font color="#B22222">  Not Collective</font>

<a name="line775">775: </a><font color="#B22222">  Input Parameter:</font>
<a name="line776">776: </a><font color="#B22222">. sp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line778">778: </a><font color="#B22222">  Output Parameter:</font>
<a name="line779">779: </a><font color="#B22222">. numDof - An array of length dim+1 which holds the number of dofs for each dimension</font>

<a name="line781">781: </a><font color="#B22222">  Level: intermediate</font>

<a name="line783">783: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line784">784: </a><font color="#B22222">@*/</font>
<a name="line785">785: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetNumDof"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetNumDof.html">PetscDualSpaceGetNumDof</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, const <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> **numDof)</font></strong>
<a name="line786">786: </a>{
<a name="line787">787: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line789">789: </a>  PetscAssertPointer(numDof, 2);
<a name="line790">790: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(sp-&gt;uniform, <a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_WRONG</a>, <font color="#666666">"A non-uniform space does not have a fixed number of dofs for each height"</font>);
<a name="line791">791: </a>  <font color="#4169E1">if</font> (!sp-&gt;numDof) {
<a name="line792">792: </a>    <a href="../../../../../manualpages/DM/DM.html">DM</a>           dm;
<a name="line793">793: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>     depth, d;
<a name="line794">794: </a>    <a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a> section;

<a name="line796">796: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDM.html">PetscDualSpaceGetDM</a>(sp, &amp;dm));
<a name="line797">797: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetDepth.html">DMPlexGetDepth</a>(dm, &amp;depth));
<a name="line798">798: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscCalloc1.html">PetscCalloc1</a>(depth + 1, &amp;(sp-&gt;numDof)));
<a name="line799">799: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSection.html">PetscDualSpaceGetSection</a>(sp, &amp;section));
<a name="line800">800: </a>    <font color="#4169E1">for</font> (d = 0; d &lt;= depth; d++) {
<a name="line801">801: </a>      <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dStart, dEnd;

<a name="line803">803: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetDepthStratum.html">DMPlexGetDepthStratum</a>(dm, d, &amp;dStart, &amp;dEnd));
<a name="line804">804: </a>      <font color="#4169E1">if</font> (dEnd &lt;= dStart) <font color="#4169E1">continue</font>;
<a name="line805">805: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetDof.html">PetscSectionGetDof</a>(section, dStart, &amp;(sp-&gt;numDof[d])));
<a name="line806">806: </a>    }
<a name="line807">807: </a>  }
<a name="line808">808: </a>  *numDof = sp-&gt;numDof;
<a name="line809">809: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(*numDof, <a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_LIB</a>, <font color="#666666">"Empty numDof[] returned from dual space implementation"</font>);
<a name="line810">810: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line811">811: </a>}

<a name="line813">813: </a><font color="#B22222">/* create the section of the right size and set a permutation for topological ordering */</font>
<a name="line814">814: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSectionCreate_Internal"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PetscDualSpaceSectionCreate_Internal(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a> *topSection)</font></strong>
<a name="line815">815: </a>{
<a name="line816">816: </a>  <a href="../../../../../manualpages/DM/DM.html">DM</a>           dm;
<a name="line817">817: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>     pStart, pEnd, cStart, cEnd, c, depth, count, i;
<a name="line818">818: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>    *seen, *perm;
<a name="line819">819: </a>  <a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a> section;

<a name="line821">821: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line822">822: </a>  dm = sp-&gt;dm;
<a name="line823">823: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionCreate.html">PetscSectionCreate</a>(<a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, &amp;section));
<a name="line824">824: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetChart.html">DMPlexGetChart</a>(dm, &amp;pStart, &amp;pEnd));
<a name="line825">825: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionSetChart.html">PetscSectionSetChart</a>(section, pStart, pEnd));
<a name="line826">826: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscCalloc1.html">PetscCalloc1</a>(pEnd - pStart, &amp;seen));
<a name="line827">827: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>(pEnd - pStart, &amp;perm));
<a name="line828">828: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetDepth.html">DMPlexGetDepth</a>(dm, &amp;depth));
<a name="line829">829: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetHeightStratum.html">DMPlexGetHeightStratum</a>(dm, 0, &amp;cStart, &amp;cEnd));
<a name="line830">830: </a>  <font color="#4169E1">for</font> (c = cStart, count = 0; c &lt; cEnd; c++) {
<a name="line831">831: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>  closureSize = -1, e;
<a name="line832">832: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> *closure     = NULL;

<a name="line834">834: </a>    perm[count++]    = c;
<a name="line835">835: </a>    seen[c - pStart] = 1;
<a name="line836">836: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetTransitiveClosure.html">DMPlexGetTransitiveClosure</a>(dm, c, <a href="../../../../../manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>, &amp;closureSize, &amp;closure));
<a name="line837">837: </a>    <font color="#4169E1">for</font> (e = 0; e &lt; closureSize; e++) {
<a name="line838">838: </a>      <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> point = closure[2 * e];

<a name="line840">840: </a>      <font color="#4169E1">if</font> (seen[point - pStart]) <font color="#4169E1">continue</font>;
<a name="line841">841: </a>      perm[count++]        = point;
<a name="line842">842: </a>      seen[point - pStart] = 1;
<a name="line843">843: </a>    }
<a name="line844">844: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexRestoreTransitiveClosure.html">DMPlexRestoreTransitiveClosure</a>(dm, c, <a href="../../../../../manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>, &amp;closureSize, &amp;closure));
<a name="line845">845: </a>  }
<a name="line846">846: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(count == pEnd - pStart, <a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_PLIB</a>, <font color="#666666">"Bad topological ordering"</font>);
<a name="line847">847: </a>  <font color="#4169E1">for</font> (i = 0; i &lt; pEnd - pStart; i++)
<a name="line848">848: </a>    <font color="#4169E1">if</font> (perm[i] != i) <font color="#4169E1">break</font>;
<a name="line849">849: </a>  <font color="#4169E1">if</font> (i &lt; pEnd - pStart) {
<a name="line850">850: </a>    <a href="../../../../../manualpages/IS/IS.html">IS</a> permIS;

<a name="line852">852: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/IS/ISCreateGeneral.html">ISCreateGeneral</a>(<a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, pEnd - pStart, perm, <a href="../../../../../manualpages/Sys/PetscCopyMode.html">PETSC_OWN_POINTER</a>, &amp;permIS));
<a name="line853">853: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/IS/ISSetPermutation.html">ISSetPermutation</a>(permIS));
<a name="line854">854: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionSetPermutation.html">PetscSectionSetPermutation</a>(section, permIS));
<a name="line855">855: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/IS/ISDestroy.html">ISDestroy</a>(&amp;permIS));
<a name="line856">856: </a>  } <font color="#4169E1">else</font> {
<a name="line857">857: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscFree.html">PetscFree</a>(perm));
<a name="line858">858: </a>  }
<a name="line859">859: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscFree.html">PetscFree</a>(seen));
<a name="line860">860: </a>  *topSection = section;
<a name="line861">861: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line862">862: </a>}

<a name="line864">864: </a><font color="#B22222">/* mark boundary points and set up */</font>
<a name="line865">865: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSectionSetUp_Internal"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PetscDualSpaceSectionSetUp_Internal(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a> section)</font></strong>
<a name="line866">866: </a>{
<a name="line867">867: </a>  <a href="../../../../../manualpages/DM/DM.html">DM</a>       dm;
<a name="line868">868: </a>  <a href="../../../../../manualpages/DMLabel/DMLabel.html">DMLabel</a>  boundary;
<a name="line869">869: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> pStart, pEnd, p;

<a name="line871">871: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line872">872: </a>  dm = sp-&gt;dm;
<a name="line873">873: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMLabel/DMLabelCreate.html">DMLabelCreate</a>(<a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <font color="#666666">"boundary"</font>, &amp;boundary));
<a name="line874">874: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDM.html">PetscDualSpaceGetDM</a>(sp, &amp;dm));
<a name="line875">875: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexMarkBoundaryFaces.html">DMPlexMarkBoundaryFaces</a>(dm, 1, boundary));
<a name="line876">876: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexLabelComplete.html">DMPlexLabelComplete</a>(dm, boundary));
<a name="line877">877: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetChart.html">DMPlexGetChart</a>(dm, &amp;pStart, &amp;pEnd));
<a name="line878">878: </a>  <font color="#4169E1">for</font> (p = pStart; p &lt; pEnd; p++) {
<a name="line879">879: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> bval;

<a name="line881">881: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMLabel/DMLabelGetValue.html">DMLabelGetValue</a>(boundary, p, &amp;bval));
<a name="line882">882: </a>    <font color="#4169E1">if</font> (bval == 1) {
<a name="line883">883: </a>      <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dof;

<a name="line885">885: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetDof.html">PetscSectionGetDof</a>(section, p, &amp;dof));
<a name="line886">886: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionSetConstraintDof.html">PetscSectionSetConstraintDof</a>(section, p, dof));
<a name="line887">887: </a>    }
<a name="line888">888: </a>  }
<a name="line889">889: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMLabel/DMLabelDestroy.html">DMLabelDestroy</a>(&amp;boundary));
<a name="line890">890: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionSetUp.html">PetscSectionSetUp</a>(section));
<a name="line891">891: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line892">892: </a>}

<a name="line894">894: </a><font color="#B22222">/*@</font>
<a name="line895">895: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSection.html">PetscDualSpaceGetSection</a> - Create a `<a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a>` over the reference cell with the layout from this space</font>

<a name="line897">897: </a><font color="#B22222">  Collective</font>

<a name="line899">899: </a><font color="#B22222">  Input Parameter:</font>
<a name="line900">900: </a><font color="#B22222">. sp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line902">902: </a><font color="#B22222">  Output Parameter:</font>
<a name="line903">903: </a><font color="#B22222">. section - The section</font>

<a name="line905">905: </a><font color="#B22222">  Level: advanced</font>

<a name="line907">907: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`, `<a href="../../../../../manualpages/DMPlex/DMPLEX.html">DMPLEX</a>`</font>
<a name="line908">908: </a><font color="#B22222">@*/</font>
<a name="line909">909: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetSection"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSection.html">PetscDualSpaceGetSection</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a> *section)</font></strong>
<a name="line910">910: </a>{
<a name="line911">911: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> pStart, pEnd, p;

<a name="line913">913: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line914">914: </a>  <font color="#4169E1">if</font> (!sp-&gt;dm) {
<a name="line915">915: </a>    *section = NULL;
<a name="line916">916: </a>    <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line917">917: </a>  }
<a name="line918">918: </a>  <font color="#4169E1">if</font> (!sp-&gt;pointSection) {
<a name="line919">919: </a>    <font color="#B22222">/* mark the boundary */</font>
<a name="line920">920: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(PetscDualSpaceSectionCreate_Internal(sp, &amp;(sp-&gt;pointSection)));
<a name="line921">921: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetChart.html">DMPlexGetChart</a>(sp-&gt;dm, &amp;pStart, &amp;pEnd));
<a name="line922">922: </a>    <font color="#4169E1">for</font> (p = pStart; p &lt; pEnd; p++) {
<a name="line923">923: </a>      <a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> psp;

<a name="line925">925: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetPointSubspace.html">PetscDualSpaceGetPointSubspace</a>(sp, p, &amp;psp));
<a name="line926">926: </a>      <font color="#4169E1">if</font> (psp) {
<a name="line927">927: </a>        <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dof;

<a name="line929">929: </a>        <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorDimension.html">PetscDualSpaceGetInteriorDimension</a>(psp, &amp;dof));
<a name="line930">930: </a>        <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionSetDof.html">PetscSectionSetDof</a>(sp-&gt;pointSection, p, dof));
<a name="line931">931: </a>      }
<a name="line932">932: </a>    }
<a name="line933">933: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(PetscDualSpaceSectionSetUp_Internal(sp, sp-&gt;pointSection));
<a name="line934">934: </a>  }
<a name="line935">935: </a>  *section = sp-&gt;pointSection;
<a name="line936">936: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line937">937: </a>}

<a name="line939">939: </a><font color="#B22222">/*@</font>
<a name="line940">940: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorSection.html">PetscDualSpaceGetInteriorSection</a> - Create a `<a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a>` over the reference cell with the layout from this space</font>
<a name="line941">941: </a><font color="#B22222">  for interior degrees of freedom</font>

<a name="line943">943: </a><font color="#B22222">  Collective</font>

<a name="line945">945: </a><font color="#B22222">  Input Parameter:</font>
<a name="line946">946: </a><font color="#B22222">. sp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line948">948: </a><font color="#B22222">  Output Parameter:</font>
<a name="line949">949: </a><font color="#B22222">. section - The interior section</font>

<a name="line951">951: </a><font color="#B22222">  Level: advanced</font>

<a name="line953">953: </a><font color="#B22222">  Note:</font>
<a name="line954">954: </a><font color="#B22222">  Most reference domains have one cell, in which case the only cell will have</font>
<a name="line955">955: </a><font color="#B22222">  all of the interior degrees of freedom in the interior section.  But</font>
<a name="line956">956: </a><font color="#B22222">  for `<a href="../../../../../manualpages/DUALSPACE/PETSCDUALSPACEREFINED.html">PETSCDUALSPACEREFINED</a>` there may be other mesh points in the interior,</font>
<a name="line957">957: </a><font color="#B22222">  and this section describes their layout.</font>

<a name="line959">959: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`, `<a href="../../../../../manualpages/DMPlex/DMPLEX.html">DMPLEX</a>`</font>
<a name="line960">960: </a><font color="#B22222">@*/</font>
<a name="line961">961: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetInteriorSection"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorSection.html">PetscDualSpaceGetInteriorSection</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a> *section)</font></strong>
<a name="line962">962: </a>{
<a name="line963">963: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> pStart, pEnd, p;

<a name="line965">965: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line966">966: </a>  <font color="#4169E1">if</font> (!sp-&gt;dm) {
<a name="line967">967: </a>    *section = NULL;
<a name="line968">968: </a>    <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line969">969: </a>  }
<a name="line970">970: </a>  <font color="#4169E1">if</font> (!sp-&gt;intPointSection) {
<a name="line971">971: </a>    <a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a> full_section;

<a name="line973">973: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSection.html">PetscDualSpaceGetSection</a>(sp, &amp;full_section));
<a name="line974">974: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(PetscDualSpaceSectionCreate_Internal(sp, &amp;(sp-&gt;intPointSection)));
<a name="line975">975: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetChart.html">PetscSectionGetChart</a>(full_section, &amp;pStart, &amp;pEnd));
<a name="line976">976: </a>    <font color="#4169E1">for</font> (p = pStart; p &lt; pEnd; p++) {
<a name="line977">977: </a>      <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dof, cdof;

<a name="line979">979: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetDof.html">PetscSectionGetDof</a>(full_section, p, &amp;dof));
<a name="line980">980: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetConstraintDof.html">PetscSectionGetConstraintDof</a>(full_section, p, &amp;cdof));
<a name="line981">981: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionSetDof.html">PetscSectionSetDof</a>(sp-&gt;intPointSection, p, dof - cdof));
<a name="line982">982: </a>    }
<a name="line983">983: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(PetscDualSpaceSectionSetUp_Internal(sp, sp-&gt;intPointSection));
<a name="line984">984: </a>  }
<a name="line985">985: </a>  *section = sp-&gt;intPointSection;
<a name="line986">986: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line987">987: </a>}

<a name="line989">989: </a><font color="#B22222">/* this assumes that all of the point dual spaces store their interior dofs first, which is true when the point DMs</font>
<a name="line990">990: </a><font color="#B22222"> * have one cell */</font>
<a name="line991">991: </a><strong><font color="#4169E1"><a name="PetscDualSpacePushForwardSubspaces_Internal"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> PetscDualSpacePushForwardSubspaces_Internal(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> sStart, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> sEnd)</font></strong>
<a name="line992">992: </a>{
<a name="line993">993: </a>  <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a>   *sv0, *v0, *J;
<a name="line994">994: </a>  <a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a> section;
<a name="line995">995: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>     dim, s, k;
<a name="line996">996: </a>  <a href="../../../../../manualpages/DM/DM.html">DM</a>           dm;

<a name="line998">998: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line999">999: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDM.html">PetscDualSpaceGetDM</a>(sp, &amp;dm));
<a name="line1000">1000: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMGetDimension.html">DMGetDimension</a>(dm, &amp;dim));
<a name="line1001">1001: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSection.html">PetscDualSpaceGetSection</a>(sp, &amp;section));
<a name="line1002">1002: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscMalloc3.html">PetscMalloc3</a>(dim, &amp;v0, dim, &amp;sv0, dim * dim, &amp;J));
<a name="line1003">1003: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFormDegree.html">PetscDualSpaceGetFormDegree</a>(sp, &amp;k));
<a name="line1004">1004: </a>  <font color="#4169E1">for</font> (s = sStart; s &lt; sEnd; s++) {
<a name="line1005">1005: </a>    <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a>      detJ, hdetJ;
<a name="line1006">1006: </a>    <a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> ssp;
<a name="line1007">1007: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>       dof, off, f, sdim;
<a name="line1008">1008: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>       i, j;
<a name="line1009">1009: </a>    <a href="../../../../../manualpages/DM/DM.html">DM</a>             sdm;

<a name="line1011">1011: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetPointSubspace.html">PetscDualSpaceGetPointSubspace</a>(sp, s, &amp;ssp));
<a name="line1012">1012: </a>    <font color="#4169E1">if</font> (!ssp) <font color="#4169E1">continue</font>;
<a name="line1013">1013: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetDof.html">PetscSectionGetDof</a>(section, s, &amp;dof));
<a name="line1014">1014: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetOffset.html">PetscSectionGetOffset</a>(section, s, &amp;off));
<a name="line1015">1015: </a>    <font color="#B22222">/* get the first vertex of the reference cell */</font>
<a name="line1016">1016: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDM.html">PetscDualSpaceGetDM</a>(ssp, &amp;sdm));
<a name="line1017">1017: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMGetDimension.html">DMGetDimension</a>(sdm, &amp;sdim));
<a name="line1018">1018: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexComputeCellGeometryAffineFEM.html">DMPlexComputeCellGeometryAffineFEM</a>(sdm, 0, sv0, NULL, NULL, &amp;hdetJ));
<a name="line1019">1019: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexComputeCellGeometryAffineFEM.html">DMPlexComputeCellGeometryAffineFEM</a>(dm, s, v0, J, NULL, &amp;detJ));
<a name="line1020">1020: </a>    <font color="#B22222">/* compactify Jacobian */</font>
<a name="line1021">1021: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; dim; i++)
<a name="line1022">1022: </a>      <font color="#4169E1">for</font> (j = 0; j &lt; sdim; j++) J[i * sdim + j] = J[i * dim + j];
<a name="line1023">1023: </a>    <font color="#4169E1">for</font> (f = 0; f &lt; dof; f++) {
<a name="line1024">1024: </a>      <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a> fn;

<a name="line1026">1026: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a>(ssp, f, &amp;fn));
<a name="line1027">1027: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadraturePushForward.html">PetscQuadraturePushForward</a>(fn, dim, sv0, v0, J, k, &amp;(sp-&gt;functional[off + f])));
<a name="line1028">1028: </a>    }
<a name="line1029">1029: </a>  }
<a name="line1030">1030: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscFree3.html">PetscFree3</a>(v0, sv0, J));
<a name="line1031">1031: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1032">1032: </a>}

<a name="line1034">1034: </a><font color="#B22222">/*@C</font>
<a name="line1035">1035: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApply.html">PetscDualSpaceApply</a> - Apply a functional from the dual space basis to an input function</font>

<a name="line1037">1037: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1038">1038: </a><font color="#B22222">+ sp      - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>
<a name="line1039">1039: </a><font color="#B22222">. f       - The basis functional index</font>
<a name="line1040">1040: </a><font color="#B22222">. time    - The time</font>
<a name="line1041">1041: </a><font color="#B22222">. cgeom   - A context with geometric information for this cell, we use v0 (the initial vertex) and J (the Jacobian) (or evaluated at the coordinates of the functional)</font>
<a name="line1042">1042: </a><font color="#B22222">. numComp - The number of components for the function</font>
<a name="line1043">1043: </a><font color="#B22222">. func    - The input function</font>
<a name="line1044">1044: </a><font color="#B22222">- ctx     - A context for the function</font>

<a name="line1046">1046: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1047">1047: </a><font color="#B22222">. value - numComp output values</font>

<a name="line1049">1049: </a><font color="#B22222">  Calling sequence:</font>
<a name="line1050">1050: </a><font color="#B22222">.vb</font>
<a name="line1051">1051: </a><font color="#B22222">  <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> func(<a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dim, <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> time, const <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> x[], <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> numComponents, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> values[], void *ctx)</font>
<a name="line1052">1052: </a><font color="#B22222">.ve</font>

<a name="line1054">1054: </a><font color="#B22222">  Level: beginner</font>

<a name="line1056">1056: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line1057">1057: </a><font color="#B22222">@*/</font>
<a name="line1058">1058: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApply"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApply.html">PetscDualSpaceApply</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> f, <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> time, <a href="../../../../../manualpages/FE/PetscFEGeom.html">PetscFEGeom</a> *cgeom, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> numComp, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> (*func)(<a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>, <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a>, const <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a>[], <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *, void *), void *ctx, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *value)</font></strong>
<a name="line1059">1059: </a>{
<a name="line1060">1060: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1062">1062: </a>  PetscAssertPointer(cgeom, 4);
<a name="line1063">1063: </a>  PetscAssertPointer(value, 8);
<a name="line1064">1064: </a>  <a href="../../../../../manualpages/Sys/PetscUseTypeMethod.html">PetscUseTypeMethod</a>(sp, apply, f, time, cgeom, numComp, func, ctx, value);
<a name="line1065">1065: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1066">1066: </a>}

<a name="line1068">1068: </a><font color="#B22222">/*@C</font>
<a name="line1069">1069: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApplyAll.html">PetscDualSpaceApplyAll</a> - Apply all functionals from the dual space basis to the result of an evaluation at the points returned by `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetAllData.html">PetscDualSpaceGetAllData</a>()`</font>

<a name="line1071">1071: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1072">1072: </a><font color="#B22222">+ sp        - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>
<a name="line1073">1073: </a><font color="#B22222">- pointEval - Evaluation at the points returned by `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetAllData.html">PetscDualSpaceGetAllData</a>()`</font>

<a name="line1075">1075: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1076">1076: </a><font color="#B22222">. spValue - The values of all dual space functionals</font>

<a name="line1078">1078: </a><font color="#B22222">  Level: advanced</font>

<a name="line1080">1080: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line1081">1081: </a><font color="#B22222">@*/</font>
<a name="line1082">1082: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApplyAll"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApplyAll.html">PetscDualSpaceApplyAll</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, const <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *pointEval, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *spValue)</font></strong>
<a name="line1083">1083: </a>{
<a name="line1084">1084: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1086">1086: </a>  <a href="../../../../../manualpages/Sys/PetscUseTypeMethod.html">PetscUseTypeMethod</a>(sp, applyall, pointEval, spValue);
<a name="line1087">1087: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1088">1088: </a>}

<a name="line1090">1090: </a><font color="#B22222">/*@C</font>
<a name="line1091">1091: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApplyInterior.html">PetscDualSpaceApplyInterior</a> - Apply interior functionals from the dual space basis to the result of an evaluation at the points returned by `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html">PetscDualSpaceGetInteriorData</a>()`</font>

<a name="line1093">1093: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1094">1094: </a><font color="#B22222">+ sp        - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>
<a name="line1095">1095: </a><font color="#B22222">- pointEval - Evaluation at the points returned by `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html">PetscDualSpaceGetInteriorData</a>()`</font>

<a name="line1097">1097: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1098">1098: </a><font color="#B22222">. spValue - The values of interior dual space functionals</font>

<a name="line1100">1100: </a><font color="#B22222">  Level: advanced</font>

<a name="line1102">1102: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line1103">1103: </a><font color="#B22222">@*/</font>
<a name="line1104">1104: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApplyInterior"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApplyInterior.html">PetscDualSpaceApplyInterior</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, const <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *pointEval, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *spValue)</font></strong>
<a name="line1105">1105: </a>{
<a name="line1106">1106: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1108">1108: </a>  <a href="../../../../../manualpages/Sys/PetscUseTypeMethod.html">PetscUseTypeMethod</a>(sp, applyint, pointEval, spValue);
<a name="line1109">1109: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1110">1110: </a>}

<a name="line1112">1112: </a><font color="#B22222">/*@C</font>
<a name="line1113">1113: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApplyDefault.html">PetscDualSpaceApplyDefault</a> - Apply a functional from the dual space basis to an input function by assuming a point evaluation functional.</font>

<a name="line1115">1115: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1116">1116: </a><font color="#B22222">+ sp    - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>
<a name="line1117">1117: </a><font color="#B22222">. f     - The basis functional index</font>
<a name="line1118">1118: </a><font color="#B22222">. time  - The time</font>
<a name="line1119">1119: </a><font color="#B22222">. cgeom - A context with geometric information for this cell, we use v0 (the initial vertex) and J (the Jacobian)</font>
<a name="line1120">1120: </a><font color="#B22222">. Nc    - The number of components for the function</font>
<a name="line1121">1121: </a><font color="#B22222">. func  - The input function</font>
<a name="line1122">1122: </a><font color="#B22222">- ctx   - A context for the function</font>

<a name="line1124">1124: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1125">1125: </a><font color="#B22222">. value - The output value</font>

<a name="line1127">1127: </a><font color="#B22222">  Calling sequence:</font>
<a name="line1128">1128: </a><font color="#B22222">.vb</font>
<a name="line1129">1129: </a><font color="#B22222">   <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> func(<a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dim, <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> time, const <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> x[],<a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> numComponents, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> values[], void *ctx)</font>
<a name="line1130">1130: </a><font color="#B22222">.ve</font>

<a name="line1132">1132: </a><font color="#B22222">  Level: advanced</font>

<a name="line1134">1134: </a><font color="#B22222">  Note:</font>
<a name="line1135">1135: </a><font color="#B22222">  The idea is to evaluate the functional as an integral $ n(f) = \int dx n(x) . f(x) $ where both n and f have Nc components.</font>

<a name="line1137">1137: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line1138">1138: </a><font color="#B22222">@*/</font>
<a name="line1139">1139: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApplyDefault"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApplyDefault.html">PetscDualSpaceApplyDefault</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> f, <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> time, <a href="../../../../../manualpages/FE/PetscFEGeom.html">PetscFEGeom</a> *cgeom, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nc, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> (*func)(<a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>, <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a>, const <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a>[], <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *, void *), void *ctx, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *value)</font></strong>
<a name="line1140">1140: </a>{
<a name="line1141">1141: </a>  <a href="../../../../../manualpages/DM/DM.html">DM</a>               dm;
<a name="line1142">1142: </a>  <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a>  n;
<a name="line1143">1143: </a>  const <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *points, *weights;
<a name="line1144">1144: </a>  <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a>        x[3];
<a name="line1145">1145: </a>  <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a>     *val;
<a name="line1146">1146: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>         dim, dE, qNc, c, Nq, q;
<a name="line1147">1147: </a>  <a href="../../../../../manualpages/Sys/PetscBool.html">PetscBool</a>        isAffine;

<a name="line1149">1149: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1151">1151: </a>  PetscAssertPointer(value, 8);
<a name="line1152">1152: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDM.html">PetscDualSpaceGetDM</a>(sp, &amp;dm));
<a name="line1153">1153: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a>(sp, f, &amp;n));
<a name="line1154">1154: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureGetData.html">PetscQuadratureGetData</a>(n, &amp;dim, &amp;qNc, &amp;Nq, &amp;points, &amp;weights));
<a name="line1155">1155: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(dim == cgeom-&gt;dim, <a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_SIZ</a>, <font color="#666666">"The quadrature spatial dimension %"</font> PetscInt_FMT <font color="#666666">" != cell geometry dimension %"</font> PetscInt_FMT, dim, cgeom-&gt;dim);
<a name="line1156">1156: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(qNc == Nc, <a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_SIZ</a>, <font color="#666666">"The quadrature components %"</font> PetscInt_FMT <font color="#666666">" != function components %"</font> PetscInt_FMT, qNc, Nc);
<a name="line1157">1157: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMGetWorkArray.html">DMGetWorkArray</a>(dm, Nc, <a href="../../../../../manualpages/Sys/MPIU_SCALAR.html">MPIU_SCALAR</a>, &amp;val));
<a name="line1158">1158: </a>  *value   = 0.0;
<a name="line1159">1159: </a>  isAffine = cgeom-&gt;isAffine;
<a name="line1160">1160: </a>  dE       = cgeom-&gt;dimEmbed;
<a name="line1161">1161: </a>  <font color="#4169E1">for</font> (q = 0; q &lt; Nq; ++q) {
<a name="line1162">1162: </a>    <font color="#4169E1">if</font> (isAffine) {
<a name="line1163">1163: </a>      CoordinatesRefToReal(dE, cgeom-&gt;dim, cgeom-&gt;xi, cgeom-&gt;v, cgeom-&gt;J, &amp;points[q * dim], x);
<a name="line1164">1164: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>((*func)(dE, time, x, Nc, val, ctx));
<a name="line1165">1165: </a>    } <font color="#4169E1">else</font> {
<a name="line1166">1166: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>((*func)(dE, time, &amp;cgeom-&gt;v[dE * q], Nc, val, ctx));
<a name="line1167">1167: </a>    }
<a name="line1168">1168: </a>    <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) *value += val[c] * weights[q * Nc + c];
<a name="line1169">1169: </a>  }
<a name="line1170">1170: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMRestoreWorkArray.html">DMRestoreWorkArray</a>(dm, Nc, <a href="../../../../../manualpages/Sys/MPIU_SCALAR.html">MPIU_SCALAR</a>, &amp;val));
<a name="line1171">1171: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1172">1172: </a>}

<a name="line1174">1174: </a><font color="#B22222">/*@C</font>
<a name="line1175">1175: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApplyAllDefault.html">PetscDualSpaceApplyAllDefault</a> - Apply all functionals from the dual space basis to the result of an evaluation at the points returned by `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetAllData.html">PetscDualSpaceGetAllData</a>()`</font>

<a name="line1177">1177: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1178">1178: </a><font color="#B22222">+ sp        - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>
<a name="line1179">1179: </a><font color="#B22222">- pointEval - Evaluation at the points returned by `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetAllData.html">PetscDualSpaceGetAllData</a>()`</font>

<a name="line1181">1181: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1182">1182: </a><font color="#B22222">. spValue - The values of all dual space functionals</font>

<a name="line1184">1184: </a><font color="#B22222">  Level: advanced</font>

<a name="line1186">1186: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line1187">1187: </a><font color="#B22222">@*/</font>
<a name="line1188">1188: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApplyAllDefault"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApplyAllDefault.html">PetscDualSpaceApplyAllDefault</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, const <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *pointEval, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *spValue)</font></strong>
<a name="line1189">1189: </a>{
<a name="line1190">1190: </a>  <a href="../../../../../manualpages/Vec/Vec.html">Vec</a> pointValues, dofValues;
<a name="line1191">1191: </a>  <a href="../../../../../manualpages/Mat/Mat.html">Mat</a> allMat;

<a name="line1193">1193: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1195">1195: </a>  PetscAssertPointer(pointEval, 2);
<a name="line1196">1196: </a>  PetscAssertPointer(spValue, 3);
<a name="line1197">1197: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetAllData.html">PetscDualSpaceGetAllData</a>(sp, NULL, &amp;allMat));
<a name="line1198">1198: </a>  <font color="#4169E1">if</font> (!(sp-&gt;allNodeValues)) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatCreateVecs.html">MatCreateVecs</a>(allMat, &amp;(sp-&gt;allNodeValues), NULL));
<a name="line1199">1199: </a>  pointValues = sp-&gt;allNodeValues;
<a name="line1200">1200: </a>  <font color="#4169E1">if</font> (!(sp-&gt;allDofValues)) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatCreateVecs.html">MatCreateVecs</a>(allMat, NULL, &amp;(sp-&gt;allDofValues)));
<a name="line1201">1201: </a>  dofValues = sp-&gt;allDofValues;
<a name="line1202">1202: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Vec/VecPlaceArray.html">VecPlaceArray</a>(pointValues, pointEval));
<a name="line1203">1203: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Vec/VecPlaceArray.html">VecPlaceArray</a>(dofValues, spValue));
<a name="line1204">1204: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatMult.html">MatMult</a>(allMat, pointValues, dofValues));
<a name="line1205">1205: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Vec/VecResetArray.html">VecResetArray</a>(dofValues));
<a name="line1206">1206: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Vec/VecResetArray.html">VecResetArray</a>(pointValues));
<a name="line1207">1207: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1208">1208: </a>}

<a name="line1210">1210: </a><font color="#B22222">/*@C</font>
<a name="line1211">1211: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApplyInteriorDefault.html">PetscDualSpaceApplyInteriorDefault</a> - Apply interior functionals from the dual space basis to the result of an evaluation at the points returned by `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html">PetscDualSpaceGetInteriorData</a>()`</font>

<a name="line1213">1213: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1214">1214: </a><font color="#B22222">+ sp        - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>
<a name="line1215">1215: </a><font color="#B22222">- pointEval - Evaluation at the points returned by `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html">PetscDualSpaceGetInteriorData</a>()`</font>

<a name="line1217">1217: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1218">1218: </a><font color="#B22222">. spValue - The values of interior dual space functionals</font>

<a name="line1220">1220: </a><font color="#B22222">  Level: advanced</font>

<a name="line1222">1222: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line1223">1223: </a><font color="#B22222">@*/</font>
<a name="line1224">1224: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApplyInteriorDefault"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApplyInteriorDefault.html">PetscDualSpaceApplyInteriorDefault</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, const <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *pointEval, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *spValue)</font></strong>
<a name="line1225">1225: </a>{
<a name="line1226">1226: </a>  <a href="../../../../../manualpages/Vec/Vec.html">Vec</a> pointValues, dofValues;
<a name="line1227">1227: </a>  <a href="../../../../../manualpages/Mat/Mat.html">Mat</a> intMat;

<a name="line1229">1229: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1231">1231: </a>  PetscAssertPointer(pointEval, 2);
<a name="line1232">1232: </a>  PetscAssertPointer(spValue, 3);
<a name="line1233">1233: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html">PetscDualSpaceGetInteriorData</a>(sp, NULL, &amp;intMat));
<a name="line1234">1234: </a>  <font color="#4169E1">if</font> (!(sp-&gt;intNodeValues)) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatCreateVecs.html">MatCreateVecs</a>(intMat, &amp;(sp-&gt;intNodeValues), NULL));
<a name="line1235">1235: </a>  pointValues = sp-&gt;intNodeValues;
<a name="line1236">1236: </a>  <font color="#4169E1">if</font> (!(sp-&gt;intDofValues)) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatCreateVecs.html">MatCreateVecs</a>(intMat, NULL, &amp;(sp-&gt;intDofValues)));
<a name="line1237">1237: </a>  dofValues = sp-&gt;intDofValues;
<a name="line1238">1238: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Vec/VecPlaceArray.html">VecPlaceArray</a>(pointValues, pointEval));
<a name="line1239">1239: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Vec/VecPlaceArray.html">VecPlaceArray</a>(dofValues, spValue));
<a name="line1240">1240: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatMult.html">MatMult</a>(intMat, pointValues, dofValues));
<a name="line1241">1241: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Vec/VecResetArray.html">VecResetArray</a>(dofValues));
<a name="line1242">1242: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Vec/VecResetArray.html">VecResetArray</a>(pointValues));
<a name="line1243">1243: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1244">1244: </a>}

<a name="line1246">1246: </a><font color="#B22222">/*@</font>
<a name="line1247">1247: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetAllData.html">PetscDualSpaceGetAllData</a> - Get all quadrature nodes from this space, and the matrix that sends quadrature node values to degree-of-freedom values</font>

<a name="line1249">1249: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1250">1250: </a><font color="#B22222">. sp - The dualspace</font>

<a name="line1252">1252: </a><font color="#B22222">  Output Parameters:</font>
<a name="line1253">1253: </a><font color="#B22222">+ allNodes - A `<a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a>` object containing all evaluation nodes</font>
<a name="line1254">1254: </a><font color="#B22222">- allMat   - A `<a href="../../../../../manualpages/Mat/Mat.html">Mat</a>` for the node-to-dof transformation</font>

<a name="line1256">1256: </a><font color="#B22222">  Level: advanced</font>

<a name="line1258">1258: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`, `<a href="../../../../../manualpages/Mat/Mat.html">Mat</a>`</font>
<a name="line1259">1259: </a><font color="#B22222">@*/</font>
<a name="line1260">1260: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetAllData"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetAllData.html">PetscDualSpaceGetAllData</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a> *allNodes, <a href="../../../../../manualpages/Mat/Mat.html">Mat</a> *allMat)</font></strong>
<a name="line1261">1261: </a>{
<a name="line1262">1262: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1264">1264: </a>  <font color="#4169E1">if</font> (allNodes) PetscAssertPointer(allNodes, 2);
<a name="line1265">1265: </a>  <font color="#4169E1">if</font> (allMat) PetscAssertPointer(allMat, 3);
<a name="line1266">1266: </a>  <font color="#4169E1">if</font> ((!sp-&gt;allNodes || !sp-&gt;allMat) &amp;&amp; sp-&gt;ops-&gt;createalldata) {
<a name="line1267">1267: </a>    <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a> qpoints;
<a name="line1268">1268: </a>    <a href="../../../../../manualpages/Mat/Mat.html">Mat</a>             amat;

<a name="line1270">1270: </a>    <a href="../../../../../manualpages/Sys/PetscUseTypeMethod.html">PetscUseTypeMethod</a>(sp, createalldata, &amp;qpoints, &amp;amat);
<a name="line1271">1271: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureDestroy.html">PetscQuadratureDestroy</a>(&amp;(sp-&gt;allNodes)));
<a name="line1272">1272: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatDestroy.html">MatDestroy</a>(&amp;(sp-&gt;allMat)));
<a name="line1273">1273: </a>    sp-&gt;allNodes = qpoints;
<a name="line1274">1274: </a>    sp-&gt;allMat   = amat;
<a name="line1275">1275: </a>  }
<a name="line1276">1276: </a>  <font color="#4169E1">if</font> (allNodes) *allNodes = sp-&gt;allNodes;
<a name="line1277">1277: </a>  <font color="#4169E1">if</font> (allMat) *allMat = sp-&gt;allMat;
<a name="line1278">1278: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1279">1279: </a>}

<a name="line1281">1281: </a><font color="#B22222">/*@</font>
<a name="line1282">1282: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreateAllDataDefault.html">PetscDualSpaceCreateAllDataDefault</a> - Create all evaluation nodes and the node-to-dof matrix by examining functionals</font>

<a name="line1284">1284: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1285">1285: </a><font color="#B22222">. sp - The dualspace</font>

<a name="line1287">1287: </a><font color="#B22222">  Output Parameters:</font>
<a name="line1288">1288: </a><font color="#B22222">+ allNodes - A `<a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a>` object containing all evaluation nodes</font>
<a name="line1289">1289: </a><font color="#B22222">- allMat   - A `<a href="../../../../../manualpages/Mat/Mat.html">Mat</a>` for the node-to-dof transformation</font>

<a name="line1291">1291: </a><font color="#B22222">  Level: advanced</font>

<a name="line1293">1293: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`, `<a href="../../../../../manualpages/Mat/Mat.html">Mat</a>`, `<a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a>`</font>
<a name="line1294">1294: </a><font color="#B22222">@*/</font>
<a name="line1295">1295: </a><strong><font color="#4169E1"><a name="PetscDualSpaceCreateAllDataDefault"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreateAllDataDefault.html">PetscDualSpaceCreateAllDataDefault</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a> *allNodes, <a href="../../../../../manualpages/Mat/Mat.html">Mat</a> *allMat)</font></strong>
<a name="line1296">1296: </a>{
<a name="line1297">1297: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>        spdim;
<a name="line1298">1298: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>        numPoints, offset;
<a name="line1299">1299: </a>  <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a>      *points;
<a name="line1300">1300: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>        f, dim;
<a name="line1301">1301: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>        Nc, nrows, ncols;
<a name="line1302">1302: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>        maxNumPoints;
<a name="line1303">1303: </a>  <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a> q;
<a name="line1304">1304: </a>  <a href="../../../../../manualpages/Mat/Mat.html">Mat</a>             A;

<a name="line1306">1306: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1307">1307: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html">PetscDualSpaceGetNumComponents</a>(sp, &amp;Nc));
<a name="line1308">1308: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDimension.html">PetscDualSpaceGetDimension</a>(sp, &amp;spdim));
<a name="line1309">1309: </a>  <font color="#4169E1">if</font> (!spdim) {
<a name="line1310">1310: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureCreate.html">PetscQuadratureCreate</a>(<a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, allNodes));
<a name="line1311">1311: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureSetData.html">PetscQuadratureSetData</a>(*allNodes, 0, 0, 0, NULL, NULL));
<a name="line1312">1312: </a>  }
<a name="line1313">1313: </a>  nrows = spdim;
<a name="line1314">1314: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a>(sp, 0, &amp;q));
<a name="line1315">1315: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureGetData.html">PetscQuadratureGetData</a>(q, &amp;dim, NULL, &amp;numPoints, NULL, NULL));
<a name="line1316">1316: </a>  maxNumPoints = numPoints;
<a name="line1317">1317: </a>  <font color="#4169E1">for</font> (f = 1; f &lt; spdim; f++) {
<a name="line1318">1318: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Np;

<a name="line1320">1320: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a>(sp, f, &amp;q));
<a name="line1321">1321: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureGetData.html">PetscQuadratureGetData</a>(q, NULL, NULL, &amp;Np, NULL, NULL));
<a name="line1322">1322: </a>    numPoints += Np;
<a name="line1323">1323: </a>    maxNumPoints = <a href="../../../../../manualpages/Sys/PetscMax.html">PetscMax</a>(maxNumPoints, Np);
<a name="line1324">1324: </a>  }
<a name="line1325">1325: </a>  ncols = numPoints * Nc;
<a name="line1326">1326: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>(dim * numPoints, &amp;points));
<a name="line1327">1327: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatCreateSeqAIJ.html">MatCreateSeqAIJ</a>(<a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, nrows, ncols, maxNumPoints * Nc, NULL, &amp;A));
<a name="line1328">1328: </a>  <font color="#4169E1">for</font> (f = 0, offset = 0; f &lt; spdim; f++) {
<a name="line1329">1329: </a>    const <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *p, *w;
<a name="line1330">1330: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>         Np, i;
<a name="line1331">1331: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>         fnc;

<a name="line1333">1333: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a>(sp, f, &amp;q));
<a name="line1334">1334: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureGetData.html">PetscQuadratureGetData</a>(q, NULL, &amp;fnc, &amp;Np, &amp;p, &amp;w));
<a name="line1335">1335: </a>    <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(fnc == Nc, <a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_PLIB</a>, <font color="#666666">"functional component mismatch"</font>);
<a name="line1336">1336: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; Np * dim; i++) points[offset * dim + i] = p[i];
<a name="line1337">1337: </a>    <font color="#4169E1">for</font> (i = 0; i &lt; Np * Nc; i++) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatSetValue.html">MatSetValue</a>(A, f, offset * Nc, w[i], <a href="../../../../../manualpages/Sys/INSERT_VALUES.html">INSERT_VALUES</a>));
<a name="line1338">1338: </a>    offset += Np;
<a name="line1339">1339: </a>  }
<a name="line1340">1340: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatAssemblyBegin.html">MatAssemblyBegin</a>(A, <a href="../../../../../manualpages/Mat/MatAssemblyType.html">MAT_FINAL_ASSEMBLY</a>));
<a name="line1341">1341: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatAssemblyEnd.html">MatAssemblyEnd</a>(A, <a href="../../../../../manualpages/Mat/MatAssemblyType.html">MAT_FINAL_ASSEMBLY</a>));
<a name="line1342">1342: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureCreate.html">PetscQuadratureCreate</a>(<a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, allNodes));
<a name="line1343">1343: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureSetData.html">PetscQuadratureSetData</a>(*allNodes, dim, 0, numPoints, points, NULL));
<a name="line1344">1344: </a>  *allMat = A;
<a name="line1345">1345: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1346">1346: </a>}

<a name="line1348">1348: </a><font color="#B22222">/*@</font>
<a name="line1349">1349: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html">PetscDualSpaceGetInteriorData</a> - Get all quadrature points necessary to compute the interior degrees of freedom from</font>
<a name="line1350">1350: </a><font color="#B22222">  this space, as well as the matrix that computes the degrees of freedom from the quadrature</font>
<a name="line1351">1351: </a><font color="#B22222">  values.</font>

<a name="line1353">1353: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1354">1354: </a><font color="#B22222">. sp - The dualspace</font>

<a name="line1356">1356: </a><font color="#B22222">  Output Parameters:</font>
<a name="line1357">1357: </a><font color="#B22222">+ intNodes - A `<a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a>` object containing all evaluation points needed to evaluate interior degrees of freedom</font>
<a name="line1358">1358: </a><font color="#B22222">- intMat   - A matrix that computes dual space values from point values: size [spdim0 x (npoints * nc)], where spdim0 is</font>
<a name="line1359">1359: </a><font color="#B22222">             the size of the constrained layout (`PetscSectionGetConstrainStorageSize()`) of the dual space section,</font>
<a name="line1360">1360: </a><font color="#B22222">             npoints is the number of points in intNodes and nc is `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html">PetscDualSpaceGetNumComponents</a>()`.</font>

<a name="line1362">1362: </a><font color="#B22222">  Level: advanced</font>

<a name="line1364">1364: </a><font color="#B22222">  Notes:</font>
<a name="line1365">1365: </a><font color="#B22222">  Degrees of freedom are interior degrees of freedom if they belong (by</font>
<a name="line1366">1366: </a><font color="#B22222">  `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSection.html">PetscDualSpaceGetSection</a>()`) to interior points in the references, complementary boundary</font>
<a name="line1367">1367: </a><font color="#B22222">  degrees of freedom are marked as constrained in the section returned by</font>
<a name="line1368">1368: </a><font color="#B22222">  `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSection.html">PetscDualSpaceGetSection</a>()`).</font>

<a name="line1370">1370: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a>`, `<a href="../../../../../manualpages/Mat/Mat.html">Mat</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDimension.html">PetscDualSpaceGetDimension</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html">PetscDualSpaceGetNumComponents</a>()`, `<a href="../../../../../manualpages/DT/PetscQuadratureGetData.html">PetscQuadratureGetData</a>()`</font>
<a name="line1371">1371: </a><font color="#B22222">@*/</font>
<a name="line1372">1372: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetInteriorData"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html">PetscDualSpaceGetInteriorData</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a> *intNodes, <a href="../../../../../manualpages/Mat/Mat.html">Mat</a> *intMat)</font></strong>
<a name="line1373">1373: </a>{
<a name="line1374">1374: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1376">1376: </a>  <font color="#4169E1">if</font> (intNodes) PetscAssertPointer(intNodes, 2);
<a name="line1377">1377: </a>  <font color="#4169E1">if</font> (intMat) PetscAssertPointer(intMat, 3);
<a name="line1378">1378: </a>  <font color="#4169E1">if</font> ((!sp-&gt;intNodes || !sp-&gt;intMat) &amp;&amp; sp-&gt;ops-&gt;createintdata) {
<a name="line1379">1379: </a>    <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a> qpoints;
<a name="line1380">1380: </a>    <a href="../../../../../manualpages/Mat/Mat.html">Mat</a>             imat;

<a name="line1382">1382: </a>    <a href="../../../../../manualpages/Sys/PetscUseTypeMethod.html">PetscUseTypeMethod</a>(sp, createintdata, &amp;qpoints, &amp;imat);
<a name="line1383">1383: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureDestroy.html">PetscQuadratureDestroy</a>(&amp;(sp-&gt;intNodes)));
<a name="line1384">1384: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatDestroy.html">MatDestroy</a>(&amp;(sp-&gt;intMat)));
<a name="line1385">1385: </a>    sp-&gt;intNodes = qpoints;
<a name="line1386">1386: </a>    sp-&gt;intMat   = imat;
<a name="line1387">1387: </a>  }
<a name="line1388">1388: </a>  <font color="#4169E1">if</font> (intNodes) *intNodes = sp-&gt;intNodes;
<a name="line1389">1389: </a>  <font color="#4169E1">if</font> (intMat) *intMat = sp-&gt;intMat;
<a name="line1390">1390: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1391">1391: </a>}

<a name="line1393">1393: </a><font color="#B22222">/*@</font>
<a name="line1394">1394: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreateInteriorDataDefault.html">PetscDualSpaceCreateInteriorDataDefault</a> - Create quadrature points by examining interior functionals and create the matrix mapping quadrature point values to interior dual space values</font>

<a name="line1396">1396: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1397">1397: </a><font color="#B22222">. sp - The dualspace</font>

<a name="line1399">1399: </a><font color="#B22222">  Output Parameters:</font>
<a name="line1400">1400: </a><font color="#B22222">+ intNodes - A `<a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a>` object containing all evaluation points needed to evaluate interior degrees of freedom</font>
<a name="line1401">1401: </a><font color="#B22222">- intMat   - A matrix that computes dual space values from point values: size [spdim0 x (npoints * nc)], where spdim0 is</font>
<a name="line1402">1402: </a><font color="#B22222">              the size of the constrained layout (`PetscSectionGetConstrainStorageSize()`) of the dual space section,</font>
<a name="line1403">1403: </a><font color="#B22222">              npoints is the number of points in allNodes and nc is `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html">PetscDualSpaceGetNumComponents</a>()`.</font>

<a name="line1405">1405: </a><font color="#B22222">  Level: advanced</font>

<a name="line1407">1407: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a>`, `<a href="../../../../../manualpages/Mat/Mat.html">Mat</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html">PetscDualSpaceGetInteriorData</a>()`</font>
<a name="line1408">1408: </a><font color="#B22222">@*/</font>
<a name="line1409">1409: </a><strong><font color="#4169E1"><a name="PetscDualSpaceCreateInteriorDataDefault"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreateInteriorDataDefault.html">PetscDualSpaceCreateInteriorDataDefault</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a> *intNodes, <a href="../../../../../manualpages/Mat/Mat.html">Mat</a> *intMat)</font></strong>
<a name="line1410">1410: </a>{
<a name="line1411">1411: </a>  <a href="../../../../../manualpages/DM/DM.html">DM</a>              dm;
<a name="line1412">1412: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>        spdim0;
<a name="line1413">1413: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>        Nc;
<a name="line1414">1414: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>        pStart, pEnd, p, f;
<a name="line1415">1415: </a>  <a href="../../../../../manualpages/PetscSection/PetscSection.html">PetscSection</a>    section;
<a name="line1416">1416: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>        numPoints, offset, matoffset;
<a name="line1417">1417: </a>  <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a>      *points;
<a name="line1418">1418: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>        dim;
<a name="line1419">1419: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>       *nnz;
<a name="line1420">1420: </a>  <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a> q;
<a name="line1421">1421: </a>  <a href="../../../../../manualpages/Mat/Mat.html">Mat</a>             imat;

<a name="line1423">1423: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1425">1425: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSection.html">PetscDualSpaceGetSection</a>(sp, &amp;section));
<a name="line1426">1426: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetConstrainedStorageSize.html">PetscSectionGetConstrainedStorageSize</a>(section, &amp;spdim0));
<a name="line1427">1427: </a>  <font color="#4169E1">if</font> (!spdim0) {
<a name="line1428">1428: </a>    *intNodes = NULL;
<a name="line1429">1429: </a>    *intMat   = NULL;
<a name="line1430">1430: </a>    <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1431">1431: </a>  }
<a name="line1432">1432: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetNumComponents.html">PetscDualSpaceGetNumComponents</a>(sp, &amp;Nc));
<a name="line1433">1433: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetChart.html">PetscSectionGetChart</a>(section, &amp;pStart, &amp;pEnd));
<a name="line1434">1434: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDM.html">PetscDualSpaceGetDM</a>(sp, &amp;dm));
<a name="line1435">1435: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMGetDimension.html">DMGetDimension</a>(dm, &amp;dim));
<a name="line1436">1436: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>(spdim0, &amp;nnz));
<a name="line1437">1437: </a>  <font color="#4169E1">for</font> (p = pStart, f = 0, numPoints = 0; p &lt; pEnd; p++) {
<a name="line1438">1438: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dof, cdof, off, d;

<a name="line1440">1440: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetDof.html">PetscSectionGetDof</a>(section, p, &amp;dof));
<a name="line1441">1441: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetConstraintDof.html">PetscSectionGetConstraintDof</a>(section, p, &amp;cdof));
<a name="line1442">1442: </a>    <font color="#4169E1">if</font> (!(dof - cdof)) <font color="#4169E1">continue</font>;
<a name="line1443">1443: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetOffset.html">PetscSectionGetOffset</a>(section, p, &amp;off));
<a name="line1444">1444: </a>    <font color="#4169E1">for</font> (d = 0; d &lt; dof; d++, off++, f++) {
<a name="line1445">1445: </a>      <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Np;

<a name="line1447">1447: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a>(sp, off, &amp;q));
<a name="line1448">1448: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureGetData.html">PetscQuadratureGetData</a>(q, NULL, NULL, &amp;Np, NULL, NULL));
<a name="line1449">1449: </a>      nnz[f] = Np * Nc;
<a name="line1450">1450: </a>      numPoints += Np;
<a name="line1451">1451: </a>    }
<a name="line1452">1452: </a>  }
<a name="line1453">1453: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatCreateSeqAIJ.html">MatCreateSeqAIJ</a>(<a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, spdim0, numPoints * Nc, 0, nnz, &amp;imat));
<a name="line1454">1454: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscFree.html">PetscFree</a>(nnz));
<a name="line1455">1455: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscMalloc1.html">PetscMalloc1</a>(dim * numPoints, &amp;points));
<a name="line1456">1456: </a>  <font color="#4169E1">for</font> (p = pStart, f = 0, offset = 0, matoffset = 0; p &lt; pEnd; p++) {
<a name="line1457">1457: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dof, cdof, off, d;

<a name="line1459">1459: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetDof.html">PetscSectionGetDof</a>(section, p, &amp;dof));
<a name="line1460">1460: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetConstraintDof.html">PetscSectionGetConstraintDof</a>(section, p, &amp;cdof));
<a name="line1461">1461: </a>    <font color="#4169E1">if</font> (!(dof - cdof)) <font color="#4169E1">continue</font>;
<a name="line1462">1462: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/PetscSection/PetscSectionGetOffset.html">PetscSectionGetOffset</a>(section, p, &amp;off));
<a name="line1463">1463: </a>    <font color="#4169E1">for</font> (d = 0; d &lt; dof; d++, off++, f++) {
<a name="line1464">1464: </a>      const <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *p;
<a name="line1465">1465: </a>      const <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *w;
<a name="line1466">1466: </a>      <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>         Np, i;

<a name="line1468">1468: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a>(sp, off, &amp;q));
<a name="line1469">1469: </a>      <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureGetData.html">PetscQuadratureGetData</a>(q, NULL, NULL, &amp;Np, &amp;p, &amp;w));
<a name="line1470">1470: </a>      <font color="#4169E1">for</font> (i = 0; i &lt; Np * dim; i++) points[offset + i] = p[i];
<a name="line1471">1471: </a>      <font color="#4169E1">for</font> (i = 0; i &lt; Np * Nc; i++) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatSetValue.html">MatSetValue</a>(imat, f, matoffset + i, w[i], <a href="../../../../../manualpages/Sys/INSERT_VALUES.html">INSERT_VALUES</a>));
<a name="line1472">1472: </a>      offset += Np * dim;
<a name="line1473">1473: </a>      matoffset += Np * Nc;
<a name="line1474">1474: </a>    }
<a name="line1475">1475: </a>  }
<a name="line1476">1476: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureCreate.html">PetscQuadratureCreate</a>(<a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, intNodes));
<a name="line1477">1477: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureSetData.html">PetscQuadratureSetData</a>(*intNodes, dim, 0, numPoints, points, NULL));
<a name="line1478">1478: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatAssemblyBegin.html">MatAssemblyBegin</a>(imat, <a href="../../../../../manualpages/Mat/MatAssemblyType.html">MAT_FINAL_ASSEMBLY</a>));
<a name="line1479">1479: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatAssemblyEnd.html">MatAssemblyEnd</a>(imat, <a href="../../../../../manualpages/Mat/MatAssemblyType.html">MAT_FINAL_ASSEMBLY</a>));
<a name="line1480">1480: </a>  *intMat = imat;
<a name="line1481">1481: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1482">1482: </a>}

<a name="line1484">1484: </a><font color="#B22222">/*@</font>
<a name="line1485">1485: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceEqual.html">PetscDualSpaceEqual</a> - Determine if two dual spaces are equivalent</font>

<a name="line1487">1487: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1488">1488: </a><font color="#B22222">+ A - A `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>
<a name="line1489">1489: </a><font color="#B22222">- B - Another `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>

<a name="line1491">1491: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1492">1492: </a><font color="#B22222">. equal - `<a href="../../../../../manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>` if the dual spaces are equivalent</font>

<a name="line1494">1494: </a><font color="#B22222">  Level: advanced</font>

<a name="line1496">1496: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line1497">1497: </a><font color="#B22222">@*/</font>
<a name="line1498">1498: </a><strong><font color="#4169E1"><a name="PetscDualSpaceEqual"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceEqual.html">PetscDualSpaceEqual</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> A, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> B, <a href="../../../../../manualpages/Sys/PetscBool.html">PetscBool</a> *equal)</font></strong>
<a name="line1499">1499: </a>{
<a name="line1500">1500: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>        sizeA, sizeB, dimA, dimB;
<a name="line1501">1501: </a>  const <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> *dofA, *dofB;
<a name="line1502">1502: </a>  <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a> quadA, quadB;
<a name="line1503">1503: </a>  <a href="../../../../../manualpages/Mat/Mat.html">Mat</a>             matA, matB;

<a name="line1505">1505: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1508">1508: </a>  PetscAssertPointer(equal, 3);
<a name="line1509">1509: </a>  *equal = <a href="../../../../../manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>;
<a name="line1510">1510: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDimension.html">PetscDualSpaceGetDimension</a>(A, &amp;sizeA));
<a name="line1511">1511: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDimension.html">PetscDualSpaceGetDimension</a>(B, &amp;sizeB));
<a name="line1512">1512: </a>  <font color="#4169E1">if</font> (sizeB != sizeA) <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1513">1513: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMGetDimension.html">DMGetDimension</a>(A-&gt;dm, &amp;dimA));
<a name="line1514">1514: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMGetDimension.html">DMGetDimension</a>(B-&gt;dm, &amp;dimB));
<a name="line1515">1515: </a>  <font color="#4169E1">if</font> (dimA != dimB) <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);

<a name="line1517">1517: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetNumDof.html">PetscDualSpaceGetNumDof</a>(A, &amp;dofA));
<a name="line1518">1518: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetNumDof.html">PetscDualSpaceGetNumDof</a>(B, &amp;dofB));
<a name="line1519">1519: </a>  <font color="#4169E1">for</font> (<a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> d = 0; d &lt; dimA; d++) {
<a name="line1520">1520: </a>    <font color="#4169E1">if</font> (dofA[d] != dofB[d]) <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1521">1521: </a>  }

<a name="line1523">1523: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html">PetscDualSpaceGetInteriorData</a>(A, &amp;quadA, &amp;matA));
<a name="line1524">1524: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetInteriorData.html">PetscDualSpaceGetInteriorData</a>(B, &amp;quadB, &amp;matB));
<a name="line1525">1525: </a>  <font color="#4169E1">if</font> (!quadA &amp;&amp; !quadB) {
<a name="line1526">1526: </a>    *equal = <a href="../../../../../manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>;
<a name="line1527">1527: </a>  } <font color="#4169E1">else</font> <font color="#4169E1">if</font> (quadA &amp;&amp; quadB) {
<a name="line1528">1528: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureEqual.html">PetscQuadratureEqual</a>(quadA, quadB, equal));
<a name="line1529">1529: </a>    <font color="#4169E1">if</font> (*equal == <a href="../../../../../manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>) <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1530">1530: </a>    <font color="#4169E1">if</font> (!matA &amp;&amp; !matB) <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1531">1531: </a>    <font color="#4169E1">if</font> (matA &amp;&amp; matB) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Mat/MatEqual.html">MatEqual</a>(matA, matB, equal));
<a name="line1532">1532: </a>    <font color="#4169E1">else</font> *equal = <a href="../../../../../manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>;
<a name="line1533">1533: </a>  }
<a name="line1534">1534: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1535">1535: </a>}

<a name="line1537">1537: </a><font color="#B22222">/*@C</font>
<a name="line1538">1538: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApplyFVM.html">PetscDualSpaceApplyFVM</a> - Apply a functional from the dual space basis to an input function by assuming a point evaluation functional at the cell centroid.</font>

<a name="line1540">1540: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1541">1541: </a><font color="#B22222">+ sp    - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>
<a name="line1542">1542: </a><font color="#B22222">. f     - The basis functional index</font>
<a name="line1543">1543: </a><font color="#B22222">. time  - The time</font>
<a name="line1544">1544: </a><font color="#B22222">. cgeom - A context with geometric information for this cell, we currently just use the centroid</font>
<a name="line1545">1545: </a><font color="#B22222">. Nc    - The number of components for the function</font>
<a name="line1546">1546: </a><font color="#B22222">. func  - The input function</font>
<a name="line1547">1547: </a><font color="#B22222">- ctx   - A context for the function</font>

<a name="line1549">1549: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1550">1550: </a><font color="#B22222">. value - The output value (scalar)</font>

<a name="line1552">1552: </a><font color="#B22222">  Calling sequence:</font>
<a name="line1553">1553: </a><font color="#B22222">.vb</font>
<a name="line1554">1554: </a><font color="#B22222">  <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> func(<a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dim, <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> time, const <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> x[], <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> numComponents, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> values[], void *ctx)</font>
<a name="line1555">1555: </a><font color="#B22222">.ve</font>

<a name="line1557">1557: </a><font color="#B22222">  Level: advanced</font>

<a name="line1559">1559: </a><font color="#B22222">  Note:</font>
<a name="line1560">1560: </a><font color="#B22222">  The idea is to evaluate the functional as an integral $ n(f) = \int dx n(x) . f(x)$ where both n and f have Nc components.</font>

<a name="line1562">1562: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceCreate.html">PetscDualSpaceCreate</a>()`</font>
<a name="line1563">1563: </a><font color="#B22222">@*/</font>
<a name="line1564">1564: </a><strong><font color="#4169E1"><a name="PetscDualSpaceApplyFVM"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceApplyFVM.html">PetscDualSpaceApplyFVM</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> f, <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> time, <a href="../../../../../manualpages/FV/PetscFVCellGeom.html">PetscFVCellGeom</a> *cgeom, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nc, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> (*func)(<a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>, <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a>, const <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a>[], <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *, void *), void *ctx, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> *value)</font></strong>
<a name="line1565">1565: </a>{
<a name="line1566">1566: </a>  <a href="../../../../../manualpages/DM/DM.html">DM</a>               dm;
<a name="line1567">1567: </a>  <a href="../../../../../manualpages/DT/PetscQuadrature.html">PetscQuadrature</a>  n;
<a name="line1568">1568: </a>  const <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> *points, *weights;
<a name="line1569">1569: </a>  <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a>     *val;
<a name="line1570">1570: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>         dimEmbed, qNc, c, Nq, q;

<a name="line1572">1572: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1574">1574: </a>  PetscAssertPointer(value, 8);
<a name="line1575">1575: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDM.html">PetscDualSpaceGetDM</a>(sp, &amp;dm));
<a name="line1576">1576: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMGetCoordinateDim.html">DMGetCoordinateDim</a>(dm, &amp;dimEmbed));
<a name="line1577">1577: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFunctional.html">PetscDualSpaceGetFunctional</a>(sp, f, &amp;n));
<a name="line1578">1578: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscQuadratureGetData.html">PetscQuadratureGetData</a>(n, NULL, &amp;qNc, &amp;Nq, &amp;points, &amp;weights));
<a name="line1579">1579: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(qNc == Nc, <a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_SIZ</a>, <font color="#666666">"The quadrature components %"</font> PetscInt_FMT <font color="#666666">" != function components %"</font> PetscInt_FMT, qNc, Nc);
<a name="line1580">1580: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMGetWorkArray.html">DMGetWorkArray</a>(dm, Nc, <a href="../../../../../manualpages/Sys/MPIU_SCALAR.html">MPIU_SCALAR</a>, &amp;val));
<a name="line1581">1581: </a>  *value = 0.;
<a name="line1582">1582: </a>  <font color="#4169E1">for</font> (q = 0; q &lt; Nq; ++q) {
<a name="line1583">1583: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>((*func)(dimEmbed, time, cgeom-&gt;centroid, Nc, val, ctx));
<a name="line1584">1584: </a>    <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) *value += val[c] * weights[q * Nc + c];
<a name="line1585">1585: </a>  }
<a name="line1586">1586: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DM/DMRestoreWorkArray.html">DMRestoreWorkArray</a>(dm, Nc, <a href="../../../../../manualpages/Sys/MPIU_SCALAR.html">MPIU_SCALAR</a>, &amp;val));
<a name="line1587">1587: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1588">1588: </a>}

<a name="line1590">1590: </a><font color="#B22222">/*@</font>
<a name="line1591">1591: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetHeightSubspace.html">PetscDualSpaceGetHeightSubspace</a> - Get the subset of the dual space basis that is supported on a mesh point of a</font>
<a name="line1592">1592: </a><font color="#B22222">  given height.  This assumes that the reference cell is symmetric over points of this height.</font>

<a name="line1594">1594: </a><font color="#B22222">  Not Collective</font>

<a name="line1596">1596: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1597">1597: </a><font color="#B22222">+ sp     - the `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>
<a name="line1598">1598: </a><font color="#B22222">- height - the height of the mesh point for which the subspace is desired</font>

<a name="line1600">1600: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1601">1601: </a><font color="#B22222">. subsp - the subspace.  Note that the functionals in the subspace are with respect to the intrinsic geometry of the</font>
<a name="line1602">1602: </a><font color="#B22222">  point, which will be of lesser dimension if height &gt; 0.</font>

<a name="line1604">1604: </a><font color="#B22222">  Level: advanced</font>

<a name="line1606">1606: </a><font color="#B22222">  Notes:</font>
<a name="line1607">1607: </a><font color="#B22222">  If the dual space is not defined on mesh points of the given height (e.g. if the space is discontinuous and</font>
<a name="line1608">1608: </a><font color="#B22222">  pointwise values are not defined on the element boundaries), or if the implementation of `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` does not</font>
<a name="line1609">1609: </a><font color="#B22222">  support extracting subspaces, then NULL is returned.</font>

<a name="line1611">1611: </a><font color="#B22222">  This does not increment the reference count on the returned dual space, and the user should not destroy it.</font>

<a name="line1613">1613: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/SPACE/PetscSpaceGetHeightSubspace.html">PetscSpaceGetHeightSubspace</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetPointSubspace.html">PetscDualSpaceGetPointSubspace</a>()`</font>
<a name="line1614">1614: </a><font color="#B22222">@*/</font>
<a name="line1615">1615: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetHeightSubspace"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetHeightSubspace.html">PetscDualSpaceGetHeightSubspace</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> height, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> *subsp)</font></strong>
<a name="line1616">1616: </a>{
<a name="line1617">1617: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> depth = -1, cStart, cEnd;
<a name="line1618">1618: </a>  <a href="../../../../../manualpages/DM/DM.html">DM</a>       dm;

<a name="line1620">1620: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1622">1622: </a>  PetscAssertPointer(subsp, 3);
<a name="line1623">1623: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>((sp-&gt;uniform), <a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_WRONG</a>, <font color="#666666">"A non-uniform dual space does not have a single dual space at each height"</font>);
<a name="line1624">1624: </a>  *subsp = NULL;
<a name="line1625">1625: </a>  dm     = sp-&gt;dm;
<a name="line1626">1626: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetDepth.html">DMPlexGetDepth</a>(dm, &amp;depth));
<a name="line1627">1627: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(height &gt;= 0 &amp;&amp; height &lt;= depth, <a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Invalid height"</font>);
<a name="line1628">1628: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetHeightStratum.html">DMPlexGetHeightStratum</a>(dm, 0, &amp;cStart, &amp;cEnd));
<a name="line1629">1629: </a>  <font color="#4169E1">if</font> (height == 0 &amp;&amp; cEnd == cStart + 1) {
<a name="line1630">1630: </a>    *subsp = sp;
<a name="line1631">1631: </a>    <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1632">1632: </a>  }
<a name="line1633">1633: </a>  <font color="#4169E1">if</font> (!sp-&gt;heightSpaces) {
<a name="line1634">1634: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> h;
<a name="line1635">1635: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscCalloc1.html">PetscCalloc1</a>(depth + 1, &amp;(sp-&gt;heightSpaces)));

<a name="line1637">1637: </a>    <font color="#4169E1">for</font> (h = 0; h &lt;= depth; h++) {
<a name="line1638">1638: </a>      <font color="#4169E1">if</font> (h == 0 &amp;&amp; cEnd == cStart + 1) <font color="#4169E1">continue</font>;
<a name="line1639">1639: </a>      <font color="#4169E1">if</font> (sp-&gt;ops-&gt;createheightsubspace) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>((*sp-&gt;ops-&gt;createheightsubspace)(sp, height, &amp;(sp-&gt;heightSpaces[h])));
<a name="line1640">1640: </a>      <font color="#4169E1">else</font> <font color="#4169E1">if</font> (sp-&gt;pointSpaces) {
<a name="line1641">1641: </a>        <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> hStart, hEnd;

<a name="line1643">1643: </a>        <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetHeightStratum.html">DMPlexGetHeightStratum</a>(dm, h, &amp;hStart, &amp;hEnd));
<a name="line1644">1644: </a>        <font color="#4169E1">if</font> (hEnd &gt; hStart) {
<a name="line1645">1645: </a>          const char *name;

<a name="line1647">1647: </a>          <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscObjectReference.html">PetscObjectReference</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)(sp-&gt;pointSpaces[hStart])));
<a name="line1648">1648: </a>          <font color="#4169E1">if</font> (sp-&gt;pointSpaces[hStart]) {
<a name="line1649">1649: </a>            <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscObjectGetName.html">PetscObjectGetName</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp, &amp;name));
<a name="line1650">1650: </a>            <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscObjectSetName.html">PetscObjectSetName</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp-&gt;pointSpaces[hStart], name));
<a name="line1651">1651: </a>          }
<a name="line1652">1652: </a>          sp-&gt;heightSpaces[h] = sp-&gt;pointSpaces[hStart];
<a name="line1653">1653: </a>        }
<a name="line1654">1654: </a>      }
<a name="line1655">1655: </a>    }
<a name="line1656">1656: </a>  }
<a name="line1657">1657: </a>  *subsp = sp-&gt;heightSpaces[height];
<a name="line1658">1658: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1659">1659: </a>}

<a name="line1661">1661: </a><font color="#B22222">/*@</font>
<a name="line1662">1662: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetPointSubspace.html">PetscDualSpaceGetPointSubspace</a> - Get the subset of the dual space basis that is supported on a particular mesh point.</font>

<a name="line1664">1664: </a><font color="#B22222">  Not Collective</font>

<a name="line1666">1666: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1667">1667: </a><font color="#B22222">+ sp    - the `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>
<a name="line1668">1668: </a><font color="#B22222">- point - the point (in the dual space's <a href="../../../../../manualpages/DM/DM.html">DM</a>) for which the subspace is desired</font>

<a name="line1670">1670: </a><font color="#B22222">  Output Parameters:</font>
<a name="line1671">1671: </a><font color="#B22222">. bdsp - the subspace.</font>

<a name="line1673">1673: </a><font color="#B22222">  Level: advanced</font>

<a name="line1675">1675: </a><font color="#B22222">  Notes:</font>
<a name="line1676">1676: </a><font color="#B22222">  The functionals in the subspace are with respect to the intrinsic geometry of the point,</font>
<a name="line1677">1677: </a><font color="#B22222">  which will be of lesser dimension if height &gt; 0.</font>

<a name="line1679">1679: </a><font color="#B22222">  If the dual space is not defined on the mesh point (e.g. if the space is discontinuous and pointwise values are not</font>
<a name="line1680">1680: </a><font color="#B22222">  defined on the element boundaries), or if the implementation of `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` does not support extracting</font>
<a name="line1681">1681: </a><font color="#B22222">  subspaces, then `NULL` is returned.</font>

<a name="line1683">1683: </a><font color="#B22222">  This does not increment the reference count on the returned dual space, and the user should not destroy it.</font>

<a name="line1685">1685: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetHeightSubspace.html">PetscDualSpaceGetHeightSubspace</a>()`</font>
<a name="line1686">1686: </a><font color="#B22222">@*/</font>
<a name="line1687">1687: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetPointSubspace"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetPointSubspace.html">PetscDualSpaceGetPointSubspace</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> point, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> *bdsp)</font></strong>
<a name="line1688">1688: </a>{
<a name="line1689">1689: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> pStart = 0, pEnd = 0, cStart, cEnd;
<a name="line1690">1690: </a>  <a href="../../../../../manualpages/DM/DM.html">DM</a>       dm;

<a name="line1692">1692: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1694">1694: </a>  PetscAssertPointer(bdsp, 3);
<a name="line1695">1695: </a>  *bdsp = NULL;
<a name="line1696">1696: </a>  dm    = sp-&gt;dm;
<a name="line1697">1697: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetChart.html">DMPlexGetChart</a>(dm, &amp;pStart, &amp;pEnd));
<a name="line1698">1698: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(point &gt;= pStart &amp;&amp; point &lt;= pEnd, <a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Invalid point"</font>);
<a name="line1699">1699: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetHeightStratum.html">DMPlexGetHeightStratum</a>(dm, 0, &amp;cStart, &amp;cEnd));
<a name="line1700">1700: </a>  <font color="#4169E1">if</font> (point == cStart &amp;&amp; cEnd == cStart + 1) { <font color="#B22222">/* the dual space is only equivalent to the dual space on a cell if the reference mesh has just one cell */</font>
<a name="line1701">1701: </a>    *bdsp = sp;
<a name="line1702">1702: </a>    <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1703">1703: </a>  }
<a name="line1704">1704: </a>  <font color="#4169E1">if</font> (!sp-&gt;pointSpaces) {
<a name="line1705">1705: </a>    <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> p;
<a name="line1706">1706: </a>    <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscCalloc1.html">PetscCalloc1</a>(pEnd - pStart, &amp;(sp-&gt;pointSpaces)));

<a name="line1708">1708: </a>    <font color="#4169E1">for</font> (p = 0; p &lt; pEnd - pStart; p++) {
<a name="line1709">1709: </a>      <font color="#4169E1">if</font> (p + pStart == cStart &amp;&amp; cEnd == cStart + 1) <font color="#4169E1">continue</font>;
<a name="line1710">1710: </a>      <font color="#4169E1">if</font> (sp-&gt;ops-&gt;createpointsubspace) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>((*sp-&gt;ops-&gt;createpointsubspace)(sp, p + pStart, &amp;(sp-&gt;pointSpaces[p])));
<a name="line1711">1711: </a>      <font color="#4169E1">else</font> <font color="#4169E1">if</font> (sp-&gt;heightSpaces || sp-&gt;ops-&gt;createheightsubspace) {
<a name="line1712">1712: </a>        <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dim, depth, height;
<a name="line1713">1713: </a>        <a href="../../../../../manualpages/DMLabel/DMLabel.html">DMLabel</a>  label;

<a name="line1715">1715: </a>        <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetDepth.html">DMPlexGetDepth</a>(dm, &amp;dim));
<a name="line1716">1716: </a>        <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMPlex/DMPlexGetDepthLabel.html">DMPlexGetDepthLabel</a>(dm, &amp;label));
<a name="line1717">1717: </a>        <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DMLabel/DMLabelGetValue.html">DMLabelGetValue</a>(label, p + pStart, &amp;depth));
<a name="line1718">1718: </a>        height = dim - depth;
<a name="line1719">1719: </a>        <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetHeightSubspace.html">PetscDualSpaceGetHeightSubspace</a>(sp, height, &amp;(sp-&gt;pointSpaces[p])));
<a name="line1720">1720: </a>        <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/Sys/PetscObjectReference.html">PetscObjectReference</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)sp-&gt;pointSpaces[p]));
<a name="line1721">1721: </a>      }
<a name="line1722">1722: </a>    }
<a name="line1723">1723: </a>  }
<a name="line1724">1724: </a>  *bdsp = sp-&gt;pointSpaces[point - pStart];
<a name="line1725">1725: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1726">1726: </a>}

<a name="line1728">1728: </a><font color="#B22222">/*@C</font>
<a name="line1729">1729: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSymmetries.html">PetscDualSpaceGetSymmetries</a> - Returns a description of the symmetries of this basis</font>

<a name="line1731">1731: </a><font color="#B22222">  Not Collective</font>

<a name="line1733">1733: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1734">1734: </a><font color="#B22222">. sp - the `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>` object</font>

<a name="line1736">1736: </a><font color="#B22222">  Output Parameters:</font>
<a name="line1737">1737: </a><font color="#B22222">+ perms - Permutations of the interior degrees of freedom, parameterized by the point orientation</font>
<a name="line1738">1738: </a><font color="#B22222">- flips - Sign reversal of the interior degrees of freedom, parameterized by the point orientation</font>

<a name="line1740">1740: </a><font color="#B22222">  Level: developer</font>

<a name="line1742">1742: </a><font color="#B22222">  Note:</font>
<a name="line1743">1743: </a><font color="#B22222">  The permutation and flip arrays are organized in the following way</font>
<a name="line1744">1744: </a><font color="#B22222">.vb</font>
<a name="line1745">1745: </a><font color="#B22222">  perms[p][ornt][dof # on point] = new local dof #</font>
<a name="line1746">1746: </a><font color="#B22222">  flips[p][ornt][dof # on point] = reversal or not</font>
<a name="line1747">1747: </a><font color="#B22222">.ve</font>

<a name="line1749">1749: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line1750">1750: </a><font color="#B22222">@*/</font>
<a name="line1751">1751: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetSymmetries"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetSymmetries.html">PetscDualSpaceGetSymmetries</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> sp, const <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> ****perms, const <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> ****flips)</font></strong>
<a name="line1752">1752: </a>{
<a name="line1753">1753: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBegin.html">PetscFunctionBegin</a>;
<a name="line1755">1755: </a>  <font color="#4169E1">if</font> (perms) {
<a name="line1756">1756: </a>    PetscAssertPointer(perms, 2);
<a name="line1757">1757: </a>    *perms = NULL;
<a name="line1758">1758: </a>  }
<a name="line1759">1759: </a>  <font color="#4169E1">if</font> (flips) {
<a name="line1760">1760: </a>    PetscAssertPointer(flips, 3);
<a name="line1761">1761: </a>    *flips = NULL;
<a name="line1762">1762: </a>  }
<a name="line1763">1763: </a>  <font color="#4169E1">if</font> (sp-&gt;ops-&gt;getsymmetries) <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>((sp-&gt;ops-&gt;getsymmetries)(sp, perms, flips));
<a name="line1764">1764: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1765">1765: </a>}

<a name="line1767">1767: </a><font color="#B22222">/*@</font>
<a name="line1768">1768: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFormDegree.html">PetscDualSpaceGetFormDegree</a> - Get the form degree k for the k-form the describes the pushforwards/pullbacks of this</font>
<a name="line1769">1769: </a><font color="#B22222">  dual space's functionals.</font>

<a name="line1771">1771: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1772">1772: </a><font color="#B22222">. dsp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line1774">1774: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1775">1775: </a><font color="#B22222">. k - The *signed* degree k of the k.  If k &gt;= 0, this means that the degrees of freedom are k-forms, and are stored</font>
<a name="line1776">1776: </a><font color="#B22222">        in lexicographic order according to the basis of k-forms constructed from the wedge product of 1-forms.  So for example,</font>
<a name="line1777">1777: </a><font color="#B22222">        the 1-form basis in 3-D is (dx, dy, dz), and the 2-form basis in 3-D is (dx wedge dy, dx wedge dz, dy wedge dz).</font>
<a name="line1778">1778: </a><font color="#B22222">        If k &lt; 0, this means that the degrees transform as k-forms, but are stored as (N-k) forms according to the</font>
<a name="line1779">1779: </a><font color="#B22222">        Hodge star map.  So for example if k = -2 and N = 3, this means that the degrees of freedom transform as 2-forms</font>
<a name="line1780">1780: </a><font color="#B22222">        but are stored as 1-forms.</font>

<a name="line1782">1782: </a><font color="#B22222">  Level: developer</font>

<a name="line1784">1784: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DT/PetscDTAltV.html">PetscDTAltV</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePullback.html">PetscDualSpacePullback</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforward.html">PetscDualSpacePushforward</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a>`</font>
<a name="line1785">1785: </a><font color="#B22222">@*/</font>
<a name="line1786">1786: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetFormDegree"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetFormDegree.html">PetscDualSpaceGetFormDegree</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> dsp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> *k)</font></strong>
<a name="line1787">1787: </a>{
<a name="line1788">1788: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBeginHot.html">PetscFunctionBeginHot</a>;
<a name="line1790">1790: </a>  PetscAssertPointer(k, 2);
<a name="line1791">1791: </a>  *k = dsp-&gt;k;
<a name="line1792">1792: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1793">1793: </a>}

<a name="line1795">1795: </a><font color="#B22222">/*@</font>
<a name="line1796">1796: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetFormDegree.html">PetscDualSpaceSetFormDegree</a> - Set the form degree k for the k-form the describes the pushforwards/pullbacks of this</font>
<a name="line1797">1797: </a><font color="#B22222">  dual space's functionals.</font>

<a name="line1799">1799: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1800">1800: </a><font color="#B22222">+ dsp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line1801">1801: </a><font color="#B22222">- k   - The *signed* degree k of the k.  If k &gt;= 0, this means that the degrees of freedom are k-forms, and are stored</font>
<a name="line1802">1802: </a><font color="#B22222">        in lexicographic order according to the basis of k-forms constructed from the wedge product of 1-forms.  So for example,</font>
<a name="line1803">1803: </a><font color="#B22222">        the 1-form basis in 3-D is (dx, dy, dz), and the 2-form basis in 3-D is (dx wedge dy, dx wedge dz, dy wedge dz).</font>
<a name="line1804">1804: </a><font color="#B22222">        If k &lt; 0, this means that the degrees transform as k-forms, but are stored as (N-k) forms according to the</font>
<a name="line1805">1805: </a><font color="#B22222">        Hodge star map.  So for example if k = -2 and N = 3, this means that the degrees of freedom transform as 2-forms</font>
<a name="line1806">1806: </a><font color="#B22222">        but are stored as 1-forms.</font>

<a name="line1808">1808: </a><font color="#B22222">  Level: developer</font>

<a name="line1810">1810: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DT/PetscDTAltV.html">PetscDTAltV</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePullback.html">PetscDualSpacePullback</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforward.html">PetscDualSpacePushforward</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a>`</font>
<a name="line1811">1811: </a><font color="#B22222">@*/</font>
<a name="line1812">1812: </a><strong><font color="#4169E1"><a name="PetscDualSpaceSetFormDegree"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceSetFormDegree.html">PetscDualSpaceSetFormDegree</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> dsp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> k)</font></strong>
<a name="line1813">1813: </a>{
<a name="line1814">1814: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dim;

<a name="line1816">1816: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBeginHot.html">PetscFunctionBeginHot</a>;
<a name="line1818">1818: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(!dsp-&gt;setupcalled, <a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dsp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_WRONGSTATE</a>, <font color="#666666">"Cannot change number of components after dualspace is set up"</font>);
<a name="line1819">1819: </a>  dim = dsp-&gt;dm-&gt;dim;
<a name="line1820">1820: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>((k &gt;= -dim &amp;&amp; k &lt;= dim) || k == <a href="../../../../../manualpages/DT/PETSC_FORM_DEGREE_UNDEFINED.html">PETSC_FORM_DEGREE_UNDEFINED</a>, <a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_PLIB</a>, <font color="#666666">"Unsupported %"</font> PetscInt_FMT <font color="#666666">"-form on %"</font> PetscInt_FMT <font color="#666666">"-dimensional reference cell"</font>, <a href="../../../../../manualpages/Sys/PetscAbsInt.html">PetscAbsInt</a>(k), dim);
<a name="line1821">1821: </a>  dsp-&gt;k = k;
<a name="line1822">1822: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1823">1823: </a>}

<a name="line1825">1825: </a><font color="#B22222">/*@</font>
<a name="line1826">1826: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html">PetscDualSpaceGetDeRahm</a> - Get the k-simplex associated with the functionals in this dual space</font>

<a name="line1828">1828: </a><font color="#B22222">  Input Parameter:</font>
<a name="line1829">1829: </a><font color="#B22222">. dsp - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>

<a name="line1831">1831: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1832">1832: </a><font color="#B22222">. k - The simplex dimension</font>

<a name="line1834">1834: </a><font color="#B22222">  Level: developer</font>

<a name="line1836">1836: </a><font color="#B22222">  Note:</font>
<a name="line1837">1837: </a><font color="#B22222">  Currently supported values are</font>
<a name="line1838">1838: </a><font color="#B22222">.vb</font>
<a name="line1839">1839: </a><font color="#B22222">  0: These are H_1 methods that only transform coordinates</font>
<a name="line1840">1840: </a><font color="#B22222">  1: These are Hcurl methods that transform functions using the covariant Piola transform (COVARIANT_PIOLA_TRANSFORM)</font>
<a name="line1841">1841: </a><font color="#B22222">  2: These are the same as 1</font>
<a name="line1842">1842: </a><font color="#B22222">  3: These are Hdiv methods that transform functions using the contravariant Piola transform (CONTRAVARIANT_PIOLA_TRANSFORM)</font>
<a name="line1843">1843: </a><font color="#B22222">.ve</font>

<a name="line1845">1845: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePullback.html">PetscDualSpacePullback</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforward.html">PetscDualSpacePushforward</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a>`</font>
<a name="line1846">1846: </a><font color="#B22222">@*/</font>
<a name="line1847">1847: </a><strong><font color="#4169E1"><a name="PetscDualSpaceGetDeRahm"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html">PetscDualSpaceGetDeRahm</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> dsp, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> *k)</font></strong>
<a name="line1848">1848: </a>{
<a name="line1849">1849: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dim;

<a name="line1851">1851: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBeginHot.html">PetscFunctionBeginHot</a>;
<a name="line1853">1853: </a>  PetscAssertPointer(k, 2);
<a name="line1854">1854: </a>  dim = dsp-&gt;dm-&gt;dim;
<a name="line1855">1855: </a>  <font color="#4169E1">if</font> (!dsp-&gt;k) *k = IDENTITY_TRANSFORM;
<a name="line1856">1856: </a>  <font color="#4169E1">else</font> <font color="#4169E1">if</font> (dsp-&gt;k == 1) *k = COVARIANT_PIOLA_TRANSFORM;
<a name="line1857">1857: </a>  <font color="#4169E1">else</font> <font color="#4169E1">if</font> (dsp-&gt;k == -(dim - 1)) *k = CONTRAVARIANT_PIOLA_TRANSFORM;
<a name="line1858">1858: </a>  <font color="#4169E1">else</font> <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_PLIB</a>, <font color="#666666">"Unsupported transformation"</font>);
<a name="line1859">1859: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1860">1860: </a>}

<a name="line1862">1862: </a><font color="#B22222">/*@C</font>
<a name="line1863">1863: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a> - Transform the function values</font>

<a name="line1865">1865: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1866">1866: </a><font color="#B22222">+ dsp       - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line1867">1867: </a><font color="#B22222">. trans     - The type of transform</font>
<a name="line1868">1868: </a><font color="#B22222">. isInverse - Flag to invert the transform</font>
<a name="line1869">1869: </a><font color="#B22222">. fegeom    - The cell geometry</font>
<a name="line1870">1870: </a><font color="#B22222">. Nv        - The number of function samples</font>
<a name="line1871">1871: </a><font color="#B22222">. Nc        - The number of function components</font>
<a name="line1872">1872: </a><font color="#B22222">- vals      - The function values</font>

<a name="line1874">1874: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1875">1875: </a><font color="#B22222">. vals - The transformed function values</font>

<a name="line1877">1877: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1879">1879: </a><font color="#B22222">  Note:</font>
<a name="line1880">1880: </a><font color="#B22222">  This only handles transformations when the embedding dimension of the geometry in fegeom is the same as the reference dimension.</font>

<a name="line1882">1882: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformGradient.html">PetscDualSpaceTransformGradient</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformHessian.html">PetscDualSpaceTransformHessian</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePullback.html">PetscDualSpacePullback</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforward.html">PetscDualSpacePushforward</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a>`</font>
<a name="line1883">1883: </a><font color="#B22222">@*/</font>
<a name="line1884">1884: </a><strong><font color="#4169E1"><a name="PetscDualSpaceTransform"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> dsp, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a> trans, <a href="../../../../../manualpages/Sys/PetscBool.html">PetscBool</a> isInverse, <a href="../../../../../manualpages/FE/PetscFEGeom.html">PetscFEGeom</a> *fegeom, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nv, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nc, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> vals[])</font></strong>
<a name="line1885">1885: </a>{
<a name="line1886">1886: </a>  <a href="../../../../../manualpages/Sys/PetscReal.html">PetscReal</a> Jstar[9] = {0};
<a name="line1887">1887: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>  dim, v, c, Nk;

<a name="line1889">1889: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBeginHot.html">PetscFunctionBeginHot</a>;
<a name="line1891">1891: </a>  PetscAssertPointer(fegeom, 4);
<a name="line1892">1892: </a>  PetscAssertPointer(vals, 7);
<a name="line1893">1893: </a>  <font color="#B22222">/* TODO: not handling dimEmbed != dim right now */</font>
<a name="line1894">1894: </a>  dim = dsp-&gt;dm-&gt;dim;
<a name="line1895">1895: </a>  <font color="#B22222">/* No change needed for 0-forms */</font>
<a name="line1896">1896: </a>  <font color="#4169E1">if</font> (!dsp-&gt;k) <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1897">1897: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscDTBinomialInt.html">PetscDTBinomialInt</a>(dim, <a href="../../../../../manualpages/Sys/PetscAbsInt.html">PetscAbsInt</a>(dsp-&gt;k), &amp;Nk));
<a name="line1898">1898: </a>  <font color="#B22222">/* TODO: use fegeom-&gt;isAffine */</font>
<a name="line1899">1899: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DT/PetscDTAltVPullbackMatrix.html">PetscDTAltVPullbackMatrix</a>(dim, dim, isInverse ? fegeom-&gt;J : fegeom-&gt;invJ, dsp-&gt;k, Jstar));
<a name="line1900">1900: </a>  <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line1901">1901: </a>    <font color="#4169E1">switch</font> (Nk) {
<a name="line1902">1902: </a>    <font color="#4169E1">case</font> 1:
<a name="line1903">1903: </a>      <font color="#4169E1">for</font> (c = 0; c &lt; Nc; c++) vals[v * Nc + c] *= Jstar[0];
<a name="line1904">1904: </a>      <font color="#4169E1">break</font>;
<a name="line1905">1905: </a>    <font color="#4169E1">case</font> 2:
<a name="line1906">1906: </a>      <font color="#4169E1">for</font> (c = 0; c &lt; Nc; c += 2) DMPlex_Mult2DReal_Internal(Jstar, 1, &amp;vals[v * Nc + c], &amp;vals[v * Nc + c]);
<a name="line1907">1907: </a>      <font color="#4169E1">break</font>;
<a name="line1908">1908: </a>    <font color="#4169E1">case</font> 3:
<a name="line1909">1909: </a>      <font color="#4169E1">for</font> (c = 0; c &lt; Nc; c += 3) DMPlex_Mult3DReal_Internal(Jstar, 1, &amp;vals[v * Nc + c], &amp;vals[v * Nc + c]);
<a name="line1910">1910: </a>      <font color="#4169E1">break</font>;
<a name="line1911">1911: </a><strong><font color="#FF0000">    default:</font></strong>
<a name="line1912">1912: </a>      <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dsp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Unsupported form size %"</font> PetscInt_FMT <font color="#666666">" for transformation"</font>, Nk);
<a name="line1913">1913: </a>    }
<a name="line1914">1914: </a>  }
<a name="line1915">1915: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1916">1916: </a>}

<a name="line1918">1918: </a><font color="#B22222">/*@C</font>
<a name="line1919">1919: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformGradient.html">PetscDualSpaceTransformGradient</a> - Transform the function gradient values</font>

<a name="line1921">1921: </a><font color="#B22222">  Input Parameters:</font>
<a name="line1922">1922: </a><font color="#B22222">+ dsp       - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line1923">1923: </a><font color="#B22222">. trans     - The type of transform</font>
<a name="line1924">1924: </a><font color="#B22222">. isInverse - Flag to invert the transform</font>
<a name="line1925">1925: </a><font color="#B22222">. fegeom    - The cell geometry</font>
<a name="line1926">1926: </a><font color="#B22222">. Nv        - The number of function gradient samples</font>
<a name="line1927">1927: </a><font color="#B22222">. Nc        - The number of function components</font>
<a name="line1928">1928: </a><font color="#B22222">- vals      - The function gradient values</font>

<a name="line1930">1930: </a><font color="#B22222">  Output Parameter:</font>
<a name="line1931">1931: </a><font color="#B22222">. vals - The transformed function gradient values</font>

<a name="line1933">1933: </a><font color="#B22222">  Level: intermediate</font>

<a name="line1935">1935: </a><font color="#B22222">  Note:</font>
<a name="line1936">1936: </a><font color="#B22222">  This only handles transformations when the embedding dimension of the geometry in fegeom is the same as the reference dimension.</font>

<a name="line1938">1938: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePullback.html">PetscDualSpacePullback</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforward.html">PetscDualSpacePushforward</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a>`</font>
<a name="line1939">1939: </a><font color="#B22222">@*/</font>
<a name="line1940">1940: </a><strong><font color="#4169E1"><a name="PetscDualSpaceTransformGradient"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformGradient.html">PetscDualSpaceTransformGradient</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> dsp, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a> trans, <a href="../../../../../manualpages/Sys/PetscBool.html">PetscBool</a> isInverse, <a href="../../../../../manualpages/FE/PetscFEGeom.html">PetscFEGeom</a> *fegeom, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nv, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nc, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> vals[])</font></strong>
<a name="line1941">1941: </a>{
<a name="line1942">1942: </a>  const <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dim = dsp-&gt;dm-&gt;dim, dE = fegeom-&gt;dimEmbed;
<a name="line1943">1943: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>       v, c, d;

<a name="line1945">1945: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBeginHot.html">PetscFunctionBeginHot</a>;
<a name="line1947">1947: </a>  PetscAssertPointer(fegeom, 4);
<a name="line1948">1948: </a>  PetscAssertPointer(vals, 7);
<a name="line1949">1949: </a><font color="#A020F0">#ifdef PETSC_USE_DEBUG</font>
<a name="line1950">1950: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(dE &gt; 0, <a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Invalid embedding dimension %"</font> PetscInt_FMT, dE);
<a name="line1951">1951: </a><font color="#A020F0">#endif</font>
<a name="line1952">1952: </a>  <font color="#B22222">/* Transform gradient */</font>
<a name="line1953">1953: </a>  <font color="#4169E1">if</font> (dim == dE) {
<a name="line1954">1954: </a>    <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line1955">1955: </a>      <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) {
<a name="line1956">1956: </a>        <font color="#4169E1">switch</font> (dim) {
<a name="line1957">1957: </a>        <font color="#4169E1">case</font> 1:
<a name="line1958">1958: </a>          vals[(v * Nc + c) * dim] *= fegeom-&gt;invJ[0];
<a name="line1959">1959: </a>          <font color="#4169E1">break</font>;
<a name="line1960">1960: </a>        <font color="#4169E1">case</font> 2:
<a name="line1961">1961: </a>          DMPlex_MultTranspose2DReal_Internal(fegeom-&gt;invJ, 1, &amp;vals[(v * Nc + c) * dim], &amp;vals[(v * Nc + c) * dim]);
<a name="line1962">1962: </a>          <font color="#4169E1">break</font>;
<a name="line1963">1963: </a>        <font color="#4169E1">case</font> 3:
<a name="line1964">1964: </a>          DMPlex_MultTranspose3DReal_Internal(fegeom-&gt;invJ, 1, &amp;vals[(v * Nc + c) * dim], &amp;vals[(v * Nc + c) * dim]);
<a name="line1965">1965: </a>          <font color="#4169E1">break</font>;
<a name="line1966">1966: </a><strong><font color="#FF0000">        default:</font></strong>
<a name="line1967">1967: </a>          <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dsp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Unsupported dim %"</font> PetscInt_FMT <font color="#666666">" for transformation"</font>, dim);
<a name="line1968">1968: </a>        }
<a name="line1969">1969: </a>      }
<a name="line1970">1970: </a>    }
<a name="line1971">1971: </a>  } <font color="#4169E1">else</font> {
<a name="line1972">1972: </a>    <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line1973">1973: </a>      <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) DMPlex_MultTransposeReal_Internal(fegeom-&gt;invJ, dim, dE, 1, &amp;vals[(v * Nc + c) * dE], &amp;vals[(v * Nc + c) * dE]);
<a name="line1974">1974: </a>    }
<a name="line1975">1975: </a>  }
<a name="line1976">1976: </a>  <font color="#B22222">/* Assume its a vector, otherwise assume its a bunch of scalars */</font>
<a name="line1977">1977: </a>  <font color="#4169E1">if</font> (Nc == 1 || Nc != dim) <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line1978">1978: </a>  <font color="#4169E1">switch</font> (trans) {
<a name="line1979">1979: </a>  <font color="#4169E1">case</font> IDENTITY_TRANSFORM:
<a name="line1980">1980: </a>    <font color="#4169E1">break</font>;
<a name="line1981">1981: </a>  <font color="#4169E1">case</font> COVARIANT_PIOLA_TRANSFORM: <font color="#B22222">/* Covariant Piola mapping $\sigma^*(F) = J^{-T} F \circ \phi^{-1)$ */</font>
<a name="line1982">1982: </a>    <font color="#4169E1">if</font> (isInverse) {
<a name="line1983">1983: </a>      <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line1984">1984: </a>        <font color="#4169E1">for</font> (d = 0; d &lt; dim; ++d) {
<a name="line1985">1985: </a>          <font color="#4169E1">switch</font> (dim) {
<a name="line1986">1986: </a>          <font color="#4169E1">case</font> 2:
<a name="line1987">1987: </a>            DMPlex_MultTranspose2DReal_Internal(fegeom-&gt;J, dim, &amp;vals[v * Nc * dim + d], &amp;vals[v * Nc * dim + d]);
<a name="line1988">1988: </a>            <font color="#4169E1">break</font>;
<a name="line1989">1989: </a>          <font color="#4169E1">case</font> 3:
<a name="line1990">1990: </a>            DMPlex_MultTranspose3DReal_Internal(fegeom-&gt;J, dim, &amp;vals[v * Nc * dim + d], &amp;vals[v * Nc * dim + d]);
<a name="line1991">1991: </a>            <font color="#4169E1">break</font>;
<a name="line1992">1992: </a><strong><font color="#FF0000">          default:</font></strong>
<a name="line1993">1993: </a>            <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dsp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Unsupported dim %"</font> PetscInt_FMT <font color="#666666">" for transformation"</font>, dim);
<a name="line1994">1994: </a>          }
<a name="line1995">1995: </a>        }
<a name="line1996">1996: </a>      }
<a name="line1997">1997: </a>    } <font color="#4169E1">else</font> {
<a name="line1998">1998: </a>      <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line1999">1999: </a>        <font color="#4169E1">for</font> (d = 0; d &lt; dim; ++d) {
<a name="line2000">2000: </a>          <font color="#4169E1">switch</font> (dim) {
<a name="line2001">2001: </a>          <font color="#4169E1">case</font> 2:
<a name="line2002">2002: </a>            DMPlex_MultTranspose2DReal_Internal(fegeom-&gt;invJ, dim, &amp;vals[v * Nc * dim + d], &amp;vals[v * Nc * dim + d]);
<a name="line2003">2003: </a>            <font color="#4169E1">break</font>;
<a name="line2004">2004: </a>          <font color="#4169E1">case</font> 3:
<a name="line2005">2005: </a>            DMPlex_MultTranspose3DReal_Internal(fegeom-&gt;invJ, dim, &amp;vals[v * Nc * dim + d], &amp;vals[v * Nc * dim + d]);
<a name="line2006">2006: </a>            <font color="#4169E1">break</font>;
<a name="line2007">2007: </a><strong><font color="#FF0000">          default:</font></strong>
<a name="line2008">2008: </a>            <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dsp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Unsupported dim %"</font> PetscInt_FMT <font color="#666666">" for transformation"</font>, dim);
<a name="line2009">2009: </a>          }
<a name="line2010">2010: </a>        }
<a name="line2011">2011: </a>      }
<a name="line2012">2012: </a>    }
<a name="line2013">2013: </a>    <font color="#4169E1">break</font>;
<a name="line2014">2014: </a>  <font color="#4169E1">case</font> CONTRAVARIANT_PIOLA_TRANSFORM: <font color="#B22222">/* Contravariant Piola mapping $\sigma^*(F) = \frac{1}{|\det J|} J F \circ \phi^{-1}$ */</font>
<a name="line2015">2015: </a>    <font color="#4169E1">if</font> (isInverse) {
<a name="line2016">2016: </a>      <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line2017">2017: </a>        <font color="#4169E1">for</font> (d = 0; d &lt; dim; ++d) {
<a name="line2018">2018: </a>          <font color="#4169E1">switch</font> (dim) {
<a name="line2019">2019: </a>          <font color="#4169E1">case</font> 2:
<a name="line2020">2020: </a>            DMPlex_Mult2DReal_Internal(fegeom-&gt;invJ, dim, &amp;vals[v * Nc * dim + d], &amp;vals[v * Nc * dim + d]);
<a name="line2021">2021: </a>            <font color="#4169E1">break</font>;
<a name="line2022">2022: </a>          <font color="#4169E1">case</font> 3:
<a name="line2023">2023: </a>            DMPlex_Mult3DReal_Internal(fegeom-&gt;invJ, dim, &amp;vals[v * Nc * dim + d], &amp;vals[v * Nc * dim + d]);
<a name="line2024">2024: </a>            <font color="#4169E1">break</font>;
<a name="line2025">2025: </a><strong><font color="#FF0000">          default:</font></strong>
<a name="line2026">2026: </a>            <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dsp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Unsupported dim %"</font> PetscInt_FMT <font color="#666666">" for transformation"</font>, dim);
<a name="line2027">2027: </a>          }
<a name="line2028">2028: </a>          <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) vals[(v * Nc + c) * dim + d] *= fegeom-&gt;detJ[0];
<a name="line2029">2029: </a>        }
<a name="line2030">2030: </a>      }
<a name="line2031">2031: </a>    } <font color="#4169E1">else</font> {
<a name="line2032">2032: </a>      <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line2033">2033: </a>        <font color="#4169E1">for</font> (d = 0; d &lt; dim; ++d) {
<a name="line2034">2034: </a>          <font color="#4169E1">switch</font> (dim) {
<a name="line2035">2035: </a>          <font color="#4169E1">case</font> 2:
<a name="line2036">2036: </a>            DMPlex_Mult2DReal_Internal(fegeom-&gt;J, dim, &amp;vals[v * Nc * dim + d], &amp;vals[v * Nc * dim + d]);
<a name="line2037">2037: </a>            <font color="#4169E1">break</font>;
<a name="line2038">2038: </a>          <font color="#4169E1">case</font> 3:
<a name="line2039">2039: </a>            DMPlex_Mult3DReal_Internal(fegeom-&gt;J, dim, &amp;vals[v * Nc * dim + d], &amp;vals[v * Nc * dim + d]);
<a name="line2040">2040: </a>            <font color="#4169E1">break</font>;
<a name="line2041">2041: </a><strong><font color="#FF0000">          default:</font></strong>
<a name="line2042">2042: </a>            <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dsp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Unsupported dim %"</font> PetscInt_FMT <font color="#666666">" for transformation"</font>, dim);
<a name="line2043">2043: </a>          }
<a name="line2044">2044: </a>          <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) vals[(v * Nc + c) * dim + d] /= fegeom-&gt;detJ[0];
<a name="line2045">2045: </a>        }
<a name="line2046">2046: </a>      }
<a name="line2047">2047: </a>    }
<a name="line2048">2048: </a>    <font color="#4169E1">break</font>;
<a name="line2049">2049: </a>  }
<a name="line2050">2050: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line2051">2051: </a>}

<a name="line2053">2053: </a><font color="#B22222">/*@C</font>
<a name="line2054">2054: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformHessian.html">PetscDualSpaceTransformHessian</a> - Transform the function Hessian values</font>

<a name="line2056">2056: </a><font color="#B22222">  Input Parameters:</font>
<a name="line2057">2057: </a><font color="#B22222">+ dsp       - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line2058">2058: </a><font color="#B22222">. trans     - The type of transform</font>
<a name="line2059">2059: </a><font color="#B22222">. isInverse - Flag to invert the transform</font>
<a name="line2060">2060: </a><font color="#B22222">. fegeom    - The cell geometry</font>
<a name="line2061">2061: </a><font color="#B22222">. Nv        - The number of function Hessian samples</font>
<a name="line2062">2062: </a><font color="#B22222">. Nc        - The number of function components</font>
<a name="line2063">2063: </a><font color="#B22222">- vals      - The function gradient values</font>

<a name="line2065">2065: </a><font color="#B22222">  Output Parameter:</font>
<a name="line2066">2066: </a><font color="#B22222">. vals - The transformed function Hessian values</font>

<a name="line2068">2068: </a><font color="#B22222">  Level: intermediate</font>

<a name="line2070">2070: </a><font color="#B22222">  Note:</font>
<a name="line2071">2071: </a><font color="#B22222">  This only handles transformations when the embedding dimension of the geometry in fegeom is the same as the reference dimension.</font>

<a name="line2073">2073: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePullback.html">PetscDualSpacePullback</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforward.html">PetscDualSpacePushforward</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a>`</font>
<a name="line2074">2074: </a><font color="#B22222">@*/</font>
<a name="line2075">2075: </a><strong><font color="#4169E1"><a name="PetscDualSpaceTransformHessian"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformHessian.html">PetscDualSpaceTransformHessian</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> dsp, <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a> trans, <a href="../../../../../manualpages/Sys/PetscBool.html">PetscBool</a> isInverse, <a href="../../../../../manualpages/FE/PetscFEGeom.html">PetscFEGeom</a> *fegeom, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nv, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nc, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> vals[])</font></strong>
<a name="line2076">2076: </a>{
<a name="line2077">2077: </a>  const <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> dim = dsp-&gt;dm-&gt;dim, dE = fegeom-&gt;dimEmbed;
<a name="line2078">2078: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>       v, c;

<a name="line2080">2080: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBeginHot.html">PetscFunctionBeginHot</a>;
<a name="line2082">2082: </a>  PetscAssertPointer(fegeom, 4);
<a name="line2083">2083: </a>  PetscAssertPointer(vals, 7);
<a name="line2084">2084: </a><font color="#A020F0">#ifdef PETSC_USE_DEBUG</font>
<a name="line2085">2085: </a>  <a href="../../../../../manualpages/Sys/PetscCheck.html">PetscCheck</a>(dE &gt; 0, <a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Invalid embedding dimension %"</font> PetscInt_FMT, dE);
<a name="line2086">2086: </a><font color="#A020F0">#endif</font>
<a name="line2087">2087: </a>  <font color="#B22222">/* Transform Hessian: J^{-T}_{ik} J^{-T}_{jl} H(f)_{kl} = J^{-T}_{ik} H(f)_{kl} J^{-1}_{lj} */</font>
<a name="line2088">2088: </a>  <font color="#4169E1">if</font> (dim == dE) {
<a name="line2089">2089: </a>    <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line2090">2090: </a>      <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) {
<a name="line2091">2091: </a>        <font color="#4169E1">switch</font> (dim) {
<a name="line2092">2092: </a>        <font color="#4169E1">case</font> 1:
<a name="line2093">2093: </a>          vals[(v * Nc + c) * dim * dim] *= <a href="../../../../../manualpages/Sys/PetscSqr.html">PetscSqr</a>(fegeom-&gt;invJ[0]);
<a name="line2094">2094: </a>          <font color="#4169E1">break</font>;
<a name="line2095">2095: </a>        <font color="#4169E1">case</font> 2:
<a name="line2096">2096: </a>          DMPlex_PTAP2DReal_Internal(fegeom-&gt;invJ, &amp;vals[(v * Nc + c) * dim * dim], &amp;vals[(v * Nc + c) * dim * dim]);
<a name="line2097">2097: </a>          <font color="#4169E1">break</font>;
<a name="line2098">2098: </a>        <font color="#4169E1">case</font> 3:
<a name="line2099">2099: </a>          DMPlex_PTAP3DReal_Internal(fegeom-&gt;invJ, &amp;vals[(v * Nc + c) * dim * dim], &amp;vals[(v * Nc + c) * dim * dim]);
<a name="line2100">2100: </a>          <font color="#4169E1">break</font>;
<a name="line2101">2101: </a><strong><font color="#FF0000">        default:</font></strong>
<a name="line2102">2102: </a>          <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dsp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Unsupported dim %"</font> PetscInt_FMT <font color="#666666">" for transformation"</font>, dim);
<a name="line2103">2103: </a>        }
<a name="line2104">2104: </a>      }
<a name="line2105">2105: </a>    }
<a name="line2106">2106: </a>  } <font color="#4169E1">else</font> {
<a name="line2107">2107: </a>    <font color="#4169E1">for</font> (v = 0; v &lt; Nv; ++v) {
<a name="line2108">2108: </a>      <font color="#4169E1">for</font> (c = 0; c &lt; Nc; ++c) DMPlex_PTAPReal_Internal(fegeom-&gt;invJ, dim, dE, &amp;vals[(v * Nc + c) * dE * dE], &amp;vals[(v * Nc + c) * dE * dE]);
<a name="line2109">2109: </a>    }
<a name="line2110">2110: </a>  }
<a name="line2111">2111: </a>  <font color="#B22222">/* Assume its a vector, otherwise assume its a bunch of scalars */</font>
<a name="line2112">2112: </a>  <font color="#4169E1">if</font> (Nc == 1 || Nc != dim) <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line2113">2113: </a>  <font color="#4169E1">switch</font> (trans) {
<a name="line2114">2114: </a>  <font color="#4169E1">case</font> IDENTITY_TRANSFORM:
<a name="line2115">2115: </a>    <font color="#4169E1">break</font>;
<a name="line2116">2116: </a>  <font color="#4169E1">case</font> COVARIANT_PIOLA_TRANSFORM: <font color="#B22222">/* Covariant Piola mapping $\sigma^*(F) = J^{-T} F \circ \phi^{-1)$ */</font>
<a name="line2117">2117: </a>    <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_SUP</a>, <font color="#666666">"Piola mapping for Hessians not yet supported"</font>);
<a name="line2118">2118: </a>  <font color="#4169E1">case</font> CONTRAVARIANT_PIOLA_TRANSFORM: <font color="#B22222">/* Contravariant Piola mapping $\sigma^*(F) = \frac{1}{|\det J|} J F \circ \phi^{-1}$ */</font>
<a name="line2119">2119: </a>    <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PETSC_COMM_SELF.html">PETSC_COMM_SELF</a>, <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_SUP</a>, <font color="#666666">"Piola mapping for Hessians not yet supported"</font>);
<a name="line2120">2120: </a>  }
<a name="line2121">2121: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line2122">2122: </a>}

<a name="line2124">2124: </a><font color="#B22222">/*@C</font>
<a name="line2125">2125: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePullback.html">PetscDualSpacePullback</a> - Transform the given functional so that it operates on real space, rather than the reference element. Operationally, this means that we map the function evaluations depending on continuity requirements of our finite element method.</font>

<a name="line2127">2127: </a><font color="#B22222">  Input Parameters:</font>
<a name="line2128">2128: </a><font color="#B22222">+ dsp       - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line2129">2129: </a><font color="#B22222">. fegeom    - The geometry for this cell</font>
<a name="line2130">2130: </a><font color="#B22222">. Nq        - The number of function samples</font>
<a name="line2131">2131: </a><font color="#B22222">. Nc        - The number of function components</font>
<a name="line2132">2132: </a><font color="#B22222">- pointEval - The function values</font>

<a name="line2134">2134: </a><font color="#B22222">  Output Parameter:</font>
<a name="line2135">2135: </a><font color="#B22222">. pointEval - The transformed function values</font>

<a name="line2137">2137: </a><font color="#B22222">  Level: advanced</font>

<a name="line2139">2139: </a><font color="#B22222">  Notes:</font>
<a name="line2140">2140: </a><font color="#B22222">  Functions transform in a complementary way (pushforward) to functionals, so that the scalar product is invariant. The type of transform is dependent on the associated k-simplex from the DeRahm complex.</font>

<a name="line2142">2142: </a><font color="#B22222">  This only handles transformations when the embedding dimension of the geometry in fegeom is the same as the reference dimension.</font>

<a name="line2144">2144: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforward.html">PetscDualSpacePushforward</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html">PetscDualSpaceGetDeRahm</a>()`</font>
<a name="line2145">2145: </a><font color="#B22222">@*/</font>
<a name="line2146">2146: </a><strong><font color="#4169E1"><a name="PetscDualSpacePullback"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePullback.html">PetscDualSpacePullback</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> dsp, <a href="../../../../../manualpages/FE/PetscFEGeom.html">PetscFEGeom</a> *fegeom, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nq, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nc, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> pointEval[])</font></strong>
<a name="line2147">2147: </a>{
<a name="line2148">2148: </a>  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a> trans;
<a name="line2149">2149: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>                    k;

<a name="line2151">2151: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBeginHot.html">PetscFunctionBeginHot</a>;
<a name="line2153">2153: </a>  PetscAssertPointer(fegeom, 2);
<a name="line2154">2154: </a>  PetscAssertPointer(pointEval, 5);
<a name="line2155">2155: </a>  <font color="#B22222">/* The dualspace dofs correspond to some simplex in the DeRahm complex, which we label by k.</font>
<a name="line2156">2156: </a><font color="#B22222">     This determines their transformation properties. */</font>
<a name="line2157">2157: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html">PetscDualSpaceGetDeRahm</a>(dsp, &amp;k));
<a name="line2158">2158: </a>  <font color="#4169E1">switch</font> (k) {
<a name="line2159">2159: </a>  <font color="#4169E1">case</font> 0: <font color="#B22222">/* H^1 point evaluations */</font>
<a name="line2160">2160: </a>    trans = IDENTITY_TRANSFORM;
<a name="line2161">2161: </a>    <font color="#4169E1">break</font>;
<a name="line2162">2162: </a>  <font color="#4169E1">case</font> 1: <font color="#B22222">/* Hcurl preserves tangential edge traces  */</font>
<a name="line2163">2163: </a>    trans = COVARIANT_PIOLA_TRANSFORM;
<a name="line2164">2164: </a>    <font color="#4169E1">break</font>;
<a name="line2165">2165: </a>  <font color="#4169E1">case</font> 2:
<a name="line2166">2166: </a>  <font color="#4169E1">case</font> 3: <font color="#B22222">/* Hdiv preserve normal traces */</font>
<a name="line2167">2167: </a>    trans = CONTRAVARIANT_PIOLA_TRANSFORM;
<a name="line2168">2168: </a>    <font color="#4169E1">break</font>;
<a name="line2169">2169: </a><strong><font color="#FF0000">  default:</font></strong>
<a name="line2170">2170: </a>    <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dsp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Unsupported simplex dim %"</font> PetscInt_FMT <font color="#666666">" for transformation"</font>, k);
<a name="line2171">2171: </a>  }
<a name="line2172">2172: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a>(dsp, trans, <a href="../../../../../manualpages/Sys/PETSC_TRUE.html">PETSC_TRUE</a>, fegeom, Nq, Nc, pointEval));
<a name="line2173">2173: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line2174">2174: </a>}

<a name="line2176">2176: </a><font color="#B22222">/*@C</font>
<a name="line2177">2177: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforward.html">PetscDualSpacePushforward</a> - Transform the given function so that it operates on real space, rather than the reference element. Operationally, this means that we map the function evaluations depending on continuity requirements of our finite element method.</font>

<a name="line2179">2179: </a><font color="#B22222">  Input Parameters:</font>
<a name="line2180">2180: </a><font color="#B22222">+ dsp       - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line2181">2181: </a><font color="#B22222">. fegeom    - The geometry for this cell</font>
<a name="line2182">2182: </a><font color="#B22222">. Nq        - The number of function samples</font>
<a name="line2183">2183: </a><font color="#B22222">. Nc        - The number of function components</font>
<a name="line2184">2184: </a><font color="#B22222">- pointEval - The function values</font>

<a name="line2186">2186: </a><font color="#B22222">  Output Parameter:</font>
<a name="line2187">2187: </a><font color="#B22222">. pointEval - The transformed function values</font>

<a name="line2189">2189: </a><font color="#B22222">  Level: advanced</font>

<a name="line2191">2191: </a><font color="#B22222">  Notes:</font>
<a name="line2192">2192: </a><font color="#B22222">  Functionals transform in a complementary way (pullback) to functions, so that the scalar product is invariant. The type of transform is dependent on the associated k-simplex from the DeRahm complex.</font>

<a name="line2194">2194: </a><font color="#B22222">  This only handles transformations when the embedding dimension of the geometry in fegeom is the same as the reference dimension.</font>

<a name="line2196">2196: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePullback.html">PetscDualSpacePullback</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html">PetscDualSpaceGetDeRahm</a>()`</font>
<a name="line2197">2197: </a><font color="#B22222">@*/</font>
<a name="line2198">2198: </a><strong><font color="#4169E1"><a name="PetscDualSpacePushforward"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforward.html">PetscDualSpacePushforward</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> dsp, <a href="../../../../../manualpages/FE/PetscFEGeom.html">PetscFEGeom</a> *fegeom, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nq, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nc, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> pointEval[])</font></strong>
<a name="line2199">2199: </a>{
<a name="line2200">2200: </a>  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a> trans;
<a name="line2201">2201: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>                    k;

<a name="line2203">2203: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBeginHot.html">PetscFunctionBeginHot</a>;
<a name="line2205">2205: </a>  PetscAssertPointer(fegeom, 2);
<a name="line2206">2206: </a>  PetscAssertPointer(pointEval, 5);
<a name="line2207">2207: </a>  <font color="#B22222">/* The dualspace dofs correspond to some simplex in the DeRahm complex, which we label by k.</font>
<a name="line2208">2208: </a><font color="#B22222">     This determines their transformation properties. */</font>
<a name="line2209">2209: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html">PetscDualSpaceGetDeRahm</a>(dsp, &amp;k));
<a name="line2210">2210: </a>  <font color="#4169E1">switch</font> (k) {
<a name="line2211">2211: </a>  <font color="#4169E1">case</font> 0: <font color="#B22222">/* H^1 point evaluations */</font>
<a name="line2212">2212: </a>    trans = IDENTITY_TRANSFORM;
<a name="line2213">2213: </a>    <font color="#4169E1">break</font>;
<a name="line2214">2214: </a>  <font color="#4169E1">case</font> 1: <font color="#B22222">/* Hcurl preserves tangential edge traces  */</font>
<a name="line2215">2215: </a>    trans = COVARIANT_PIOLA_TRANSFORM;
<a name="line2216">2216: </a>    <font color="#4169E1">break</font>;
<a name="line2217">2217: </a>  <font color="#4169E1">case</font> 2:
<a name="line2218">2218: </a>  <font color="#4169E1">case</font> 3: <font color="#B22222">/* Hdiv preserve normal traces */</font>
<a name="line2219">2219: </a>    trans = CONTRAVARIANT_PIOLA_TRANSFORM;
<a name="line2220">2220: </a>    <font color="#4169E1">break</font>;
<a name="line2221">2221: </a><strong><font color="#FF0000">  default:</font></strong>
<a name="line2222">2222: </a>    <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dsp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Unsupported simplex dim %"</font> PetscInt_FMT <font color="#666666">" for transformation"</font>, k);
<a name="line2223">2223: </a>  }
<a name="line2224">2224: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a>(dsp, trans, <a href="../../../../../manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>, fegeom, Nq, Nc, pointEval));
<a name="line2225">2225: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line2226">2226: </a>}

<a name="line2228">2228: </a><font color="#B22222">/*@C</font>
<a name="line2229">2229: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforwardGradient.html">PetscDualSpacePushforwardGradient</a> - Transform the given function gradient so that it operates on real space, rather than the reference element. Operationally, this means that we map the function evaluations depending on continuity requirements of our finite element method.</font>

<a name="line2231">2231: </a><font color="#B22222">  Input Parameters:</font>
<a name="line2232">2232: </a><font color="#B22222">+ dsp       - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line2233">2233: </a><font color="#B22222">. fegeom    - The geometry for this cell</font>
<a name="line2234">2234: </a><font color="#B22222">. Nq        - The number of function gradient samples</font>
<a name="line2235">2235: </a><font color="#B22222">. Nc        - The number of function components</font>
<a name="line2236">2236: </a><font color="#B22222">- pointEval - The function gradient values</font>

<a name="line2238">2238: </a><font color="#B22222">  Output Parameter:</font>
<a name="line2239">2239: </a><font color="#B22222">. pointEval - The transformed function gradient values</font>

<a name="line2241">2241: </a><font color="#B22222">  Level: advanced</font>

<a name="line2243">2243: </a><font color="#B22222">  Notes:</font>
<a name="line2244">2244: </a><font color="#B22222">  Functionals transform in a complementary way (pullback) to functions, so that the scalar product is invariant. The type of transform is dependent on the associated k-simplex from the DeRahm complex.</font>

<a name="line2246">2246: </a><font color="#B22222">  This only handles transformations when the embedding dimension of the geometry in fegeom is the same as the reference dimension.</font>

<a name="line2248">2248: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforward.html">PetscDualSpacePushforward</a>()`, `PPetscDualSpacePullback()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html">PetscDualSpaceGetDeRahm</a>()`</font>
<a name="line2249">2249: </a><font color="#B22222">@*/</font>
<a name="line2250">2250: </a><strong><font color="#4169E1"><a name="PetscDualSpacePushforwardGradient"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforwardGradient.html">PetscDualSpacePushforwardGradient</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> dsp, <a href="../../../../../manualpages/FE/PetscFEGeom.html">PetscFEGeom</a> *fegeom, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nq, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nc, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> pointEval[])</font></strong>
<a name="line2251">2251: </a>{
<a name="line2252">2252: </a>  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a> trans;
<a name="line2253">2253: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>                    k;

<a name="line2255">2255: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBeginHot.html">PetscFunctionBeginHot</a>;
<a name="line2257">2257: </a>  PetscAssertPointer(fegeom, 2);
<a name="line2258">2258: </a>  PetscAssertPointer(pointEval, 5);
<a name="line2259">2259: </a>  <font color="#B22222">/* The dualspace dofs correspond to some simplex in the DeRahm complex, which we label by k.</font>
<a name="line2260">2260: </a><font color="#B22222">     This determines their transformation properties. */</font>
<a name="line2261">2261: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html">PetscDualSpaceGetDeRahm</a>(dsp, &amp;k));
<a name="line2262">2262: </a>  <font color="#4169E1">switch</font> (k) {
<a name="line2263">2263: </a>  <font color="#4169E1">case</font> 0: <font color="#B22222">/* H^1 point evaluations */</font>
<a name="line2264">2264: </a>    trans = IDENTITY_TRANSFORM;
<a name="line2265">2265: </a>    <font color="#4169E1">break</font>;
<a name="line2266">2266: </a>  <font color="#4169E1">case</font> 1: <font color="#B22222">/* Hcurl preserves tangential edge traces  */</font>
<a name="line2267">2267: </a>    trans = COVARIANT_PIOLA_TRANSFORM;
<a name="line2268">2268: </a>    <font color="#4169E1">break</font>;
<a name="line2269">2269: </a>  <font color="#4169E1">case</font> 2:
<a name="line2270">2270: </a>  <font color="#4169E1">case</font> 3: <font color="#B22222">/* Hdiv preserve normal traces */</font>
<a name="line2271">2271: </a>    trans = CONTRAVARIANT_PIOLA_TRANSFORM;
<a name="line2272">2272: </a>    <font color="#4169E1">break</font>;
<a name="line2273">2273: </a><strong><font color="#FF0000">  default:</font></strong>
<a name="line2274">2274: </a>    <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dsp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Unsupported simplex dim %"</font> PetscInt_FMT <font color="#666666">" for transformation"</font>, k);
<a name="line2275">2275: </a>  }
<a name="line2276">2276: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformGradient.html">PetscDualSpaceTransformGradient</a>(dsp, trans, <a href="../../../../../manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>, fegeom, Nq, Nc, pointEval));
<a name="line2277">2277: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line2278">2278: </a>}

<a name="line2280">2280: </a><font color="#B22222">/*@C</font>
<a name="line2281">2281: </a><font color="#B22222">  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforwardHessian.html">PetscDualSpacePushforwardHessian</a> - Transform the given function Hessian so that it operates on real space, rather than the reference element. Operationally, this means that we map the function evaluations depending on continuity requirements of our finite element method.</font>

<a name="line2283">2283: </a><font color="#B22222">  Input Parameters:</font>
<a name="line2284">2284: </a><font color="#B22222">+ dsp       - The `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`</font>
<a name="line2285">2285: </a><font color="#B22222">. fegeom    - The geometry for this cell</font>
<a name="line2286">2286: </a><font color="#B22222">. Nq        - The number of function Hessian samples</font>
<a name="line2287">2287: </a><font color="#B22222">. Nc        - The number of function components</font>
<a name="line2288">2288: </a><font color="#B22222">- pointEval - The function gradient values</font>

<a name="line2290">2290: </a><font color="#B22222">  Output Parameter:</font>
<a name="line2291">2291: </a><font color="#B22222">. pointEval - The transformed function Hessian values</font>

<a name="line2293">2293: </a><font color="#B22222">  Level: advanced</font>

<a name="line2295">2295: </a><font color="#B22222">  Notes:</font>
<a name="line2296">2296: </a><font color="#B22222">  Functionals transform in a complementary way (pullback) to functions, so that the scalar product is invariant. The type of transform is dependent on the associated k-simplex from the DeRahm complex.</font>

<a name="line2298">2298: </a><font color="#B22222">  This only handles transformations when the embedding dimension of the geometry in fegeom is the same as the reference dimension.</font>

<a name="line2300">2300: </a><font color="#B22222">.seealso: `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a>`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforward.html">PetscDualSpacePushforward</a>()`, `PPetscDualSpacePullback()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransform.html">PetscDualSpaceTransform</a>()`, `<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html">PetscDualSpaceGetDeRahm</a>()`</font>
<a name="line2301">2301: </a><font color="#B22222">@*/</font>
<a name="line2302">2302: </a><strong><font color="#4169E1"><a name="PetscDualSpacePushforwardHessian"></a><a href="../../../../../manualpages/Sys/PetscErrorCode.html">PetscErrorCode</a> <a href="../../../../../manualpages/DUALSPACE/PetscDualSpacePushforwardHessian.html">PetscDualSpacePushforwardHessian</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpace.html">PetscDualSpace</a> dsp, <a href="../../../../../manualpages/FE/PetscFEGeom.html">PetscFEGeom</a> *fegeom, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nq, <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a> Nc, <a href="../../../../../manualpages/Sys/PetscScalar.html">PetscScalar</a> pointEval[])</font></strong>
<a name="line2303">2303: </a>{
<a name="line2304">2304: </a>  <a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformType.html">PetscDualSpaceTransformType</a> trans;
<a name="line2305">2305: </a>  <a href="../../../../../manualpages/Sys/PetscInt.html">PetscInt</a>                    k;

<a name="line2307">2307: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionBeginHot.html">PetscFunctionBeginHot</a>;
<a name="line2309">2309: </a>  PetscAssertPointer(fegeom, 2);
<a name="line2310">2310: </a>  PetscAssertPointer(pointEval, 5);
<a name="line2311">2311: </a>  <font color="#B22222">/* The dualspace dofs correspond to some simplex in the DeRahm complex, which we label by k.</font>
<a name="line2312">2312: </a><font color="#B22222">     This determines their transformation properties. */</font>
<a name="line2313">2313: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceGetDeRahm.html">PetscDualSpaceGetDeRahm</a>(dsp, &amp;k));
<a name="line2314">2314: </a>  <font color="#4169E1">switch</font> (k) {
<a name="line2315">2315: </a>  <font color="#4169E1">case</font> 0: <font color="#B22222">/* H^1 point evaluations */</font>
<a name="line2316">2316: </a>    trans = IDENTITY_TRANSFORM;
<a name="line2317">2317: </a>    <font color="#4169E1">break</font>;
<a name="line2318">2318: </a>  <font color="#4169E1">case</font> 1: <font color="#B22222">/* Hcurl preserves tangential edge traces  */</font>
<a name="line2319">2319: </a>    trans = COVARIANT_PIOLA_TRANSFORM;
<a name="line2320">2320: </a>    <font color="#4169E1">break</font>;
<a name="line2321">2321: </a>  <font color="#4169E1">case</font> 2:
<a name="line2322">2322: </a>  <font color="#4169E1">case</font> 3: <font color="#B22222">/* Hdiv preserve normal traces */</font>
<a name="line2323">2323: </a>    trans = CONTRAVARIANT_PIOLA_TRANSFORM;
<a name="line2324">2324: </a>    <font color="#4169E1">break</font>;
<a name="line2325">2325: </a><strong><font color="#FF0000">  default:</font></strong>
<a name="line2326">2326: </a>    <a href="../../../../../manualpages/Sys/SETERRQ.html">SETERRQ</a>(<a href="../../../../../manualpages/Sys/PetscObjectComm.html">PetscObjectComm</a>((<a href="../../../../../manualpages/Sys/PetscObject.html">PetscObject</a>)dsp), <a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_ERR_ARG_OUTOFRANGE</a>, <font color="#666666">"Unsupported simplex dim %"</font> PetscInt_FMT <font color="#666666">" for transformation"</font>, k);
<a name="line2327">2327: </a>  }
<a name="line2328">2328: </a>  <a href="../../../../../manualpages/Sys/PetscCall.html">PetscCall</a>(<a href="../../../../../manualpages/DUALSPACE/PetscDualSpaceTransformHessian.html">PetscDualSpaceTransformHessian</a>(dsp, trans, <a href="../../../../../manualpages/Sys/PETSC_FALSE.html">PETSC_FALSE</a>, fegeom, Nq, Nc, pointEval));
<a name="line2329">2329: </a>  <a href="../../../../../manualpages/Sys/PetscFunctionReturn.html">PetscFunctionReturn</a>(<a href="../../../../../manualpages/Sys/PetscErrorCode.html">PETSC_SUCCESS</a>);
<a name="line2330">2330: </a>}
</pre>
</body>

</html>
